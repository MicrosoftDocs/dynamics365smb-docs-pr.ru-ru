---
title: Настройка интеграции OneDrive с локальной версией Business Central
description: 'Узнайте, как настроить локальную версию Business Central для интеграции с OneDrive для бизнеса.'
author: jswymer
ms.topic: conceptual
ms.search.keywords: 'OneDrive, share, browser'
ms.date: 12/12/2023
ms.author: jswymer
ms.service: dynamics-365-op
ms.reviewer: jswymer
---
# Настройка интеграции OneDrive с локальной версией Business Central

[!INCLUDE[azure-ad-to-microsoft-entra-id](~/../shared-content/shared/azure-ad-to-microsoft-entra-id.md)]

В этой статье объясняется, как настроить интеграцию OneDrive с локальной версией Business Central. В отличие от [!INCLUDE[prod_short](includes/prod_short.md)] Online, подключение между между Business Central и OneDrive для бизнеса не настраивается автоматически. Если соединение не настроено, пользователи не могут использовать функции для OneDrive.

Существует две задачи, которые необходимо выполнить для настройки интеграции с OneDrive.

- Первая задача включает в себя регистрацию приложения в арендаторе Microsoft Entra, соответствующем вашему плану Microsoft 365. Зарегистрированное приложение используется для аутентификации. Эта задача обычно выполняется на портале Azure и в веб-клиенте Business Central.
- Вторая задача заключается в настройке подключения к URL-адресу OneDrive и включении функций OneDrive в Business Central. Эта задача выполняется в веб-клиенте Business Central. Порядок ее выполнения в версии 21 отличается от порядка выполнения в версиях 19 и 20. В верссии 21 предусмотрена новая функция **Настройка OneDrive**, которая заменяет собой функцию **Настройка подключения к SharePoint**.  

> [!IMPORTANT]
> Локальная версия [!INCLUDE[prod_short](includes/prod_short.md)] может быть подключена только к OneDrive, размещенному Microsoft в облаке. Подключение локальной версии [!INCLUDE[prod_short](includes/prod_short.md)] к репозиторию Мои сайты сервера SharePoint не поддерживается.

## <a name="registerapp"></a>Регистрация приложения в Microsoft Entra ID для интеграции с OneDrive

В рамках этой задачи вам необходимо добавить зарегистрированное приложение для Business Central в арендатор Microsoft Entra, соответствующий вашему плану Microsoft 365. Как и другим службам Azure, которые работают с Business Central, OneDrive требуется приложение, зарегистрированное в Microsoft Entra ID. Зарегистрированное приложение предоставляет услуги аутентификации и авторизации между Business Central и SharePoint (SharePoint используется OneDrive).

Подробные инструкции по выполнению этого шага см.у в статье [Регистрация приложения в Microsoft Entra ID](/dynamics365/business-central/dev-itpro/administration/register-app-azure#register-an-application-in-azure-active-directory) в справке для разработчиков и ИТ-специалистов.

При регистрации приложения обратите внимание на следующие моменты:

- Если вы уже зарегистрировали приложение в рамках интеграции с другим продуктом Майкрософт, например Power BI, вы можете использовать это зарегистрированное приложение. В этом случае вам просто нужно задать разрешения в отношении SharePoint для существующего зарегистрированного приложения.

- Обязательно настройте для зарегистрированного приложения следующие делегированные разрешения в отношении API SharePoint:

    - AllSites.FullControl
    - User.ReadWrite.All
    
    Для Business Central 2021 выпуска волны 2 (версия 19) вместо этого установите эти разрешения:
    
    - AllSites.Write
    - MyFiles.Write
    - User.Read.All 

- Если вы используете Business Central версии 19 или 20, скопируйте **ИД приложения (клиента)** и **секрет клиента**, используемые зарегистрированным приложением. Эта информация понадобится вам в следующем задании.

## <a name="url"></a>Получение URL-адреса OneDrive

[!INCLUDE[onedrive-url](includes/onedrive-url.md)]

## Настройка подключения к OneDrive в версии 21 и выше

Используйте эту процедуру, если вы используете волну 2 выпуска 2022 года Business Central (версию 21) или более позднюю.

### Предварительные требования

- Разрешение на вставку, изменение и удаление (imd) в отношении таблицы **Document Service Scenario** (как минимум)

### Запуск настройки OneDrive

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](media/ui-search/search_small.png "Что вы хотите сделать") введите **Настройка OneDrive**, а затем выберите соответствующую ссылку.
2. При первом запуске мастера настройки вы увидите страницу **Ваша конфиденциальность**. Прочитайте информацию на странице и, если вы согласны с условиями, выберите **Принимаю**, чтобы продолжить.
3. На странице **Настройка обработки файлов** вы можете выбрать один из следующих вариантов:

   [!INCLUDE[onedrive-feature-options](includes/onedrive-feature-options.md)]

4. На вкладке **Настройка Business Central** введите URL-адрес OneDrive в поле **URL-адрес OneDrive**.

   [Как узнать свой URL-адрес OneDrive?](#url)
5. Выберите **Проверить подключение** и дождитесь результатов.
   - Если проверка прошла успешно, выберите **Готово** и начинайте работу.
   - Если проверка не пройдена, вы увидите сообщение с описанием проблемы. Обычно проблема связана с указанным вами URL-адресом. Выберите **ОК**, чтобы вернуться на страницу **Настройка Business Central**, проверьте URL-адрес и повторите попытку.
   - Если вы еще не настроили зарегистрированное в Microsoft Entra ID приложение, откроется мастер **Настройка Microsoft Entra ID**.
6. По завершении будет считаться, что все пользователи согласны с уведомлением о конфиденциальности для интеграции с OneDrive. Если вы хотите сделать так, чтобы пользователи соглашались или не соглашались с ним самостоятельно, перейдите на страницу **Статус уведомлений о конфиденциальности** и выберите **Разрешить пользователю решать** для интеграции с OneDrive. В этом случае пользователям будет предлагаться согласиться или не согласиться с уведомлением о конфиденциальности при первом использовании функций OneDrive. Для получения дополнительной информации см. статью [Уведомления о конфиденциальности](privacy-notices-status.md).

## Настройка подключения в [!INCLUDE[prod_short](includes/prod_short.md)] версий 19 и 20

Используйте эту процедуру, если вы используете волну 1 выпуска 2022 года Business Central (версию 20) или волну 2 выпуска 2021 года (версию 19).
> [!IMPORTANT]
> Настраивая эту функцию, вы также включаете устаревшие функции, которые отправляют файлы в OneDrive.  
>
>* Функция «Открыть в Excel» автоматически скопирует файл Excel в OneDrive, затем откроет его в Excel Online. 
>* При экспорте любого отчета в файл он автоматически копирует файл в OneDrive, затем открывает его в Excel Online, Word Online или OneDrive. 
>* Другие функции также могут автоматически открываться в OneDrive.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](media/ui-search/search_small.png "Что вы хотите сделать") введите **Настройка подключения Microsoft SharePoint**, а затем выберите связанную ссылку.
2. В поле **Описание** введите описание для подключения, например **OneDrive**.
3. В поле **Папка** введите **Business Central**.
4. В поле **Расположение** введите URL-адрес вашего OneDrive.

   [Как узнать свой URL-адрес OneDrive?](#url)
5. В поле **ИД клиента** введите идентификатор клиента из зарегистрированного приложения.
6. В поле **Секрет клиента** введите секрет клиента из зарегистрированного приложения. 

> [!IMPORTANT]
> Страница **Настройка подключения к SharePoint** используется для настройки нескольких старых функций. В разделе **Общее** настраивается подключение к OneDrive, а раздел **Общие документы** перенаправляет файлы в SharePoint вместо этого. Страница **Настройка подключения к SharePoint** является устаревшей и будет удалена в ближайшем выпуске. Мы рекомендуем не настраивать раздел **Общие документы**. Для получения дополнительной информации см. статью [Устаревшие функции в базовом приложения](/dynamics365/business-central/dev-itpro/upgrade/deprecated-features-w1#microsoft-sharepoint-connection-setup).

## После обновления до версии 21

При обновлении до версии 21 или новее существующее подключение к OneDrive, настроенное на странице **Настройка подключения к SharePoint**, по-прежнему будет работать. Но поскольку страница **Настройка подключения к SharePoint** будет удалена в версии 23, мы рекомендуем перейти на новую интеграцию с OneDrive, как описано в следующем разделе. Совершение этого перехода сейчас упростит вам задачу тогда, когда страница **Настройка подключения к SharePoint** в конечном итоге будет удалена. Кроме того, это позволит вам использовать мастер настройки **Настройка OneDrive** для управления функциями OneDrive, доступными пользователям.

## Переход со старой интеграции с SharePoint на новую интеграцию с OneDrive 

Для перехода на новую интеграцию с OneDrive необходимо запустить мастер настройки **Настройка OneDrive**, который можно открыть напрямую или со старой страницы **Настройка подключения к SharePoint**. Мастер настройки **Настройка OneDrive** поможет вам осуществить переход, предоставляя информацию о вносимых измениях.

Прежде чем приступить к переходу или во время перехода обращайтесь к следующему разделу, чтобы узнать о некоторых аспектах и особенностях, связанных с этим процессом. 

### <a name="onedrivesetupmigration"></a>О переходе на новую интеграцию с OneDrive

В дополнение к интеграции с OneDrive Business Central также может интегрироваться с другими службами, такими как Power BI и Универсальная печать. Для интеграции с этими другими службами также требуется зарегистрированное приложение Microsoft Entra для аутентификации. Приложение Microsoft Entra, используемое этими другими службами, настраивается в мастере настройки **Настройка учетных записей Microsoft Entra**. При переходе со старой настройки подключения к SharePoint новый мастер настройки **Настройка OneDrive** изменит интеграцию с OneDrive так, чтобы для нее тоже использовался мастер настройки **Настройка учетных записей Microsoft Entra** &mdash; чтобы для всех интеграций использовалось одно и то же приложение Microsoft Entra.

Это изменение имеет определенные последствия при переходе на новую интеграцию с OneDrive, в зависимости от того, есть ли у вас уже приложение Майкрософт, настроенное в мастере настройки **Настройка учетных записей Microsoft Entra**. 

> [!IMPORTANT]
> После перехода на новую настройку OneDrive вы больше не сможете использовать страницу **Настройка подключения к SharePoint** для настройки интеграции с OneDrive.

#### Как изменения влияют на интеграцию

Мастер настройки **Настройка OneDrive** будет всегда использовать приложение, указанное в мастере настройки **Настройка учетных записей Microsoft Entra**, если оно есть. Когда вы запускаете мастер настройки **Настройка OneDrive**, он сравнивает приложение, указанное в мастере **Настройка учетных записей Microsoft Entra** с текущим приложением, указанным на странице **Настройка подключения к SharePoint**.

> [!TIP]
> На странице **Настройка подключения к SharePoint** и в мастере настройки **Настройка учетных записей Microsoft Entra** приложение Microsoft Entra идентифицируется по **ИД клиента**.

- Если приложение в мастере **Настройка учетных записей Microsoft Entra** отличается от приложения на странице **Настройка подключения к SharePoint**, интеграция с OneDrive будет вместо него использовать приложение в мастере **Настройка учетных записей Microsoft Entra**.

   В мастере настройки **Настройка OneDrive** в процессе перехода вы увидите сообщение примерно следующего содержания: 

  `The Microsoft Entra application used for authentication will be configured for all Business Central integrations. This means the client id will change to NNNNNNNNN-NNNN-NNNN-NNNN-NNNNNNNNNNNN, you may want to test it has the correct permissions.`

  `NNNNNNNNN-NNNN-NNNN-NNNN-NNNNNNNNNNNN`представляет ИД клиента приложения в мастере **Настройка учетных записей Microsoft Entra**, на которые переключилась интеграция с OneDrive. 

  > [!IMPORTANT]
  > Чтобы новая интеграция с OneDrive работала после перехода, необходимо предоставить приложению разрешение в отношении API SharePoint на портале Azure. Вы можете выполнить этот шаг до или после перехода на новую настройку OneDrive. Для получения дополнительной информации см. раздел [Регистрация приложения в Microsoft Entra ID для интеграции с OneDrive](#registerapp).

- Если приложение в мастере **Настройка учетных записей Microsoft Entra** совпадает с приложением на странице **Настройка подключения к SharePoint**, интеграция с OneDrive будет использовать то же приложение, что и раньше, за исключением конфигурации в мастере **Настройка учетных записей Microsoft Entra**.

   В мастере настройки **Настройка OneDrive** в процессе перехода вы увидите сообщение примерно следующего содержания:

    `The Microsoft Entra application used for authentication will be configured for all Business Central integrations. This has already been configured with the same client id (5F78CADE-19C0-49BF-AF84-306D0579B50E).`

- Если в мастере **Настройка учетных записей Microsoft Entra** не указано приложение, интеграция с OneDrive будет использовать то же приложение, что и раньше.

   Мастер настройки **Настройка OneDrive** копирует конфигурацию приложения в мастере настройки **Настройка учетных записей Microsoft Entra**, чтобы ее можно было использовать для других интеграций, которые будут настроены в дальнейшем.

   В мастере настройки **Настройка OneDrive** в процессе перехода вы увидите сообщение примерно следующего содержания:

   `The Microsoft Entra application used for authentication will be configured for all Business Central integrations`.

### Запуск настройки OneDrive для перехода на новую интеграцию с OneDrive

1. Откройте страницу **Настройка OneDrive** или страницу **Настройка подключения к SharePoint**.
2. Если вы используете страницу **Настройка подключения к SharePoint**, выберите **Перейти в новый интерфейс настройки OneDrive** в уведомлении вверху страницы.
3. Выполните шаги в мастере настройки **Настройка OneDrive**.
4. Дойдя до страницы **Настройка обработки файлов**, выберите один из следующих вариантов для включения функций:

   [!INCLUDE[onedrive-feature-options](includes/onedrive-feature-options.md)]

5. На странице **Настройка Business Central** отображается то же URL-адрес, который используется существующей интеграцией с OneDrive. Если требуется, URL-адрес можно изменить.
6. Выберите **Проверить подключение** и следуйте инструкциям.

   Если проверка прошла успешно, выберите **Готово** и начинайте работу. В противном случае используйте сообщения на странице, чтобы решить проблему.

## См. также
[Интеграция Business Central и OneDrive для бизнеса](across-onedrive-overview.md)  
[Открытие файлов Business Central в OneDrive](across-share-onedrive.md)  
[Часто задаваемые вопросы по OneDrive](admin-onedrive-faq.md)

