---
title: Аудит изменений
description: 'Вы можете активизировать журнал пользователя, чтобы у вас была история всех изменений, внесенных в данные в отслеживаемых таблицах. Также можно отслеживать действия с помощью определенных типов журналов действий.'
author: brentholtorf
ms.author: bholtorf
ms.reviewer: bholtorf
ms.topic: conceptual
ms.search.keywords: 'user log, user activity, tracking'
ms.search.form: '592, 593, 594, 595, 710, 1366, 1367, 1368, 1369'
ms.date: 05/03/2024
ms.custom: bap-template
ms.service: dynamics-365-business-central
---
# Аудит изменений

Общей задачей многих приложений для управления бизнесом является предотвращение нежелательных изменений данных. Это может быть все что угодно — от неправильно введенного номера телефона клиента, до неправильного учета в Главной книге. В этой статьи рассматривается, как узнать, что изменилось, кто это изменил и когда это изменение было внесено.

## О журнале изменений

Журнал изменений позволяет отслеживать все изменения, внесенные пользователем непосредственно в данные базы данных. Необходимо указать каждую таблицу и поле, которые система должна записывать в журнал, после чего следует активировать журнал изменений. Журнал изменений основывается на изменениях, внесенных в данные таблиц, по которым выполняется отслеживание. На странице **Операции журнала изменений** операции хронологически упорядочены, а также показывает все изменения, примененные к значениям в полях в указанных таблицах.

Отслеживание изменений может негативно сказаться на быстродействии (что может стоить вам времени), а также привести к увеличению размера базы данных (что может стоить вам денег). Чтобы свести эти затраты к минимуму, помните о следующем:

- Выбирайте таблицы и операции с осторожностью.
- Не добавляйте операции книг и учтенные документы. Вместо этого отдавайте приоритет системным полям, таким как "Кем создано" и "Дата создания".
- Не используйте тип отслеживания **Все поля**. Вместо этого выберите тип **Некоторые поля** и отслеживайте только самые важные из полей.

> [!NOTE]
> В журнале изменений не отслеживаются изменения в полях, в которых используется `autoIncrement property`. Примером поля, в котором используется это свойство, является поле «Целое число» в таблицах «Сообщения об ошибках» и «Строка отчета по НДС».

Также по соображениям производительности журнал изменений отключается в процессе обновления [!INCLUDE [prod_short](includes/prod_short.md)] на следующую версию. Помимо ускорения процесса обновления, отключение журнала также помогает уменьшить беспорядок в журнале изменений. Как только обновление завершится, журнал снова начнет отслеживать изменения.

> [!Important]
> Изменения отображаются в **Записи журнала изменений** только после перезапуска сеанса пользователя, что происходит следующим образом:
>
> - Срок действия сеанса завершился и сеанс был обновлен.
> - Пользователь выбрал другую организацию или ролевой центр.
> - Пользователь выполнил выход, затем снова вход.

## Настройка журнала изменений

На странице **Настройка журнала изменений** можно включить или отключить журнал изменений. Это действие также записывается в журнал, поэтому всегда можно увидеть, кто внес изменение

На странице **Настройка журнала изменений**, если выбрать действие **Таблицы**, можно указать, для каких таблиц требуется отслеживать изменения и какие изменения требуется отслеживаться. [!INCLUDE[prod_short](includes/prod_short.md)] также отслеживает несколько системных таблиц.

> [!NOTE]
> Вы можете отслеживать изменения в определенных полях, например в полях, содержащих конфиденциальные данные, путем настройки мониторинга полей. Если вы это сделаете, чтобы избежать избыточности, таблица, содержащая это поле, не будет доступна для настройки журнала изменений. Дополнительные сведения см. в разделе [Мониторинг конфиденциальных полей](across-log-changes.md#monitor-sensitive-fields).

После настройки журнала изменений, его активации и внесения изменений в данные можно просмотреть и отфильтровать изменения на странице **Операции журнала изменений**. Если вы хотите удалять операции, настройте политику хранения, которая позволяет установить фильтры по дате и времени. Подробнее о политиках хранения можно узнать в статье [Определение политик хранения](admin-data-retention-policies.md).  

## Анализ данных в журнале изменений

Функцию **Анализ данных** можно использовать для анализа данных в журнале изменений на странице [Операции журнала изменений](https://businesscentral.dynamics.com/?page=595). Вам не нужно запускать отчет или открывать другое приложение, такое как Excel. Эта функция представляет собой интерактивный и универсальный механизм для выполнения вычислений, подведения итогов и изучения данных. Вместо создания отчетов с использованием различных параметров и фильтров вы можете добавить несколько вкладок, представляющих различные задачи с данными или представления данных. Например, это может быть представление «Кто изменил какие данные и когда», «Изменения данных по таблице/полю» или любое другое представление, которое может вам понадобиться. Подробнее о том, как использовать функцию **Анализ данных**, см. в статье [Анализ данных списков и запросов в режиме анализа](analysis-mode.md).

### Сценарии ad-hoc-анализа данных журнала изменений

В следующих разделах представлены примеры сценариев, в которых анализ журнала изменений поможет обеспечить мониторинг и аудит важных изменений.

| С областями | Задача | Открыть в режиме анализа эту страницу | С использованием этих полей |
| ---- | ----- | ------------------------------- |------------------- |
| [Кто изменил какие данные и когда](#example-who-changed-what-data-and-when) | Посмотреть, кто изменил какие данные. | [Операции журнала изменений](https://businesscentral.dynamics.com/?page=595) | **ИД пользователя**, **Дата и время**, **Название таблицы**, **Метка поля**, **Значение поля 2 первичного ключа**, **Значение поля 3 первичного ключа**, **Тип изменения**, **Старое значение** и **Новое значение**. |
| [Изменения данных по таблице/полю](#example-data-changes-by-tablefield) | Просмотреть изменения данных по таблицам/полям с информацией о том, кто внес изменения. | [Операции журнала изменений](https://businesscentral.dynamics.com/?page=595) | **Название таблицы**, **Метка поля**, **ИД пользователя**, **Дата и время**, **Значение поля 2 первичного ключа**, **Значение поля 3 первичного ключа**, **Тип изменения**, **Старое значение** и **Новое значение**. |

### Пример: кто изменил какие данные и когда

Чтобы проанализировать, кто изменил какие данные и когда, выполните следующие действия:

1. Откройте список [Операции журнала изменений](https://businesscentral.dynamics.com/?page=595) и выберите значок :::image type="content" source="media/analysis-mode-icon.png" alt-text="Перейти в режим анализа.":::, чтобы включить режим анализа.
1. В меню **Столбцы** удалите все столбцы (выберите флажок рядом с полем **Поиск** справа).
1. Перетащите поле **ИД пользователя** (кто внес изменение) в область **Группы строк**.
1. Теперь выберите следующие поля:
   - Чтобы показать, когда было внесено изменение, выберите **Дата и время**.
   - Чтобы показать таблицу, в которую было внесено изменение, выберите **Название таблицы**. 
   - Чтобы показать, какое поле было изменено, выберите **Метка поля**.
   - Чтобы показать код поля, выберите **Значение поля 2 первичного ключа**. 
   - Чтобы показать наименование организации, выберите **Значение поля 3 первичного ключа**.
   - Чтобы показать, какого рода действие представляет собой изменение (вставка, удаление или обновление), выберите **Тип изменения**.
   - Чтобы показать само изменение, выберите **Старое значение** и **Новое значение**.
1. Переименуйте вкладку анализа в **Кто изменил какие данные и когда** (или дайте ей другое название, характеризующее этот анализ).

На следующем рисунке показан результат выполнения этих действий.

:::image type="content" source=" media/data-analysis-change-log-entries-Who-changed-What-data-When.png" alt-text="Пример выполнения анализа данных на странице «Операции журнала изменений» (кто изменил какие данные и когда)." lightbox="media/data-analysis-change-log-entries-Who-changed-What-data-When.png":::

### Пример: изменения данных по таблице/полю

Чтобы проанализировать изменения данных по таблице/полю, выполните следующие действия:

1. Откройте список [Операции журнала изменений](https://businesscentral.dynamics.com/?page=595) и выберите значок :::image type="content" source="media/analysis-mode-icon.png" alt-text="Перейти в режим анализа.":::, чтобы включить режим анализа.
1. В меню **Столбцы** удалите все столбцы (выберите флажок рядом с полем **Поиск** справа).
1. Перетащите поля **Название таблицы** (в какой таблице) и **Метка поля** (в каком поле) в область **Группы строк**.
1. Теперь выберите следующие поля:
   - Чтобы показать, когда было внесено изменение, выберите **Дата и время**.
   - Чтобы показать, кто внес изменение, выберите **ИД пользователя**.
   - Чтобы показать код поля, выберите **Значение поля 2 первичного ключа**.
   - Чтобы показать наименование организации, выберите **Значение поля 3 первичного ключа** (обычно это наименование организации). 
   - Чтобы показать, какого рода действие представляет собой изменение (вставка, удаление или обновление), выберите **Тип изменения**.
   - Чтобы показать само изменение, выберите **Старое значение** и **Новое значение**.
1. Переименуйте вкладку анализа в **Изменения данных по таблице и полю** (или дайте ей другое название, характеризующее этот анализ).

На следующем рисунке показан результат выполнения этих действий.

:::image type="content" source=" media/data-analysis-change-log-entries-data-changes-by-table-field.png" alt-text="Пример выполнения анализа данных на странице «Операции журнала изменений» (изменения данных по таблице/полю)." lightbox="media/data-analysis-change-log-entries-data-changes-by-table-field.png":::

## О журналах действий

С некоторых страниц в [!INCLUDE [prod_short](includes/prod_short.md)] можно просмотреть журнал действий, в котором указаны состояние и возможные ошибки из файлов, которые вы экспортируете или импортируете в [!INCLUDE [prod_short](includes/prod_short.md)],  

### Работа с журналами действий

Эта информация отображается на странице **Журнал действий** в соответствии с контекстом, из которого открыта страница. Например, можно открыть страницу со страниц **Настройка службы обмена документами**, **Входящий документ**, **Учтенный счет продажи** и **Учтенная кредит-нота продажи**. Вы можете очистить список записей журнала или просто удалить из него записи старше семи дней.  

## Мониторинг конфиденциальных полей

Обеспечение безопасности и конфиденциальности конфиденциальных данных является основной задачей для большинства организаций. Чтобы добавить дополнительный уровень безопасности, вы можете отслеживать важные поля и получать уведомления по электронной почте, когда кто-то меняет значение. Например, вы можете захотеть получать уведомления, если кто-то изменит номер IBAN вашей компании.

> [!NOTE]
> Для отправки уведомлений по электронной почте необходимо настроить функцию электронной почты в [!INCLUDE[prod_short](includes/prod_short.md)]. Дополнительные сведения см. в разделе [Настройка электронной почты](admin-how-setup-email.md).

### Настройка мониторинга полей

Вы можете использовать руководство мастера настройки **Настройка мониторинга изменений полей**, чтобы указать поля, которые вы хотите отслеживать на основе критериев фильтрации, таких как классификация данных для полей. Дополнительные сведения см. в разделе [Классификация конфиденциальности данных](admin-classifying-data-sensitivity.md). Мастер также позволяет указать человека, который будет получать уведомление по электронной почте при изменении, и учетную запись электронной почты, которая будет отправлять это уведомление. Укажите как уведомление пользователя, так и учетную запись, с которой будет отправлено уведомление. После того, как вы закончите работу с руководством, вы можете управлять настройками мониторинга полей на странице **Настройка мониторинга полей**.

> [!NOTE]
> При указании учетной записи электронной почты для отправки уведомлений необходимо добавить типы учетных записей **Microsoft 365** или **SMTP**. Уведомления следует отправлять из учетной записи, которая не связана с фактическим пользователем. Поэтому вы не можете выбрать тип учетной записи **Текущий пользователь**. В противном случае уведомления отправляться не будут.

Со временем список записей на странице **Записи журнала отслеживаемых полей** будет расти. Чтобы уменьшить количество записей, вы можете создать политику хранения, которая будет удалять записи по прошествии определенного периода времени. Дополнительные сведения см. в разделе [Определение политик хранения](admin-data-retention-policies.md).

Когда вы настраиваете мониторинг полей или что-то меняете в настройке, для ваших изменений создаются записи. Вы можете указать, следует ли отображать записи, относящиеся к настройке мониторинга, путем их отображения или скрытия.

Вы можете управлять настройками для мониторинга полей, например отправлять ли уведомление по электронной почте или просто регистрировать изменение, для каждого поля на странице **Лист отслеживаемых полей**. На странице также можно добавлять или удалять поля для мониторинга.

> [!NOTE]
> После добавления одного или нескольких полей и начала мониторинга вы должны выйти из и снова войти [!INCLUDE[prod_short](includes/prod_short.md)], чтобы применить свои настройки.

### Работа с мониторингом полей

Записи для всех измененных значений для отслеживаемых полей доступны на странице **Записи журнала отслеживаемых полей**. Например, записи содержат следующие сведения:

- Поле, значение в котором изменилось.
- Оригинальные и новые значения.
- Кто внес изменения и когда это сделано.

Для дальнейшего изучения изменения выберите значение, чтобы открыть страницу, на которой оно было внесено. Чтобы просмотреть список всех записей, выберите **Записи об изменении поля**.

### Просмотр телеметрии мониторинга полей

Вы можете настроить [!INCLUDE[prod_short](includes/prod_short.md)], чтобы отправить действие мониторинга полей в ресурс Application Insights в Microsoft Azure. Затем с помощью Azure Monitor вы создаете отчеты и настраиваете оповещения о собранных данных. Дополнительные сведения см. в следующих статьях в справке для разработчиков и ИТ-специалистов [!INCLUDE[prod_short](includes/prod_short.md)]:

- [Мониторинг и анализ телеметрии — включение Application Insights](/dynamics365/business-central/dev-itpro/administration/telemetry-overview?toc=/dynamics365/business-central/toc.json#enable)
- [Анализ телеметрии мониторинга полей](/dynamics365/business-central/dev-itpro/administration/telemetry-field-monitoring-trace?toc=/dynamics365/business-central/toc.json)

## Определение политик хранения

Вы можете создать политики хранения для удаления ненужных данных в журналах по истечении указанного вами периода времени. Например, со временем количество записей в журнале может увеличиваться. Удаляя старые записи, вы можете улучшить концентрацию на более свежих и, возможно, более актуальных записях. Подробнее о политиках хранения можно узнать в статье [Определение политик хранения](admin-data-retention-policies.md).

## См. также

[Мониторинг конфиденциальных полей](across-log-changes.md#monitor-sensitive-fields)  
[Анализ телеметрии мониторинга полей](/dynamics365/business-central/dev-itpro/administration/telemetry-field-monitoring-trace?toc=/dynamics365/business-central/toc.json)  
[Определение политик хранения](admin-data-retention-policies.md)  
[Изменение базовых параметров](ui-change-basic-settings.md)  
[Сортировка, поиск и фильтрация](ui-enter-criteria-filters.md)  
[Поиск страниц и информации с помощью функции "Что вы хотите сделать"](ui-search.md)  
[Назначение разрешений пользователям и группам](ui-define-granular-permissions.md)  
[Работа с [!INCLUDE[prod_short](includes/prod_short.md)]](ui-work-product.md)  

[!INCLUDE[footer-include](includes/footer-banner.md)]
