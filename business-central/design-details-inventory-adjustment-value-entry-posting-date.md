---
title: Даты учета для операций стоимости
description: Узнайте, как пакетное задание "Коррекция себестоимости запасов" идентифицирует и назначает дату учета операциям стоимости, которые пакетное задание собирается создать.
author: edupont04
ms.service: dynamics365-business-central
ms.topic: article
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: ''
ms.date: 10/01/2020
ms.author: edupont
ms.openlocfilehash: b40af343751d99d3e16f2a6ac7a57f85d40a2ba4
ms.sourcegitcommit: ddbb5cede750df1baba4b3eab8fbed6744b5b9d6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2020
ms.locfileid: "3913790"
---
# <a name="design-details-posting-date-on-adjustment-value-entry"></a>Подробности разработки: дата учета для операции коррекции стоимости
Эта статья содержит рекомендации для пользователей функции оценки стоимости запасов в [!INCLUDE[d365fin](includes/d365fin_md.md)]. Конкретная статья предоставляет рекомендации по тому, как пакетное задание **Коррекция себестоимости запасов** идентифицирует и назначает дату учета операциям стоимости, которые пакетное задание собирается создать.  

Сначала рассматривается концепция процесса, как пакетное задание идентифицирует и назначает дату учета для создаваемой операции стоимости. Далее приводятся несколько сценариев, с которыми время от времени сталкивается группа поддержки, а в конце приводится сводка концепций, используемых из версии 3.0.  

## <a name="the-concept"></a>Концепция  
С версии 5.0 пакетное задание **Коррекция себестоимости запасов** назначает дату учета создаваемой операции стоимости с использованием следующих шагов:  

1.  Первоначально дата учета создаваемой операции совпадает с датой операции, которую она корректирует.  

2.  Дата учета проверяется относительно периодов учета запасов и/или настройки ГК.  

3.  Назначение даты учета: если исходная дата учета не находится в пределах допустимого диапазона дат учета, пакетное задание назначает допустимую дату учета из настройки ГК или периода учета запасов. Если определены как периоды учета, так и допустимые даты учета в настройке ГК, для операции коррекции стоимости назначается более поздняя из двух этих дат.  

 Дайте дополнительно рассмотрим этот процесс на практике. Предположим, что имеется операция книги товаров для продажи. Товар был отгружен 5 сентября 2013 г., и счет был выставлен на день позже.  

![Состояние операций книги товаров в сценарии](media/helene/TechArticleAdjustcost1.png "Состояние операций книги товаров в сценарии")  

Ниже первая операция стоимости (379) представляет отгрузку и содержит ту же самую дату учета, что и родительская операция книги товаров.  

Вторая операция стоимости (381) представляет счет.  

 Третья операция стоимости (391) представляет собой коррекцию операции стоимости для выставления счета (381)  

 ![Состояние операций стоимости в сценарии](media/helene/TechArticleAdjustcost2.png "Состояние операций стоимости в сценарии")  

 Шаг 1. Создаваемой операции коррекции стоимости назначается та же дата учета, что и у корректируемой операции, как иллюстрируется выше операцией стоимости 391.  

 Шаг 2. Проверка первоначально назначенной даты учета.  

Пакетное задание **Коррекция себестоимости запасов** определяет, находится ли исходная дата учета операции коррекции стоимости в допустимом диапазоне дат учета на основе периодов учета запасов и/или настройки ГК.  

 Давайте рассмотрим указанную выше продажу, добавив настройку допустимых диапазонов дат учета.  

 Периоды учета запасов:  

![Периоды учета запасов в сценарии](media/helene/TechArticleAdjustcost3.png "Периоды учета запасов в сценарии")

 Первая допустимая дата учета — это первый день первого открытого периода. 1 сентября 2013 г.  

 Настройка ГК:  

![Настройка главной книги в сценарии](media/helene/TechArticleAdjustcost4.png "Настройка главной книги в сценарии")

 Первая допустимая дата учета — это дата, указанная в поле "Разрешить учет с": 10-е сентября 2013 г.  

 Если определены как периоды учета, так и допустимые даты учета в настройке ГК, более поздняя дата из этих двух будет определять допустимый диапазон дат учета.  

 Шаг 3. Назначение допустимой даты учета;  

 Исходная назначенная дата учета была 6-е сентября, как показано в шаге 1. Однако во 2-м шаге пакетное задание "Коррекция себестоимости запасов" определяет, что самая ранняя допустимая дата учета — это 10-е сентября, и поэтому назначает 10-е сентября операции коррекции стоимости ниже.  

 ![Состояние операций стоимости в сценарии 2](media/helene/TechArticleAdjustcost5.png "Состояние операций стоимости в сценарии 2")

 Теперь мы рассмотрели концепцию назначения дат учета операциям стоимости, созданным пакетным заданием коррекции себестоимости запасов.  

 Теперь давайте рассмотрим некоторые сценарии, с которыми мы в группе поддержки сталкиваемся время от времени в отношении назначенных дат учета в пакетном задании коррекции себестоимости запасов и соответствующих настроек.  

## <a name="scenarios"></a>Сценарии  

### <a name="scenario-i-posting-date-is-not-within-your-range-of-allowed-posting-dates"></a>Сценарий I. "Дата учета вне пределов разрешенного диапазона дат учета..."  
 Это сценарий, в котором пользователь получает указанное выше сообщение об ошибке при запуске пакетного задания коррекции себестоимости запасов.  

 В предыдущем разделе, описывающем концепцию назначения дат учета, намерение пакетного задания коррекции себестоимости запасов заключается в создании операции стоимости с датой учета 10-го сентября.  

![Сообщение об ошибке о дате учета](media/helene/TechArticleAdjustcost6.png "Сообщение об ошибке о дате учета")

 Мы отслеживаем настройку пользователя:  

![Настройка разрешенных пользователем дат учета](media/helene/TechArticleAdjustcost7.png "Настройка разрешенных пользователем дат учета")

 Пользователь в этом случае разрешил диапазон дат учета с 11-го сентября по 30-е сентября, и, таким образом, не разрешил учет операции коррекции стоимости с датой учета 10-е сентября.  

![Обзор соответствующей настройки дат учета](media/helene/TechArticleAdjustcost8.png "Обзор соответствующей настройки дат учета")

 В статье базы знаний [952996](https://mbs2.microsoft.com/Knowledgebase/kbdisplay.aspx?WTNTZSMNWUKNTMMYXUPYZQPOUXNXSPSYOQQYYMLUQLOYYMWP) обсуждаются дополнительные сценарии, связанные с указанным сообщением об ошибке.  

### <a name="scenario-ii-posting-date-on-adjustment-value-entry-versus-posting-date-on-entry-causing-the-adjustment-such-as-revaluation-or-item-charge"></a>Сценарий II. Дата учета в операции коррекции стоимости и дата учета в операции, вызывающей коррекцию, такую как переоценка или товарная издержка.  

### <a name="revaluation-scenario"></a>Сценарий переоценки:  
 Предварительные требования:  

 Настройка модуля "Запасы":  

-   Автомат. учет себест. = Да  

-   Автоматическая коррекция себестоимости = Всегда  

-   Тип расчета средней себестоимости = товар  

-   Период расчета средней себестоимости = День  

 Настройка ГК:  

-   Разрешить учет с = 1-е января 2014 г.  

-   Разрешить учет по = пусто  

 Настройка пользователя:  

-   Разрешить учет с = 1-е декабря 2013 г.  

-   Разрешить учет по = пусто  

##### <a name="to-test-the-scenario"></a>Для проверки сценария  

1.  Создайте товар ТЕСТ:  

     Базовая единица измерения = ШТ.  

     Метод учета себестоимости = Среднее  

     Выберите необязательные учетные группы.  

2.  Откройте журнал товаров, создайте и учтите строку следующим образом:  

     Дата учета = 15-е декабря 2013 г.  

     Товар = ТЕСТ  

     Тип операции = Покупка  

     Количество = 100  

     Цена единицы = 10  

3.  Откройте журнал товаров, создайте и учтите строку следующим образом:  

     Дата = 20-е декабря 2013 г.  

     Товар = ТЕСТ  

     Тип операции = Расход  

     Количество = 2  

4.  Откройте журнал товаров, создайте и учтите строку следующим образом:  

     Дата = 15-е января 2014 г.  

     Товар = ТЕСТ  

     Тип операции = Расход  

     Количество = 3  

5.  Откройте журнал переоценки, создайте и учтите строку следующим образом:  

     Товар = ТЕСТ  

     Примен. к операции = выберите операцию покупки, учтенную на шаге 2. Дата учета переоценки будет такой же, как и в операции, которую она корректирует.  

     Себестоимость единицы (переоценка) = 40  

 Были учтены следующие операции журнала товаров и стоимости:  

![Обзор получающихся операций книги товаров и стоимости 1](media/helene/TechArticleAdjustcost9.png "Обзор получающихся операций книги товаров и стоимости 1")

 ![Обзор получающихся операций книги товаров и стоимости 2](media/helene/TechArticleAdjustcost10.png "Обзор получающихся операций книги товаров и стоимости 2")

 Пакетное задание коррекции себестоимости запасов распознало изменение себестоимости и скорректировало поле "Расходы".  

 **Проверка дат учета в созданных операциях коррекции стоимости:** самая ранняя допустимая дата учета, с которой должно быть связано пакетное задание коррекции себестоимости запасов, — это 1-е января 2014 года, как указано в настройке ГК.  

 **Расход в шаге 3:** назначена дата учета 1-е января, указанная в настройке ГК. Дата учета операции стоимости в рамках коррекции — 20-е декабря 2013 г. В соответствии с настройкой ГК эта дата не находится в разрешенном диапазоне дат учета. Поэтому дата учета, указанная в поле "Разрешить учет от" в настройке ГК, назначена операции коррекции стоимости.  

 **Расход на шаге 4:** назначена дата учета 15-е января. Операция стоимости в рамках коррекции имеет дату учета 15-е января, которая находится в диапазоне допустимых дат учета согласно настройке ГК.  

 Коррекция, выполненная для расхода на шаге 3, вызывает обсуждение. Предпочтительная дата учета для операции коррекции стоимости была бы 20-е декабря или по крайней мере в декабре, так как переоценка, вызывающая изменение себестоимости продажи, была учтена в декабре.  

 Чтобы получить коррекцию в декабре для расхода на шаге 3, в настройке ГК в поле "Разрешить учет с" должна быть указана дата в декабре.  

 **Заключение:**  

 С опытом из этого сценария при рассмотрении наиболее подходящей настройки допустимого диапазона дат разноски для компании могут быть полезны следующие соображения: если изменение стоимости запасов разрешено учитывать в некоторый период (в данном случае это декабрь), настройка компании, используемая для допустимых диапазонов дат учета, должна быть согласована с этим решением. Если в поле "Разрешить учет от" в настройке главной книги задано 1-е декабря, это позволит сделанную в декабре переоценку передать в соответствующие исходящие операции в этом же периоде.  

 Группы пользователей, которым не разрешено выполнять учет в декабря, а разрешено в январе, которые, вероятно, должны были ограничиваться настройкой ГК в этом сценарии, на самом деле следовало бы обрабатывать с помощью настройки пользователя.  

### <a name="item-charge-scenario"></a>Сценарий товарных издержек:  
 Предварительные требования:  

 Настройка модуля "Запасы":  

-   Автомат. учет себест. = Да  

-   Автоматическая коррекция себестоимости = Всегда  

-   Тип расчета средней себестоимости = товар  

-   Период расчета средней себестоимости = День  

 Настройка ГК:  

-   Разрешить учет с = 1-е декабря 2013 г.  

-   Разрешить учет по = пусто  

 Настройка пользователя:  

-   Разрешить учет с = 1-е декабря 2013 г.  

-   Разрешить учет по = пусто  

##### <a name="to-test-the-scenario"></a>Для проверки сценария  

1.  Создайте товарные издержки:  

     Базовая единица измерения = ШТ.  

     Метод учета себестоимости = Среднее  

     Выберите необязательные учетные группы.  

2.  Создание нового заказа на покупку  

     Код поставщика: 10000  

     Дата учета = 15-е декабря 2013 г.  

     Номер счета-фактуры поставщика: 1234  

     В строке заказа на покупку:  

     Товар = ИЗДЕРЖКИ  

     Количество = 1  

     Прямая себестоимость единицы = 100  

     Выполните учет приемки и счета-фактуры.  

3.  Создайте новый заказ на продажу:  

     Код клиента: 10000;  

     Дата учета = 16-е декабря 2013 г.  

     В строке заказа продажи:  

     Товар = ИЗДЕРЖКИ  

     Количество = 1  

     Цена единицы = 135  

     Выполните учет отгрузки и счета-фактуры.  

4.  Настройка ГК:  

     Разрешить учет с = 1-е января 2014 г.  

     Разрешить учет по = пусто  

5.  Создайте новый заказ на покупку:  

     Код поставщика: 10000  

     Дата учета = 2-е января 2014 г.  

     Номер счета-фактуры поставщика: 2345  

     В строке заказа на покупку:  

     Товарные издержки = РАБ-ФРАХТ  

     Количество = 1  

     Прямая себестоимость единицы = 3  

     Назначьте товарные издержки приходной накладной покупки из шага 2.  

     Выполните учет приходной накладной и счета-фактуры.  

     ![Обзор получающихся операций книги товаров и стоимости 3](media/helene/TechArticleAdjustcost11.png "Обзор получающихся операций книги товаров и стоимости 3")

6.  В рабочую дату 3-го января поступает счет покупки, содержащий дополнительные товарные издержки по покупке, произведенной на шаге 2. Этот счет имеет дату документа 30-е декабря, поэтому он учитывается с датой учета 30-е декабря 2013 г.  

     Создайте новый заказ на покупку:  

     Код поставщика: 10000  

     Дата учета = 30-е декабря 2013 г.  

     Номер счета-фактуры поставщика: 3456  

     В строке заказа на покупку:  

     Товарные издержки = РАБ-ФРАХТ  

     Количество = 1  

     Прямая себестоимость единицы = 2  

     Назначьте товарные издержки приходной накладной покупки из шага 2  

     Выполните учет приходной накладной и счета-фактуры.  

   ![Обзор получающихся операций книги товаров и стоимости 4](media/helene/TechArticleAdjustcost12.png "Обзор получающихся операций книги товаров и стоимости 4")

 Отчет оценки стоимости запасов распечатывается на дату 31-е декабря 2013 г.  

![Содержимое отчета "Оценка стоимости запасов"](media/helene/TechArticleAdjustcost13.png "Содержимое отчета "Оценка стоимости запасов"")

 **Сводка сценария:**  

 Описанный сценарий заканчивается тем, что в отчете оценки стоимости запасов отображается Количество = 0, тогда как Стоимость = 2. Товарные издержки, учтенные на шаге 11, являются частью значения прихода склада в декабре, в то время как значение расхода склада за этот же период не затронуто.  

 Наличие настройки ГК, в которой указано разрешение учета с 1-го января, было удачным решением для первой товарной издержки. Себестоимость прихода и расхода склада была зарегистрирована за один и тот же период. Однако для второй товарной издержки настройка главной книги привела к тому, что себестоимость продажи была распознана в последующем периоде.  

 **Заключение:**  

 Достаточно сложно добиться того, чтобы в отчете по оценке стоимости запасов указывалось количество = 0, когда значение <> 0. В этом случае также более сложно выразить оптимальные настройки, так как счета покупки поступили в один день, но относятся к разным периодам или даже финансовым годам. Для перехода на новый финансовый год обычно требуется определенное планирование, в рамках которого требуется учитывать анализ процесса коррекции себестоимости запасов и распознавания себестоимости продажи.  

 В этом сценарии в качестве одного из вариантов можно было бы задать в настройке ГК для поля "Разрешить учет с" дату в декабре еще на пару дополнительных дней, а учет первой товарной издержки задержать, чтобы сначала обеспечить распознавание всех затрат за предыдущий период или фискальный год, к которому они принадлежат, затем запустить пакетное задание коррекции себестоимости запасов, после чего переместить разрешенную дату учета на новый период\/финансовый год. Первая товарная издержка с датой учета 2-е января затем могла бы быть учтена.  

## <a name="history-of-adjust-cost--item-entries-batch-job"></a>История пакетного задания коррекции себестоимости запасов  
 Ниже приведена сводка концепции назначения дат учета операций коррекции стоимости пакетным заданием коррекции себестоимости запасов, начиная с версии 3.0.  

### <a name="from-version-30370a"></a>С версии 3.0..3.70.A  
 В форме запроса пакетного задания корректировки себестоимости запасов имеется дата учета, которая должна вводиться пользователем. Пакетное задание выполняет все необходимые изменения и создает операции стоимости с датой учета, введенной в форму запроса. Предлагаемая дата учета — текущая дата.  

### <a name="version-370b40"></a>Версия 3.70.B..4.0  
 В форме запроса пакетного задания корректировки себестоимости запасов имеется дата учета операции закрытого периода, которая должна вводиться пользователем. Пакетное задание выполняет все необходимые изменения и создает операции стоимости с датой учета родительской операции книги товаров (дата отгрузки продажи, для которой выполняется корректировка). Если дата учета родительской операции книги товаров не находится в допустимом диапазоне дат учета, дата учета, указанная как дата учета операции закрытого периода, будет назначена операции коррекции стоимости. Дата считается относящейся к закрытому периоду, если она раньше даты в поле "Разрешить учет с" в настройке ГК.  

### <a name="from-version-50"></a>С версии 5.0:  
 Больше не требуется указывать дату учета в запросе пакетного задания корректировки себестоимости запасов. Пакетное задание выполняет все необходимые изменения и создает операции стоимости с датой учета операции стоимости, которую оно корректирует. Если дата учета не находится в пределах допустимого диапазона дат учета, будет использована дата учета из поля "Разрешить учет с" в настройке ГК ИЛИ, если используются периоды учета запасов, будет использована более поздняя дата из этих двух. См. описанную концепцию выше.  

## <a name="history-of-post-inventory-cost-to-gl-batch-job"></a>История пакетного задания «Учет себест. запасов в ГК»  
 Пакетное задание «Учет себест. запасов в ГК» тесно связано с пакетным заданием «Коррекция себест. запасов», поэтому здесь также приводится история этого пакетного задания.  

### <a name="from-version-30370a"></a>С версии 3.0..3.70.A  
 В форме запроса пакетного «Учет себест. запасов в ГК» имеется дата учета, которая должна вводиться пользователем. Пакетное задание просматривает все операции стоимости в рамках фильтра (при наличии) и создает операции главной книги с датой учета, введенной в форму запроса.  

### <a name="version-370b40"></a>Версия 3.70.B..4.0  
 В форме запроса пакетного «Учет себест. запасов в ГК» предусмотрено поле даты учета операций закрытого периода. Приложение использует дату, введенную пользователем в это поле, в качестве даты учета для операций главной книги, которые она создает для операций стоимости, даты учета которых относятся к закрытым периодам учета. В противном случае операции ГК будут иметь ту же дату учета, что и исходные операции стоимости. Дата считается относящейся к закрытому периоду, если она раньше даты в поле "Разрешить учет с" в настройке ГК. При учете в Г\/К по группам учета операции главной книги будут иметь дату учета, которая указана в поле «Дата учета» в форме запроса.  

 В версиях 3 и 4 пакетное задание сканирует все операции стоимости для определения, имеются ли какие-либо операции стоимости, в котором сумма себестоимости (факт) отличается от стоимости, учтенной в ГК. Если обнаружено различие, отличающаяся сумма будет учтена в операции ГК. Если используется учет ожидаемой себестоимости, то соответствующие поля обрабатываются таким же образом.  

![Фактическая и ожидаемая себестоимость](media/helene/TechArticleAdjustcost14.png "Фактическая и ожидаемая себестоимость")

### <a name="from-version-50"></a>С версии 5.0:  
 Больше не требуется указывать дату учета в запросе пакетного задания «Учет себест. запасов в ГК». Операция ГК создается с той же датой учета, что и связанная операция стоимости. Чтобы выполнить пакетное задание, допустимый диапазон дат учета должен разрешать дату учета созданной операции ГК. В противном случае разрешенный диапазон дат учета должен быть временно повторно открыт путем изменения или удаления дат в полях «Разрешить учет с» и «Разрешить учет по» в настройке ГК. Во избежание проблем выверки необходимо, чтобы дата учета операции ГК соответствовала дате учета операции стоимости.  

 Пакетное задание просматривает таблицу 5811 — Учет операции стоимости в ГК для выявления операций стоимости, входящих в область действия для учета в главной книге. После успешного выполнения таблица очищается.

## <a name="see-also"></a>См. также  
[Сведения о проектировании: себестоимость запасов](design-details-inventory-costing.md)  
[Сведения о проектировании: применение товара](design-details-item-application.md)  
