---
title: Планирование автоматического выполнения работ | Документация Майкрософт
description: Запланированные задания обрабатываются очередью работ. Эти работы выполняют отчеты и модули Codeunit. В настройках можно указать однократное или периодически повторяющееся выполнение работы.
author: edupont04
ms.service: dynamics365-business-central
ms.topic: article
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: ''
ms.date: 10/01/2020
ms.author: edupont
ms.openlocfilehash: 5e8c611ed5d542436f470781c92d17095ecd1f5d
ms.sourcegitcommit: ddbb5cede750df1baba4b3eab8fbed6744b5b9d6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2020
ms.locfileid: "3924582"
---
# <a name="use-job-queues-to-schedule-tasks"></a>Использование очередей работ для планирования задач

Очереди работ в [!INCLUDE[d365fin](includes/d365fin_md.md)] позволяют пользователям планировать и создавать определенные отчеты, а также запускать модули codeunit. В настройках можно указать однократное или периодически повторяющееся выполнение работы. Например, вы можете захотеть запускать отчет **Статистика продаж * менеджера** еженедельно, чтобы отслеживать продажи по продавцам каждую неделю, или вы можете запускать модуль codeunit **Делегировать запросы на утверждение** ежедневно, чтобы предотвратить накопление документов или блокировку рабочего иным образом.

На странице **Операции очереди работ** перечисляются все существующие работы. При добавлении новой записи очереди заданий, которую нужно запланировать, необходимо указать сведения о типе объекта, который должен запускаться, например отчет или кодовая единица,а также имя и код объекта, который необходимо запустить. Можно также добавлять параметры для определения поведения операции очереди заданий. Например, можно добавить параметр, чтобы только отправить учтенные заказы на продажу. У вас должны быть права на запуск указанного отчета или модуля codeunit, в противном случае при выполнении очереди работ будет возвращена ошибка.  

Очередь заданий может состоять из большого количества операций, представляющих собой задания, которыми управляет очередь и запускает их. Информация в записи определяет, какой отчет или модуль codeunit выполняется, как часто и когда запускается запись, в какой категории запускается задача и каким образом.  

## <a name="to-set-up-background-posting-with-job-queues"></a>Настройка фонового учета с очередями работ

Очереди заданий — это эффективный инструмент для фонового планирования хода бизнес-процессов, например когда несколько пользователей пытаются выполнить учет заказов на продажу, но только один заказ может обрабатываться одновременно.  

В следующей процедуре объясняется, как настроить фоновый учет для заказов на продажу. Действия для покупки аналогичны.  

1. Выберите значок ![Лампочка, которая открывает функцию "Что вы хотите сделать"](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Настройка модуля "Продажи и дебитор. задолж."**, затем выберите соответствующую ссылку.
2. На странице **Пакетный учет возвратов продажи** установите флажок **Разнести в очереди работ**.
3. Выберите поле **Код категории очереди работ** и укажите код **SALESPOST**.

    > [!NOTE]
    > Некоторые задания изменяют одни и те же данные и не должны выполняться одновременно, поскольку это может привести к конфликтам. Например, фоновые задания для документов продаж будут пытаться изменить одни и те же данные одновременно. Категории очередей заданий помогают предотвратить подобные конфликты, чтобы при выполнении одного задания другое задание, принадлежащее к той же категории, не запускалось до завершения первого. Например, задание, принадлежащее к категории очереди заданий продаж, будет ожидать завершения всех остальных заданий, связанных с продажами. Категория очереди заданий указывается на экспресс-вкладке **Фоновый учет** на странице **Настройка модуля "Продажи и дебитор. задолж."**.
    >
    > [!INCLUDE[d365fin](includes/d365fin_md.md)] предоставляет категории очереди заданий для продаж, закупок и учета в главной книге. Мы рекомендуем всегда указывать одну из них или ту, которую вы создадите. Если у вас возникли сбои из-за конфликтов, рассмотрите возможность установки категории для всех продаж, покупок и фонового учета в Главной книге.

    Если необходимо также печатать документы продажи при их учете, установите флажок **Разнести и распечатать в очереди работ** на странице **Настройка модуля "Продажи"**.  

    > [!IMPORTANT]  
    > Если настроена работа, которая будет учитывать и печатать документы, и при отправке документа на печать принтер открывает диалоговое окно, например запрос для учетных данных или предупреждение о низком уровне чернил, то данный документ учитывается, но не печатается. Соответствующая операция очереди работ в конечном итоге истекает, и в поле **Статус** задается **Ошибка**. Соответственно, рекомендуется не использовать настройку принтера, требующую взаимодействия с отображаемыми диалоговыми окнами печати в сочетании с фоновым учетом.

    В следующий раз при разноске торговых документов [!INCLUDE [prodshort](includes/prodshort.md)] автоматически создает запись в очереди заданий для каждого документа и запускает задания в фоновом режиме, одно за другим.

4. Чтобы убедиться, что очередь заданий работает как ожидалось, выполните учет заказа на продажу. Дополнительные сведения см. в разделе [Продажа продукции](sales-how-sell-products.md).

5. Проверьте на странице **Операции журнала очереди работ**, был ли заказ продажи учтен успешно. Дополнительные сведения см. в разделе [Просмотр состояния или ошибок в очереди работ](admin-job-queues-schedule-tasks.md#to-view-status-or-errors-in-the-job-queue).

## <a name="to-create-a-job-queue-entry-for-batch-posting-of-sales-orders"></a>Создание записи очереди заданий для фонового учета заказов на продажу

Кроме того, можно отложить учет на время, удобное для вашей организации. Например, может иметь смысл для бизнеса выполнять некоторые процедуры после ввода большинства данных за день. Для этого настройте очередь работ для выполнения различных отчетов по пакетному учету, например **Пакет. учет заказов продажи**, **Пакет. учет счетов продажи** и аналогичные отчеты. [!INCLUDE[d365fin](includes/d365fin_md.md)] поддерживает фоновый учет для всех документов на продажи, покупки и сервис.

Ниже приводится процедура настройки отчета **Пакет. учет заказов продажи** для автоматического учета заказов на продажу в 16:00 по будним дням.  

1. Выберите значок ![Лампочка, которая открывает функцию "Что вы хотите сделать"](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Операции очереди работ**, затем выберите соответствующую ссылку.  
2. Выберите действие **Создать**.  
3. В поле **Тип запускаемого объекта** выберите **Отчет**.  
4. В поле **Номер запускаемого объекта** выберите 296, **Пакет. учет заказов продажи**.

   При этом можно также пользоваться следующими отчетами:
  
   * 900 **Групповая разноска заказов на сборку**
   * 497 **Пакет. учет счетов покупки**
   * 496 **Пакет. учет заказов на покупку**
   * 498 **Пакет. учет кредит-нот покупки**
   * 6665 **Пакетный учет возвратов покупки**
   * 298 **Пакет. учет кредит-нот продажи**
   * 297 **Пакет. учет счетов продажи**
   * 296 **Пакет. учет заказов продажи**
   * 6655 **Пакетный учет возвратов продажи**
   * 6005 **Пакетный учет сервисных кредит-нот**
   * 6004 **Пакетный учет сервисных счетов**
   * 6001 **Пакетный учет сервисных заказов**

5. Установите флажок **Страница запроса отчета**.
6. На странице запроса **Пакет. учет заказов продажи** укажите, что включено в процессе автоматического учета заказов на продажу, затем нажмите кнопку **ОК**.

    > [!IMPORTANT]
    > Не забудьте установить строгие фильтры; в противном случае [!INCLUDE [prodshort](includes/prodshort.md)] учтет все документы, даже если они не готовы. Рассмотрите возможность установки фильтра по полю **Состояние** для значения *Выпущенные*, и фильтр по полу **Дата учета** для значения *..сегодня*. Дополнительные сведения см. в разделе [Сортировка, поиск и фильтрация](ui-enter-criteria-filters.md).
7. Установите все флажки от **Запускать по понедельникам** до **Запускать по пятницам**.
8. В поле **Время начала** введите 16:00.
9. Выберите действие **Установить статус "Готово"**.

Заказы на продажу, которые удовлетворяют заданным фильтрам, теперь будут учитываться каждый будний день в 16:00.

> [!NOTE]
> Если очередь заданий не может выполнить учет заказа на продажу, статус меняется на **Ошибка**, и заказ на продажу добавляется в список заказов, которые пользователь должен обработать вручную. Дополнительные сведения см. в разделе [Просмотр состояния или ошибок в очереди работ](admin-job-queues-schedule-tasks.md#to-view-status-or-errors-in-the-job-queue).

После того как очереди заданий настроены и работают, статус может изменяться в пределах каждого повторяющегося периода, как указано ниже:

* **На удержании**  
* **Готово**  
* **В работе**  
* **Ошибка**  
* **Завершен**  

После успешного выполнения задания оно будет удалено из списка операций очереди заданий, если только это задание не является повторяющимся. Если это повторяющаяся работа, поле **Самая ранняя дата/время начала** показывает, когда ожидается следующий запуск задания.  

## <a name="to-view-status-or-errors-in-the-job-queue"></a>Просмотр состояния или ошибок в очереди работ
Данные, произведенные при выполнении очереди заданий, хранятся в базе данных, чтобы можно было устранить ошибки очереди работ.

### <a name="to-view-status-for-any-job"></a>Просмотр статуса любого задания
1. Выберите значок ![Лампочка, которая открывает функцию "Что вы хотите сделать"](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Операции очереди работ**, затем выберите соответствующую ссылку.
2. На странице **Операции очереди работ**, выберите запись очереди заданий, затем выберите действие **Операции журнала**.  

### <a name="to-view-status-from-a-sales-or-purchase-document"></a>Просмотр статуса из документа продажи или покупки
1. Из документа. который вы пытались учесть с помощью фонового учета, выберите поле **Статус очереди работ**, которое будет содержать значение **Ошибка**.
2. Просмотрите сообщение об ошибке и устраните проблему.

## <a name="the-my-job-queue-part"></a>Часть "Моя очередь работ"
Часть **Моя очередь работ** в вашем ролевом центре показывает операции очереди заданий, которые вы запустили, но они еще не завершены. По умолчанию часть не видна, поэтому ее следует добавить в ролевой центр. Дополнительные сведения см. в разделе [Персонализация рабочей области](ui-personalization-user.md).  

В этой части отображается, какие документы с вашим кодом в поле **Код исполнителя** обрабатываются или помещены в очередь, включая те, которые связаны с фоновой обработкой. По этой части можно быстро понять, произошла ли ошибка при учете документа и есть ли ошибки в записи очереди заданий. Эта часть также позволяет отменить учет документа, если он не запущен.

### <a name="to-view-an-error-from-the-my-job-queue-part"></a>Просмотр ошибки из части "Моя очередь работ"
1. Для операции со статусом **Ошибка** выберите действие **Показать ошибку**.
2. Просмотрите сообщение об ошибке и устраните проблему.

## <a name="security"></a>Безопасность  
Записи очередь работ запускаются на основе прав. Эти права доступа должны разрешать выполнение данного отчета или модуля Codeunit.  

При активации очереди заданий вручную используются учетные данные пользователя. При активации очереди работ в качестве запланированного задания она запускается с учетными данными экземпляра сервера. При выполнении задания используются учетные данные очереди заданий, в которой оно активируется. Пользователь, который создал эту операцию очереди заданий, также должен иметь права доступа. Когда работа "выполняется во время сеанса пользователя" (например, в фоновом учете), используются учетные данные пользователя, создавшего эту работу.  

> [!IMPORTANT]  
> Если используется набор прав доступа SUPER, который поставляется с [!INCLUDE[d365fin](includes/d365fin_md.md)], данный пользователь и другие пользователи имеют права на запуск всех объектов. В этом случае доступ каждого пользователя ограничен только правами доступа к данным.  

## <a name="using-job-queues-effectively"></a>Эффективное использование очереди работ  
Запись операции очереди заданий имеет множество полей, которые предназначены для переноса параметров в модуль codeunit, который был указан для запуска с использованием очереди заданий. Это также означает, что модули codeunit, которые необходимо выполнить с помощью очереди работ, должны быть заданы записью операции очереди заданий в качестве параметра в триггере **OnRun**. Это помогает обеспечить дополнительную безопасность, поскольку не позволяет пользователю выполнять случайные модули codeunit с помощью очереди работ. Если пользователь должен пересылать параметры в отчет, единственный способ — отправить исполнение отчета в модуль, которое затем анализирует параметры ввода и вносит их в отчет перед его выполнением.  

## <a name="scheduling-synchronization-between-d365fin-and-d365fin"></a>Планирование синхронизации между [!INCLUDE[d365fin](includes/d365fin_md.md)] и [!INCLUDE[d365fin](includes/cds_long_md.md)]

Если вы интегрировали [!INCLUDE[d365fin](includes/d365fin_md.md)] с [!INCLUDE[d365fin](includes/cds_long_md.md)], вы можете использовать очередь заданий для планирования, если нужно синхронизировать записи, которые связаны между двумя бизнес-приложениями. В зависимости от направления и правил, которые вы определили для интеграции, задания синхронизации могут также создавать новые записи в целевом приложении, чтобы они соответствовали записям в источнике. Например, если продавец создает новый контакт в [!INCLUDE[crm_md](includes/crm_md.md)], задание синхронизации может создать этот же контакт для связанного продавца в [!INCLUDE[d365fin](includes/d365fin_md.md)]. Дополнительные сведения см. в разделе [Планирование синхронизации между Business Central и Dynamics 365 Sales](admin-scheduled-synchronization-using-the-synchronization-job-queue-entries.md).

## <a name="see-also"></a>См. также

[Администрация](admin-setup-and-administration.md)  
[Настройка Business Central](setup.md)  
[Изменение базовых настроек](ui-change-basic-settings.md)  
