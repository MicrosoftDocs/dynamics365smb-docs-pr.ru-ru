---
title: Планирование автоматического выполнения работ
description: 'Узнайте, как использовать операции очереди заданий для запуска отчетов и модулей Codeunit.'
author: brentholtorf
ms.author: bholtorf
ms.reviewer: jswymer
ms.topic: conceptual
ms.date: 09/15/2023
ms.custom: bap-template
ms.search.form: '672, 673, 674, 671'
---
# Использование очередей заданий для планирования задач

Используйте страницу **Операции очереди заданий**, чтобы планировать и запускать определенные отчеты, а также модули codeunit. В настройках можно указать однократное или периодически повторяющееся выполнение работы. Например, вы можете запускать отчет **Статистика продаж * менеджера** еженедельно, чтобы отслеживать продажи по продавцам каждую неделю, или вы можете запускать модуль codeunit **Делегировать запросы на утверждение** ежедневно, чтобы предотвратить накопление документов.

На странице Операции очереди работ перечисляются все существующие работы. Если вы добавляете новую операцию очереди заданий, которая будет выполняться по расписанию, вы должны предоставить некоторую информацию. Например:

* Тип объекта, который нужно выполнить, например отчет или модуль codeunit. У вас должно быть разрешение на запуск определенного отчета или codeunit.
* Имя и ИД объекта.
* Параметры для определения поведения записи очереди заданий. Например, можно добавить параметр, чтобы только отправить учтенные заказы на продажу.
* Когда и как часто будет запускаться запись очереди заданий.

> [!IMPORTANT]  
> Если вам назначен набор разрешений SUPER, который входит в комплект [!INCLUDE[prod_short](includes/prod_short.md)], у вас есть разрешение на запуск всех объектов, входящих в вашу лицензию. Если у вас роль делегированного администратора, вы можете создавать и планировать операции очереди работ, но запускать их могут только администраторы и лицензированные пользователи.

После того как очереди заданий настроены и работают, статус может изменяться в пределах каждого повторяющегося периода, как указано ниже:

* **На удержании**  
* **Готово**  
* **В работе**  
* **Ошибка**  
* **Завершен**  
* **На удержании из-за неактивности**

> [!NOTE]
> Статус **На удержании из-за неактивности** используется главным образом для тех операций очереди заданий, которые планируют сихронизацию между [!INCLUDE [prod_short](includes/prod_short.md)] и другим приложением, например [!INCLUDE [cds_long_md](includes/cds_long_md.md)]. Подробнее об этом статусе см. в статье [О таймаутах неактивности](/dynamics365/business-central/admin-scheduled-synchronization-using-the-synchronization-job-queue-entries#about-inactivity-timeouts).

После успешного выполнения задания оно будет удалено из очереди, если только это задание не является повторяющимся. Если это повторяющееся задание, в поле **Самая ранняя дата/время начала** будет показано, когда будет следующий запуск задания. 

## Важные замечания о планировании повторяющихся заданий

> [!IMPORTANT]  
> Очереди повторяющихся заданий могут отрицательно влиять на производительность, поэтому не следует запускать их слишком часто. Когда вы настраиваете периодичность выполнения повторяющегося задания, постарайтесь установить максимально возможный временной интервал. Например, если вы собираетесь установить периодичность в пять минут, подумайте, нельзя ли использовать 15 минут ил даже один раз в час. При планировании очередей повторяющихся заданий учитывайте, на какие области приложения это задание повлияет. Работает ли в этой области много пользователей, и не повлияет ли на выполнение задания высокая активность? Учитывайте продолжительность выполнения одного задания и бизнес-мотивацию выполнения заданий с заданной периодичностью.

## Самая ранняя дата начала

Значение в поле **Самые ранние дата/время начала** на странице **Карточка записи очереди заданий** показывает следующее время, когда задание будет запущено. Существует несколько факторов, которые могут повлиять на то, будет ли запись в очереди заданий действительно выполняться в это время.

Наиболее распространенными факторами являются количество записей очереди заданий в среде и общее количество запланированных задач. Для защиты уровня производительности существуют эксплуатационные ограничения. Если в очереди много записей и, например, одна из них завершилась сбоем или записи занимают больше времени, чем ожидалось, следующее задание может не запуститься в ожидаемое время. Если у вас есть модули Codeunits, генерирующие 100 000 или более запланированных задач, вам следует выяснить, действительно ли вам нужны все эти задачи. Вы можете получить доступ к списку всех запланированных задач на странице **Запланированные задачи**.

Чтобы узнать больше о мониторинге состояния записей очереди заданий, перейдите по ссылке [Чтобы просмотреть состояние любого задания](#to-view-status-for-any-job). Чтобы узнать больше об эксплуатационных ограничениях, перейдите к разделу [Ограничения асинхронных задач](/dynamics365/business-central/dev-itpro/administration/operational-limits-online#Task).

## Отслеживание состояния или ошибок в очереди заданий

Данные, произведенные при выполнении очереди заданий, хранятся в базе данных, чтобы можно было устранить ошибки.  

Для каждой записи очереди заданий вы можете просмотреть и изменить статус. При создании записи очереди работ она будет иметь статус **На удержании**. Можно установить состояние **Готово** и затем вернуть, например, состояние **На удержании**. В противном случае сведения о состоянии обновляются автоматически.

В следующей таблице описываются значения поля **Статус**.

| Состояние | Описание |
|--|--|
| Готово | Задание в очереди готово к запуску. |
| В работе | Задание в очереди выполняется. Это поле обновляется, когда выполняется очередь заданий. |
| На удержании | Статус задания в очереди по умолчанию, когда оно создается. Выберите действие **Установить статус Готово** для изменения статуса на **Готово**. Выберите действие **Поставить на удержание**, чтобы вернуть статус **На удержании**. |
| Ошибка | Произошла ошибка. Выберите **Показать ошибку** для просмотра сообщения об ошибке. |
| Завершенные | Задание в очереди завершено. |

> [!Tip]  
> Выполнение заданий в очереди прекращается при возникновении ошибки. Например, это может быть проблемой при подключении к внешней службе, например к банковским данным. Если служба временно недоступна и задание в очереди не может подключиться к ней, появится сообщение об ошибке, а выполнение прекратится. Вам придется вручную перезапустить задание в очереди. Тем не менее этой ситуации можно попробовать избежать с помощью полей **Максимальное кол-во попыток запуска** и **Задержка перед повторным запуском (с)** . В поле **Максимальное кол-во попыток запуска** можно указать, сколько раз нужно перезапускать задание в случае сбоев. В поле **Задержка перед повторным запуском (с)** указывается время между попытками перезапуска в секундах. Комбинация этих двух полей может перезапускать задание в очереди, пока внешняя служба не станет доступной.

### Просмотр статуса любого задания

1. Выберите ![Лампочка, которая открывает функцию Что вы хотите сделать.](media/ui-search/search_small.png "Что вы хотите сделать") значок, введите **Операции очереди работ**, а затем выберите связанную ссылку.
2. На странице **Операции очереди работ**, выберите запись очереди заданий, затем выберите действие **Операции журнала**.  

> [!TIP]
> Для более глубокого анализа на основе телеметрии вы также можете просмотреть состояние операций очереди заданий, используя Application Insights в Microsoft Azure. Чтобы узнать больше о телеметрии, перейдите к разделам [Мониторинг и анализ телеметрии](/dynamics365/business-central/dev-itpro/administration/telemetry-overview) и [Анализ телеметрии трассировки жизненного цикла очереди заданий](/dynamics365/business-central/dev-itpro/administration/telemetry-job-queue-lifecycle-trace).

## Просмотр запланированных задач

На странице **Запланированные задачи** в [!INCLUDE [prod_short](includes/prod_short.md)] показано, какие задачи готовы к запуску в очереди заданий. На странице также отображается информация о компании, в которой настроено выполнение каждой задачи. Однако могут выполняться только задачи, отмеченные как принадлежащие к текущей среде.  

Например, все запланированные задания останавливаются, если компания находится в среде, которая является копией другой среды. Используйте страницу **Запланированные задачи**, чтобы задать, какие задачи готовы к запуску в очереди заданий.  

> [!NOTE]
> Внутренние администраторы и лицензированные пользователи могут планировать запуск задач. Делегированные администраторы могут настраивать и планировать запуск задач, но запускать их могут только лицензированные пользователи.

## Часть "Моя очередь заданий"

Раздел **Моя очередь работ** в вашем ролевом центре показывает операции очереди заданий, которые вы запустили, но они еще не завершены. По умолчанию раздел не виден, но вы можете добавить его в ролевой центр. Дополнительные сведения о персонализации можно найти в разделе [Персонализация рабочей области](ui-personalization-user.md).  

Раздел содержит следующую информацию:

* Какие документы с вашим кодом в поле **Код исполнителя** обрабатываются или помещены в очередь, включая те, которые связаны с фоновой обработкой. 
* Происходили ли ошибки при учете документов или выполнении заданий из очереди. 

Раздел "Моя очередь заданий" также позволяет отменить учет документа.

### Просмотр ошибки из части "Моя очередь работ"

1. Для операции со статусом **Ошибка** выберите действие **Показать ошибку**.
2. Просмотрите сообщение об ошибке и устраните проблему.

## Примеры того, что можно запланировать с помощью операций очереди заданий

### Планирование отчетов

Можно запланировать выполнение отчета или пакетного задания на заданную дату и время. Запланированные отчеты и пакетные задания вводятся в очередь заданий и обрабатываются в запланированное время, как и другие задания. После выбора действия **Отправить** необходимо выбрать вариант **Запланировать**, а затем ввести такую информацию, как принтер, время и дата, а также повторение.  

Дополнительные сведения о планировании см. в разделе [Планирование выполнения отчета](ui-work-report.md#ScheduleReport)

### Планирование синхронизации между [!INCLUDE[prod_short](includes/prod_short.md)] и [!INCLUDE[prod_short](includes/cds_long_md.md)]

Если вы интегрировали [!INCLUDE[prod_short](includes/prod_short.md)] с [!INCLUDE[prod_short](includes/cds_long_md.md)], очередь заданий позволяет запланировать синхронизацию данных. В зависимости от направления и правил, которые вы определили, задание в очереди может создавать записи в одном приложении для соответствия записям в другом. Хороший пример — при регистрации контакта в [!INCLUDE[crm_md](includes/crm_md.md)] задание в очереди может автоматически настроить контакт в [!INCLUDE[prod_short](includes/prod_short.md)]. Дополнительные сведения о планировании см. в разделе [Планирование синхронизации между Business Central и Dynamics 365 Sales](admin-scheduled-synchronization-using-the-synchronization-job-queue-entries.md).

### Планирование даты и времени учета заказов на продажу и покупку

Очередь заданий можно использовать для планирования запуска бизнес-процессов в фоновом режиме. Например, фоновые задания удобны, если несколько пользователей пробуют одновременно разместить заказы на продажу, но только один заказ может обрабатываться одновременно. Чтобы узнать больше о фоновом учете, перейдите к разделу [Настройка фонового учета с очередями заданий](ui-batch-posting.md#to-set-up-background-posting-with-job-queues).

## Обработка проблем с операциями очереди заданий

Если для операции очереди заданий показана ошибка, первым способом решения проблемы является перезапуск операции очереди заданий. Вы можете установить статус операции очереди заданий на **Приостановлено**, а затем на **Готово** или просто перезапустить ее.

Если перезапуск не помогает, проблема может быть в коде. Вы можете найти владельца (также называемого *издателем*) кода в трассировке стека AL в журнале очереди заданий. Если ошибка возникает из-за приложения/расширения, обратитесь к своему партнеру Microsoft. Если ошибка исходит из приложения Microsoft, откройте запрос в службу поддержки Microsoft.

Если вы обращаетесь к своему партнеру Microsoft или в Microsoft за поддержкой, предоставьте следующую информацию:

* ИД выполнения операции очереди заданий, в которой произошла ошибка
* Временная метка, когда произошла ошибка
* Ваш часовой пояс

> [!TIP]
> В зависимости от того, является ли ваша версия [!INCLUDE [prod_short](includes/prod_short.md)] более ранней или более поздней, чем версия 22.1, соберите информацию следующими способами:
>
> * Для более ранних версий предоставьте снимок экрана страницы **Операции журнала очереди заданий**.
> * Для более поздних версий используйте действие **Копировать сведения** на странице "Операции журнала очереди заданий", чтобы скопировать информацию (идентификатор очереди заданий, метку времени и часовой пояс).

## Мониторинг очереди заданий с помощью телеметрии

Администраторы могут использовать [Azure Application Insights](/azure/azure-monitor/app/app-insights-overview) для сбора и анализа телеметрии, которую можно использовать для выявления проблем. Чтобы узнать больше о телеметрии, перейдите к разделам [Мониторинг и анализ телеметрии](/dynamics365/business-central/dev-itpro/administration/telemetry-overview) и [Анализ телеметрии трассировки жизненного цикла очереди заданий](/dynamics365/business-central/dev-itpro/administration/telemetry-job-queue-lifecycle-trace).

Телеметрия позволяет администраторам настраивать оповещения о проблемах с очередью заданий, которые отправляют текстовое сообщение, электронное письмо или сообщение в Teams, если возникнет проблема. Чтобы узнать больше об этих оповещениях, перейдите в раздел [Оповещения о телеметрии](/dynamics365/business-central/dev-itpro/administration/telemetry-alert).

## См. также

[Администрация](admin-setup-and-administration.md)  
[Настройка Business Central](setup.md)  
[Изменение базовых параметров](ui-change-basic-settings.md)  
[Анализ телеметрии трассировки жизненного цикла очереди заданий](/dynamics365/business-central/dev-itpro/administration/telemetry-job-queue-lifecycle-trace)  
[Оповещение о телеметрии](/dynamics365/business-central/dev-itpro/administration/telemetry-alert)

[!INCLUDE[footer-include](includes/footer-banner.md)]
