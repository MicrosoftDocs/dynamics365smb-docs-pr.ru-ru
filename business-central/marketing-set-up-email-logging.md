---
title: Настройка регистрации электронной почты | Документация Майкрософт
description: Узнайте, как превратить взаимодействие по электронной почте между продавцами и клиентами в реальные возможности продаж.
author: bholtorf
ms.service: dynamics365-business-central
ms.topic: article
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: relationship, prospect, opportunity, email
ms.date: 10/01/2020
ms.author: bholtorf
ms.openlocfilehash: f099072561e5a35f893a42edbbe6f27a5b4722ed
ms.sourcegitcommit: 2e7307fbe1eb3b34d0ad9356226a19409054a402
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "4749809"
---
# <a name="track-email-message-exchanges-between-salespeople-and-contacts"></a>Отслеживание обмена сообщениями электронной почты между продавцами и контактами

Получите больше от общения между продавцами и вашими существующими или потенциальными клиентами, отслеживая обмен сообщениями электронной почты, затем превращая их в реальные возможности. [!INCLUDE[prod_short](includes/prod_short.md)] может работать с Exchange Online, чтобы вести журнал входящих и исходящих сообщений. Вы можете просматривать и анализировать содержимое каждого сообщения на странице **Журналы взаимодействий**.

## <a name="set-up-public-folders-and-rules-for-email-logging-in-exchange-online"></a>Настройка общих папок и правил для регистрации электронной почты в Exchange Online

[!INCLUDE[admin-setup-email-public-folder](includes/admin-setup-email-public-folder.md)]

Далее вы подключаете [!INCLUDE[prod_short](includes/prod_short.md)] с Exchange Online.

## <a name="setting-up-prod_short-to-log-email-messages"></a>Настройка [!INCLUDE[prod_short](includes/prod_short.md)] для регистрации сообщений электронной почты

Начните работать с регистрацией электронной почты за два простых шага:

1. Соедините [!INCLUDE[prod_short](includes/prod_short.md)] с Exchange Online для подписки Microsoft 365. Exchange Online обрабатывает ваши сообщения электронной почты. Мы упростили этот шаг, предоставив мастер настройки. Вам просто нужны ваши учетные данные администратора для вашей учетной записи администратора в Microsoft 365. Чтобы запустить руководство, выберите **Мастер настройки**, затем выберите **Настройка регистрации электронной почты**.  

2. Убедитесь, что действительные адреса электронной почты были введены в [!INCLUDE[prod_short](includes/prod_short.md)] для ваших продавцов и контактов, в зависимости от того, являются ли они потенциальными или существующими клиентами. Для этого для каждого клиента или продавца откройте карточку **Контакт** или **Менеджер по продажам/закупкам** и посмотрите в поле **Адрес эл. почты**.

> [!Tip]
> После выполнения шагов в руководстве вы можете проверить, было ли соединение успешным. Выполните поиск **Настройка модуля "Маркетинг"**, выберите **Процесс**, затем **Функции**, потом **Проверить настройку регистрации эл. почты**.

## <a name="viewing-email-message-exchanges-in-the-interaction-log"></a>Просмотр обмена сообщениями электронной почты в журнале взаимодействия
[!INCLUDE[prod_short](includes/prod_short.md)] создает запись на странице **Журнал взаимодействия** каждый раз, когда продавец и контакт обмениваются сообщениями электронной почты. Чтобы просмотреть журнал взаимодействия, откройте карточку **Контакт** или **Менеджер по продажам/закупкам** для человека, затем выберите **История**, затем выберите **Журналы взаимодействий**. Есть несколько вещей, которые мы можем сделать с каждой записью в журнале, например:

- Просмотрите содержимое сообщения электронной почты, которым обменялись собеседники, нажав действие **Показать вложения**.
- Превратите обмен электронной почтой в возможность продажи — если запись выглядит многообещающей, вы можете превратить ее в возможность, а затем управлять ее продвижением к продаже. Для этого выберите запись, затем выберите действие **Создать возможность**. Дополнительные сведения см. в разделе [Управление возможностями продаж](marketing-manage-sales-opportunities.md).

## <a name="connecting-on-premises-versions-to-microsoft-exchange"></a>Подключение локальных версий к Microsoft Exchange
Вы можете подключить локальную версию [!INCLUDE[prod_short](includes/prod_short.md)] к локальной версии Exchange On-Premises или Exchange Online для регистрации электронной почты. Для обеих версий Exchange настройки подключения доступны на странице **Настройка модуля "Маркетинг"**. Для Exchange Online вы также можете воспользоваться мастером настройки. 

### <a name="connecting-to-exchange-on-premises"></a>Подключение к Exchange On-Premises
Для подключения [!INCLUDE[prod_short](includes/prod_short.md)] On-Premises к Exchange On-Premises на странице **Настройка модуля "Маркетинг"** вы можете использовать **Базовый** как **Тип аутентификации**, затем введите учетные данные для учетной записи пользователя для Exchange On-Premises. Затем включите переключатель **Включено**, чтобы начать регистрацию электронной почты. 

### <a name="connecting-to-exchange-online"></a>Подключение к Exchange Online
Чтобы подключиться к Exchange Online, вы должны использовать **OAuth2** как **Тип аутентификации**. Вы также должны зарегистрировать приложение в Azure Active Directory и указать идентификатор приложения, секретный ключ хранилища и используемый URL-адрес перенаправления. URL-адрес перенаправления предварительно заполнен и должен работать для большинства установок. Дополнительные сведения см. в разделе [Регистрация приложения в Azure AD для подключения из Business Central к Exchange Online](marketing-set-up-email-logging.md#to-register-an-application-in-azure-ad-for-connecting-from-business-central-to-exchange-online). 

Вы должны настроить вашу установку на использование HTTPS. Для получения дополнительной информации см. [Настройка SSL для защиты подключения веб-клиента Business Central](/dynamics365/business-central/dev-itpro/deployment/configure-ssl-web-client-connection). Если вы настраиваете на своем сервере другую начальную страницу, вы можете изменить URL-адрес. Секрет клиента будет сохранен как зашифрованная строка в вашей базе данных.

### <a name="to-register-an-application-in-azure-ad-for-connecting-from-business-central-to-exchange-online"></a>Чтобы зарегистрировать заявку в Azure AD для подключения из Business Central к Exchange Online
Следующие шаги предполагают, что вы используете Azure Active Directory, чтобы управлять удостоверениями и доступом. Дополнительные сведения см. в [Быстрый старт: зарегистрируйте приложение на платформе идентификации Microsoft](/azure/active-directory/develop/quickstart-register-app). Если вы не используете Azure Active Directory, см. [Использование другой службы управления удостоверениями и доступом](marketing-set-up-email-logging.md#using-another-identity-and-access-management-service). 

1. В Azure Portal, в пункте **Управление** выберите **Аутентификация**.
2. В пункте **URL-адрес перенаправления** добавьте URL-адрес перенаправления, который предлагается на страница **Настройка модуля "Маркетинг"** в [!INCLUDE[prod_short](includes/prod_short.md)]. Если URL-адрес перенаправления на странице настройки Marketing пуст, найдите предлагаемый URL-адрес перенаправления на странице **Настройка регистрации электронной почты**.

    > [!NOTE]
    > Если вы не укажете URL-адрес перенаправления, вы можете сделать это позже, выбрав **Добавить платформу**, затем выбрав **Интернет**, чтобы добавить веб-приложение и URL-адрес перенаправления. 

3. В разделе **Управление** выберите **Манифест**.
4. Найдите свойство **requiredResourceAccess** в манифесте и добавьте следующий код в скобках ([]), чтобы добавить требуемые разрешения. Дополнительные сведения см. в разделе [Регистрация приложения](/exchange/client-developer/exchange-web-services/how-to-authenticate-an-ews-application-by-using-oauth.md#register-your-application).

```
{
    "resourceAppId": "00000002-0000-0ff1-ce00-000000000000",
    "resourceAccess": [
        {
            "id": "3b5f3d61-589b-4a3c-a359-5dd4b5ee5bd5",
            "type": "Scope"
        },
        {
            "id": "dc890d15-9560-4a4c-9b7f-a736ec74ec40",
            "type": "Role"
        }
    ]
}
```

5. Выберите **Сохранить**.
6. В разделе **Управление** выберите **Разрешения API**, затем убедитесь, что указаны следующие разрешения:  

    * EWS.AccessAsUser.All
    * full_access_as_app

7. В **управлять** выберите **Сертификаты и секреты**, а затем создайте новый секрет для вашего приложения. Вы будете использовать секрет в [!INCLUDE[prod_short](includes/prod_short.md)], в поле **Секрет клиента** на странице **Настройка модуля "Маркетинг"** или сохраните его в безопасном хранилище и предоставьте его в подписчике события.
8. Выберите **обзор**, а затем найдите значение **Код приложения (клиента)**. Это код клиента вашего приложения. Вы должны ввести его либо на страница **Настройка модуля "Маркетинг"**, в поле **Код клиента** или сохранить его в безопасном хранилище и предоставить его подписчику события.
9. В [!INCLUDE[prod_short](includes/prod_short.md)] настройте регистрацию электронной почты на странице **Настройка модуля "Маркетинг"** или используйте мастер **Настройка регистрации электронной почты** для помощи в процессе.
    * Укажите учетную запись электронной почты пользователя, от имени которого запланированное задание будет подключаться к Exchange Online и обрабатывать сообщения электронной почты. У пользователя должна быть действующая лицензия на Exchange Online.
    * Укажите URL-адрес вашего Exchange Online. Обычно это домен, который вы указали в адресе электронной почты пользователя.
    * Укажите **Путь к папке очереди** и **Путь к папке хранения**.
10. Чтобы начать регистрацию электронной почты, включите переключатель **Включено**.
11. Войдите в систему с учетной записью администратора для Azure Active Directory (эта учетная запись должна иметь действующую лицензию для Exchange и быть администратором в вашем Exchange Online). После входа в систему вам будет предложено разрешить зарегистрированному приложению войти в Exchange Online от имени организации. Вы должны дать согласие на завершение установки.

   > [!NOTE]
   > Если вам не предлагается войти в систему с учетной записью администратора, возможно, это связано с блокировкой всплывающих окон. Чтобы войти, разрешите всплывающие окна от https://login.microsoftonline.com.

### <a name="using-another-identity-and-access-management-service"></a>Использование другой службы управления удостоверениями и доступом
Если вы не используете Azure Active Directory для управления удостоверениями и доступом, вам потребуется помощь разработчика. Если вы предпочитаете хранить код приложения и секрет в другом месте, вы можете оставить поля «Код клиента» и «Секрет клиента» пустыми и написать расширение для получения кода и секрета из местоположения. Вы можете предоставить секрет во время выполнения, подписавшись на события OnGetEmailLoggingClientId и OnGetEmailLoggingClientSecret в codeunit 1641 "Настройка регистрации электронной почты".

### <a name="to-stop-logging-email"></a>Остановка регистрации электронной почты
1. Выберите значок ![Лампочка, которая открывает функцию "Что вы хотите сделать"](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Настройка модуля "Маркетинг"**, затем выберите соответствующую ссылку.
2. Выключите переключатель **Включено**.

## <a name="see-also"></a>См. также
[Управление отношениями](marketing-relationship-management.md)



[!INCLUDE[footer-include](includes/footer-banner.md)]