---
title: Создание рабочих процессов утверждения для соединения задач
description: 'Узнайте, как создавать рабочие потоки для соединения задач, выполняемых в бизнес-процессах разными пользователями.'
author: brentholtorf
ms.author: bholtorf
ms.reviewer: bholtorf
ms.topic: how-to
ms.date: 04/24/2023
ms.custom: bap-template
ms.service: dynamics-365-business-central
---
# <a name="create-workflows-to-connect-tasks-in-business-processes"></a>Создание рабочих процессов для соединения задач в бизнес-процессах

Вы можете создавать рабочие процессы, соединяющие задачи, выполняемые в бизнес-процессах разными пользователями. Системные задачи, такие как автоматический учет, могут включаться в качестве шагов рабочего процесса, предшествующих задачам пользователя или выполняемых после них. Типичные шаги рабочего процесса — запрос и выдача разрешения на создание новых записей.  

На странице **Рабочий процесс** создайте рабочий процесс, перечислив в строках его шаги. Каждый шаг состоит из триггера и отклика:

* Событие, определяющее условия запуска рабочего процесса.
* Отклик рабочего процесса, который определяет, что делает рабочий процесс.

[!INCLUDE[workflow](includes/workflow.md)]

При создании рабочих процессов можно скопировать шаги из существующих рабочих процессов из шаблонов рабочих процессов. Шаблоны рабочих процессов — это нередактируемые рабочие процессы, входящие в состав [!INCLUDE[prod_short](includes/prod_short.md)]. Идентификаторы шаблонов процессов имеют префикс "MS-", например "MS-PIW". Подробнее см. в разделе [Создание рабочих процессов из шаблонов рабочих процессов](across-how-to-create-workflows-from-workflow-templates.md).  

> [!NOTE]  
> Все уведомления о шагах потоков операций отправляются через очередь заданий. Убедитесь, что очередь заданий соответствует потребностям вашего бизнеса. Подробнее см. в разделе [Использование очередей работ для планирования задач](admin-job-queues-schedule-tasks.md).  

:::image type="content" source="media/Workflows/workflow-example.png" alt-text="Иллюстрация примера рабочего процесса.":::

Рабочий процесс делится на три раздела:

1. **Событие "когда"**  
   Здесь выбирается триггер.  
   Примеры триггера:
   * Запись основных данных изменена
   * Создана строка журнала
   * Входящий документ создается или выпускается
   * Запрошено утверждение документа
2. **При условии**  
   Эти **условия** связаны с событием и позволяют создавать фильтры, чтобы решить, как будет продолжаться рабочий процесс.
3. **Отклик "то"**  
   Эти **ответы** указывают следующие шаги в рабочем процессе.

Параметры для событий и откликов определены системой. Для добавления новых параметров вам потребуется разработать расширение.

## <a name="to-create-a-workflow"></a>Создание потока операций

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](media/ui-search/search_small.png "Что вы хотите сделать") введите **Рабочие процессы**, затем выберите связанную ссылку.  
2. Выберите действие **Создать**. Откроется страница **Рабочий процесс**.  
3. В поле **Код** введите не более 20 знаков для обозначения рабочего процесса.  
4. Для создания рабочего процесса из шаблона рабочего процесса на странице **Рабочий процесс** выберите действие **Создать рабочий процесс из шаблона**. Подробнее см. в разделе [Создание рабочих процессов из шаблонов рабочих процессов](across-how-to-create-workflows-from-workflow-templates.md).  
5. В поле **Описание** введите описание рабочего процесса.  
6. В поле **Категория** укажите категорию рабочего процесса.  
7. В поле **Событие "когда"** укажите событие, которое должно произойти для запуска этого шага рабочего процесса.  

   При выборе поля открывается страница **События рабочего процесса** со списком всех доступных событий рабочего процесса.  
8. В поле **При условии** укажите одно или несколько условий, которые должны быть соблюдены, чтобы произошло событие, указанное в поле **Событие "когда"**.  

   При выборе поля открывается страница **Условия события** со списком полей фильтрации, которые могут выступать в качестве условий для события. При желании вы можете добавить новые поля фильтрации.  

   Если событие рабочего процесса предназначено для изменения определенного поля в записи, используйте страницу **Условия события** для выбора поля и типа изменения.  

   1. Для указания изменения поля для события на странице **Условия события** в поле **Поле** выберите поле, которое изменяется.  
   2. В поле **Оператор** выберите **Уменьшено**, **Увеличено** или **Изменено**.  
9. В поле **Отклик "то"** укажите отклик, который последует при возникновении события рабочего процесса.  

   При выборе поля открывается страница **Отклики рабочего процесса** со списком всех доступных откликов рабочего процесса и параметров откликов.  
10. На экспресс-вкладке **Параметры для выбранного отклика** задайте параметры для отклика рабочего процесса, выбрав значения в различных полях следующим образом:  

    1. Чтобы указать параметры для рабочего процесса, предусматривающего отправку уведомления, заполните поля, как описано в следующей таблице.  

    > [!NOTE]
    > Эти поля будут разными в зависимости от выбранного вами ответа.

       |Поле|Описанием|
       |-----|-----------|
       |**Уведомить отправителя**|Укажите, следует ли уведомить автор запроса на утверждение, а не получателя запроса. Если вы установите этот флажок, поле **Код пользователя получателя** будет отключено, потому что вместо него уведомление будет получать отправитель (автор запроса). Имя ответа рабочего процесса изменяется соответственно на **Создать уведомление для &lt;Отправитель&gt;**. Если флажок не установлен, имя отклика рабочего процесса будет **Создать уведомление для &lt;Пользователь&gt;**.|
       |**Код пользователя получателя**|Укажите пользователя, которому должно отправляться уведомление. **Примечание**. Этот параметр доступен только для откликов рабочего процесса с заполнителем для определенного пользователя. Для откликов рабочих процессов без заполнителей для пользователей получатель уведомления обычно определяется путем **настройки пользователя утверждения**.|
       |**Тип операции уведомления**|Укажите триггер для уведомления рабочего процесса. Триггером может быть изменение записи, запрос на утверждение или прошедший срок.|
       |**Связать целевую страницу**|Укажите страницу, которая будет открываться по ссылке в уведомлении. Страница должна иметь ту же исходную таблицу, что и соответствующая запись.|
       |**Пользовательская ссылка**|Укажите URL-адрес ссылки, включенной в уведомление в дополнение к ссылке на страницу.|

    2. Чтобы указать параметры для отклика рабочего процесса, предусматривающего создание запроса на утверждение, заполните поля, как описано в следующей таблице.  

       |Поле|Описанием|  
       |-----|-----------|  
       |**Формула расчета срока утверждения**|Укажите количество дней, в течение которых утверждающий должен разрешить запрос. Период начинается с момента отправки запроса.|
       |**Делегировать через**|Укажите, должен ли запрос на утверждение автоматически делегироваться соответствующей замене и когда. Можно выбрать автоматическое делегирование через один, два или пять дней после даты запроса утверждения.|
       |**Тип утверждающего**|Укажите, кто является утверждающим, в соответствии с настройкой пользователей утверждения и пользователей рабочего процесса. Когда в поле выбрано значение **Менеджер по продажам/закупкам**, пользователь, указанный в поле **Код менеджера** на странице **Настройка пользователя для утверждений**, определяет утверждающее лицо. Затем создаются операции запросов утверждения в соответствии со значением в поле **Тип лимита утверждающего**. Подробнее в разделе [Настройка утверждающих пользователей](across-how-to-set-up-workflow-users.md).|
       |**Показать сообщение подтверждения**|Укажите, требуется ли отображать сообщение с подтверждением после запроса пользователем утверждения.|
       |**Тип лимита утверждающего**|Укажите, как действуют лимиты для утверждающих. Лимит утверждения утверждающего должен быть выше значения в запросе. Имеются следующие варианты: <ol><li>**Цепочка утверждающих** указывает, что операции запроса на утверждение создаются для всех утверждающих лиц данного запроса вплоть до первого квалифицированного утверждающего лица.</li><li>**Прямой утверждающий** указывает, что операция запроса утверждения создана только для непосредственного утверждающего лица запрашивающей стороны, независимо от лимита утверждения данного утверждающего лица.</li><li>**Первый квалифицированный утверждающий** означает, что операция запроса на утверждение создается только для первого утверждающего запроса.</li><li>**Конкретный утверждающий** означает, что вы уведомляете пользователя, выбранного в поле **Код утверждающего**.</li></ol>|

    3. Чтобы задать параметры для отклика рабочего процесса, предусматривающего создание строк журнала, заполните поля, как описано в следующей таблице.  

       |Поле|Описанием|  
       |-----|-----------|  
       |**Название шаблона финансового журнала**|Определите имя шаблона финансового журнала, в котором создаются указанные строки журнала.|  
       |**Название раздела финансового журнала**|Определите имя шаблона пакета финансового журнала, в котором создаются указанные строки журнала.|  

11. Выберите кнопки **Увеличить отступ** и **Уменьшить отступ** для установки отступа имени события в поле **Когда**, чтобы задать положение шага в рабочем процессе.  

    1. Сделайте отступ для события под именем предыдущего шага, чтобы указать, что это следующий шаг.  
    2. Укажите, что шаг является одним из нескольких альтернативных шагов, который может начаться при выполнения соответствующего условия, задав отступ имени события таким же, что и у других альтернативных шагов. Организуйте такие дополнительные шаги по приоритету, поместив самый важный шаг первым.  

    > [!NOTE]  
    >  Изменение отступа возможно только для шага, который не имеет последующего шага.  

12. Повторите шаги 7–11 для добавления других шагов рабочего процесса перед только что созданным шагом или после него.  
13. Установите значение **Включено**, чтобы указать, что рабочий процесс начнется при возникновении события в первом шаге типа **Точка входа**. Подробнее в разделе [Использование рабочих процессов](across-use-workflows.md).  

> [!NOTE]  
> Не включайте рабочий процесс, пока не будете уверены, что он готов.  

> [!TIP]  
> Чтобы увидеть связи между таблицами, которые используются в рабочих процессах, выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](media/ui-search/search_small.png "Что вы хотите сделать") затем введите **Связи таблица - рабочий процесс**.  

## <a name="example-of-creating-a-new-workflow-using-existing-events"></a>Пример создания нового рабочего процесса с использованием существующих событий

В следующем примере создается рабочий процесс для утверждения изменения в имени поставщика:

1. Выберите значок ![Лампочка, которая открывает функцию «Что вы хотите сделать»](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Рабочие процессы**, затем выберите связанную ссылку.  
2. Выберите действие **Создать**. Откроется страница **Рабочий процесс**.
3. В разделе рабочих процессов заполните поля, как описано в следующей таблице.

    |Поле  |Значение  |
    |---------|---------|
    |**Код**|**VENDAPN-01**|
    |**Описание**|**Утверждение изменения имени поставщика** |
    |**Категория**|**PURCH**|

4. Чтобы создать первый шаг рабочего процесса, выполните следующее.

    1. В поле **Событие "когда"** укажите *Запись поставщика изменена*.  
    2. В поле **При условии** выберите слово **Всегда**. Затем на странице **Условия события** выберите ссылку **Добавить условие изменения значений полей**, затем выберите поле **Имя**. Результатом этого шага является то, что условие становится *Имя изменено*.  
    3. В поле **Отклик "то"** выберите ссылку **Выберите отклик**. Затем на странице **Отклики рабочего процесса** в поле **Выбрать отклик** выберите отклик **Сторнировать значение поля \<Field\> записи и сохранить изменение**. Затем в разделе **Параметры для выбранного отклика** укажите поле **Имя**.  
    4. Выберите ссылку **Добавить еще отклики**, затем добавьте запись для отклика **Создать запрос утверждения для записи, используя тип утверждающего <%1> и <%2>**.  
    5. В разделе **Параметры для выбранного отклика** для нового отклика измените значение в поле **Тип утверждающего** на **Группа пользователей рабочего процесса**. Затем в поле **Группа пользователей рабочего процесса** укажите группу пользователей. Подробнее в разделе [Настройка утверждающих пользователей](across-how-to-set-up-approval-users.md).  
    6. Добавьте третий отклик, **Отправить запрос утверждения для записи и создать уведомление**.  
    7. Добавьте четвертый отклик, **Показать сообщение "%1"**. Затем в разделе **Параметры для выбранного отклика** в поле **Сообщение** укажите **Запрос утверждения отправлен**.  
    8. Выберите **ОК** для возвращения к шагу рабочего процесса.  

5. В следующей строке добавьте новый шаг рабочего процесса для события **Запрос на утверждение утвержден**.

    1. В поле **Событие "когда"** укажите **Запрос на утверждение утвержден**.  
    2. Выберите меню строки, затем выберите **Увеличить отступ**.  
    3. В поле **При условии** выберите **Всегда**. Затем в поле **Ожидаемые утверждения** укажите **0**. Условие читается как **Ожидаемые утверждения:0**, что указывает, что другие утверждающие для запроса не требуются.  
    4. В поле **Отклик "то"** выберите ссылку **Выберите отклик**. Затем на странице **Отклики рабочего процесса** в поле **Выбрать отклик** выберите отклик **Отправить запрос утверждения для записи и создать уведомление**.  
    5. Выберите **ОК**.  
6. В следующей строке добавьте второй шаг рабочего процесса для события **Запрос на утверждение утвержден**.  

    1. В поле **Событие "когда"** укажите **Запрос на утверждение утвержден**.
    2. В поле **При условии** выберите **Всегда**. Затем в поле **Ожидаемые утверждения** укажите **>0**. Это условие читается как **Ожидаемые утверждения:0**, что указывает, что это не последний утверждающий.  
    3. В поле **Отклик "то"** выберите ссылку **Выберите отклик**. Затем на странице **Отклики рабочего процесса** в поле **Выбрать отклик** выберите отклик **Отправить запрос утверждения для записи и создать уведомление**.  
    4. Выберите **ОК**.  
7. В следующей строке добавьте шаг рабочего процесса для события **Запрос на утверждение делегирован**.  

    1. В поле **Событие "когда"** укажите **Запрос на утверждение делегирован**.  
    2. В поле **При условии** оставьте значение как **Всегда**.  
    3. В поле **Отклик "то"** выберите ссылку **Выберите отклик**. Затем на странице **Отклики рабочего процесса** в поле **Выбрать отклик** выберите отклик **Отправить запрос утверждения для записи и создать уведомление**.  
    4. Выберите **ОК**.  
8. В следующей строке добавьте второй шаг рабочего процесса для события **Запрос на утверждение отклонен**.  

    1. В поле **Событие "когда"** укажите **Запрос на утверждение отклонен**.  
    2. В поле **При условии** оставьте значение как **Всегда**.  
    3. В поле **Отклик "то"** выберите ссылку **Выберите отклик**. Затем, на странице **Отклики рабочего процесса** в поле **Выберите отклик** выберите отклик **Отклонить новые значения**.  
    4. Выберите ссылку **Добавить еще отклики**, затем добавьте запись для отклика **Отклонить запрос утверждения для записи и создать уведомление**
    5. Выберите **ОК**.  
9. Чтобы включить службу рабочий процесс, установите переключатель **Включено**.  

На следующем рисунке представлен обзор результата этой процедуры.  

:::image type="content" source="media/Workflows/workflow-example-2.png" alt-text="Иллюстрация рабочего процесса утверждения имени поставщика.":::

Теперь протестируйте рабочий процесс, открыв карточку существующего поставщика и изменив имя. Убедитесь, что при изменении имени поставщика отправляется запрос на утверждение.

## <a name="see-also"></a>См. также

[Создание рабочих процессов из шаблонов рабочих процессов](across-how-to-create-workflows-from-workflow-templates.md)  
[Настройка утверждающих пользователей](across-how-to-set-up-approval-users.md)  
[Настройка уведомлений рабочего процесса утверждения](across-setting-up-workflow-notifications.md)  
[Просмотр архивированных экземпляров шагов рабочих процессов](across-how-to-view-archived-workflow-step-instances.md)  
[Удаление рабочих процессов утверждения](across-how-to-delete-workflows.md)  
[Пошаговое руководство. Настройка и использование рабочего процесса утверждения покупки](walkthrough-setting-up-and-using-a-purchase-approval-workflow.md)  
[Настройка рабочих процессов утверждения](across-set-up-workflows.md)  
[Использование рабочих процессов утверждения](across-use-workflows.md)  
[Рабочий процесс](across-workflow.md)  

[!INCLUDE[footer-include](includes/footer-banner.md)]
