---
title: Сведения о проектировании — структура учета трассировки товаров
description: 'Узнайте, как использовать операции книги учета товаров в качестве основного носителя номеров отслеживания товаров в структуре разноски отслеживания товаров.'
author: brentholtorf
ms.topic: conceptual
ms.devlang: al
ms.search.keywords: 'design, item tracking, posting, inventory'
ms.date: 06/15/2021
ms.author: bholtorf
ms.service: dynamics-365-business-central
ms.reviewer: bholtorf
---
# Сведения о проектировании: структура учета трассировки товаров
Для того чтобы скоординировать с функцией учета стоимости товаров и получить более простое и надежное решение, операции журнала товаров используются как основные носители номеров трассировки товаров.  
  
Номера трассировки товаров в объектах сети заказов и незаказанных сетевых единицах указываются в таблице T337 **Операция резервирования**. Номера трассировки товара, относящиеся к историческим данным, извлекаются непосредственно из операций книги товаров, связанных с данной транзакцией. Это означает, что операции журнала товаров отражают спецификацию трассировки товаров строки учтенного заказа.  
  
Страница **Строки трассировки товаров** извлекает информацию из T337 и операций журнала товаров и отображает их во временной таблице, **Спецификация трассировки** (T336). В таблице T336 также содержатся данные трассировки на странице **Строки трассировки товаров** для количеств трассировок товаров, по которым еще предстоит выставить счет.  
  
## Отношение "один-ко-многим"  
Таблица **Связь товарной операции**, которая используется для того, чтобы связать строку учтенного документа с точно соответствующей операцией книги товаров, состоит, в основном, из 2 элементов.  
  
* Указатель на учтенную строку документа, поле **Номер строки заказа** .  
* Номер операции, указывающий на операцию книги товаров, поле **Код товарной операции**.  
  
Функция существующего поля **Номер операции**, которое связывает операцию журнала товаров с учтенной строкой документа, обрабатывает стандартные одноуровневые отношения без номеров трассировки товаров в учтенной строке документа. Если существуют номера трассировки товара, поле **Номер операции** остается пустым, а отношениями один-ко-многим обрабатывается в таблице **Связь товарной операции**. Если учтенная строка документа содержит номера трассировки товара, но относится только к одной операции книги товаров, отношение определяется в поле **Номер операции**, и запись в таблице **Связь товарной операции** не создается.  
  
## Кодовые единицы 80 (продажа-последующая) и 90 (покупка-последующая)
Чтобы разделить операции журнала товаров во время учета, код в модулях codeunit 80 и codeunit 90 заключается в циклы, выполняющие обход глобальных переменных временной записи. Этот код вызывает модуль codeunit 22 со строкой журнала товаров. Эти переменные инициализируются, если номера трассировки товаров существуют для строки документа. Для упрощения кода всегда используется эта циклическая структура Если для строки документа не существуют номера трассировки товара, вставляется одна запись, и цикл выполняется только один раз.  
  
## Учет журнала товаров  
Номера отслеживания товаров передаются через записи резервирования, которые относятся к записи в регистре товаров, а цикл по номерам отслеживания товаров происходит в кодовом модуле 22 (Item Jnl.-Post Line). Это принцип работает так же, когда строка журнала товаров используется неявно для учета заказа на покупку или заказа на продажу, как при использовании строки журнала товаров напрямую. Если журнал товаров используется напрямую, поле **ИД строки источника** указывает на саму строку журнала товаров.  
  
## Код единицы 22 (пункт Jnl.-Post Line)
Кодовые модули 80 (Продажи-Отправка) и 90 (Покупки-Отправка) зацикливают вызов кодового модуля 22 (Товар Журнал-Отправка) во время выставления счетов-фактур с номерами отслеживания товаров и во время выставления счетов-фактур существующих поставок или квитанций.  
  
Во время количественной отправки номеров отслеживания товаров кодовый блок 22 (Item Jnl.-Post Line) извлекает номера отслеживания товаров из записей в T337 (Reservation Entry), которые относятся к отправке. Эти операции помещаются напрямую в строку журнала товаров.  
  
Модуль 22 (Item Jnl.-Post Line) циклически перебирает номера отслеживания товаров и разбивает публикацию на соответствующие записи в регистре товаров, содержащие номера отслеживания товаров. Информация о том, какие записи в регистре товаров созданы, возвращается в T337 (запись резервирования) с помощью временной записи T336, которая вызывается процедурой в модуле кода 22. Данная процедура вызывается, когда модуль codeunit 22 заканчивает выполнение, поскольку на данный момент объект codeunit 22 содержит информацию. При извлечении временной записи T336 модули Codeunit 80 (продажи-поступление) и 90 (покупки-поступление) создают записи в таблице **Item Entry Relation**, чтобы связать созданные записи товарной книги с созданной строкой отгрузки или получения. Затем модули Codeunits 80 (Sales-Post) и 90 (Purch-Post) преобразуют временные записи T336 (Tracking Specification) в реальные записи T336 (Tracking Specification), которые относятся к рассматриваемой строке. Однако это преобразование выполняется, только если учтенная строка документа не удаляется, поскольку она учтена лишь частично.  
  
## См. также  
[Сведения о проектировании: трассировка товара](design-details-item-tracking.md)   
[Сведения о проектировании: разработка трассировки товара](design-details-item-tracking-design.md)

[!INCLUDE[footer-include](includes/footer-banner.md)]
