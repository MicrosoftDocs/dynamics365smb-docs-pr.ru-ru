---
title: Сведения о проектировании — структура учета трассировки товаров | Документы Майкрософт
description: Узнайте, как использовать операции книги товаров как основной носитель номеров трассировки товара.
services: project-madeira
documentationcenter: ''
author: SorenGP
ms.service: dynamics365-business-central
ms.topic: article
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: design, item tracking, posting, inventory
ms.date: 10/01/2018
ms.author: sgroespe
ms.openlocfilehash: b2cb135991a067b86b7c5579e0386ffd199aefcf
ms.sourcegitcommit: 1bcfaa99ea302e6b84b8361ca02730b135557fc1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2019
ms.locfileid: "805117"
---
# <a name="design-details-item-tracking-posting-structure"></a><span data-ttu-id="69ac6-103">Сведения о проектировании: структура учета трассировки товаров</span><span class="sxs-lookup"><span data-stu-id="69ac6-103">Design Details: Item Tracking Posting Structure</span></span>
<span data-ttu-id="69ac6-104">Для того чтобы скоординировать с функцией учета стоимости товаров и получить более простое и надежное решение, операции журнала товаров используются как основные носители номеров трассировки товаров.</span><span class="sxs-lookup"><span data-stu-id="69ac6-104">To align with inventory costing functionality and to obtain a simpler and more robust solution, item ledger entries are used as the primary carrier of item tracking numbers.</span></span>  
  
<span data-ttu-id="69ac6-105">Номера трассировки товаров в объектах сети заказов и незаказанных сетевых единицах указываются в таблице T337 **Операция резервирования**.</span><span class="sxs-lookup"><span data-stu-id="69ac6-105">Item tracking numbers on order network entities and non-order network entities are specified in the **Reservation Entry** table (T337).</span></span> <span data-ttu-id="69ac6-106">Номера трассировки товара, относящиеся к историческим данным, извлекаются непосредственно из операций книги товаров, связанных с данной транзакцией.</span><span class="sxs-lookup"><span data-stu-id="69ac6-106">Item tracking numbers that are related to historical information are retrieved directly from the item ledger entries that are related to the transaction in question.</span></span> <span data-ttu-id="69ac6-107">Это означает, что операции журнала товаров отражают спецификацию трассировки товаров строки учтенного заказа.</span><span class="sxs-lookup"><span data-stu-id="69ac6-107">This means that item ledger entries reflect the item tracking specification of the posted order line.</span></span>  
  
<span data-ttu-id="69ac6-108">Страница **Строки трассировки товаров** извлекает информацию из T337 и операций журнала товаров и отображает их во временной таблице, **Спецификация трассировки** (T336).</span><span class="sxs-lookup"><span data-stu-id="69ac6-108">The **Item Tracking Lines** page retrieves the information from T337 and the item ledger entries and shows it through the temporary table, **Tracking Specification** (T336).</span></span> <span data-ttu-id="69ac6-109">В таблице T336 также содержатся данные трассировки на странице **Строки трассировки товаров** для количеств трассировок товаров, по которым еще предстоит выставить счет.</span><span class="sxs-lookup"><span data-stu-id="69ac6-109">T336 also hold the temporary data in the **Item Tracking Lines page** for item tracking quantities that remain to be invoiced.</span></span>  
  
## <a name="one-to-many-relation"></a><span data-ttu-id="69ac6-110">Отношение "один-ко-многим"</span><span class="sxs-lookup"><span data-stu-id="69ac6-110">One-to-Many Relation</span></span>  
<span data-ttu-id="69ac6-111">Таблица **Связь товарной операции**, которая используется для того, чтобы связать строку учтенного документа с точно соответствующей операцией книги товаров, состоит, в основном, из 2 элементов.</span><span class="sxs-lookup"><span data-stu-id="69ac6-111">The **Item Entry Relation** table, which is used to link a posted document line with its related item ledger entries, consists of two main parts:</span></span>  
  
* <span data-ttu-id="69ac6-112">Указатель на учтенную строку документа, поле **Номер строки заказа**</span><span class="sxs-lookup"><span data-stu-id="69ac6-112">A pointer to the posted document line, the **Order Line No.**</span></span> <span data-ttu-id="69ac6-113">.</span><span class="sxs-lookup"><span data-stu-id="69ac6-113">field.</span></span>  
* <span data-ttu-id="69ac6-114">Номер операции, указывающий на операцию книги товаров, поле **Код товарной операции**.</span><span class="sxs-lookup"><span data-stu-id="69ac6-114">An entry number pointing to an item ledger entry, the **Item Entry No.** field.</span></span>  
  
<span data-ttu-id="69ac6-115">Функция существующего поля **Номер операции**, которое связывает операцию журнала товаров с учтенной строкой документа, обрабатывает стандартные одноуровневые отношения без номеров трассировки товаров в учтенной строке документа.</span><span class="sxs-lookup"><span data-stu-id="69ac6-115">The functionality of the existing **Entry No.** field, which relates an item ledger entry to a posted document line, handles the typical one-to-one relation when no item tracking numbers exist on the posted document line.</span></span> <span data-ttu-id="69ac6-116">Если существуют номера трассировки товара, поле **Номер операции** остается пустым, а отношениями один-ко-многим обрабатывается в таблице **Связь товарной операции**.</span><span class="sxs-lookup"><span data-stu-id="69ac6-116">If item tracking numbers exist, then the **Entry No.** field is left blank, and the one-to-many relation is handled by the **Item Entry Relation** table.</span></span> <span data-ttu-id="69ac6-117">Если учтенная строка документа содержит номера трассировки товара, но относится только к одной операции книги товаров, отношение определяется в поле **Номер операции**, и запись в таблице **Связь товарной операции** не создается.</span><span class="sxs-lookup"><span data-stu-id="69ac6-117">If the posted document line carries item tracking numbers but only relates to a single item ledger entry, then the **Entry No.** field handles the relation, and the no record is created in the **Item Entry Relation** table.</span></span>  
  
## <a name="codeunits-80-and-90"></a><span data-ttu-id="69ac6-118">Codeunit 80 и 90</span><span class="sxs-lookup"><span data-stu-id="69ac6-118">Codeunits 80 and 90</span></span>  
<span data-ttu-id="69ac6-119">Чтобы разделить операции журнала товаров во время учета, код в модулях codeunit 80 и codeunit 90 заключается в циклы, выполняющие обход глобальных переменных временной записи.</span><span class="sxs-lookup"><span data-stu-id="69ac6-119">To split the item ledger entries during posting, the code in codeunit 80 and codeunit 90, is encircled by loops that run through global temporary record variables.</span></span> <span data-ttu-id="69ac6-120">Этот код вызывает модуль codeunit 22 со строкой журнала товаров.</span><span class="sxs-lookup"><span data-stu-id="69ac6-120">This code calls codeunit 22 with an item journal line.</span></span> <span data-ttu-id="69ac6-121">Эти переменные инициализируются, если номера трассировки товаров существуют для строки документа.</span><span class="sxs-lookup"><span data-stu-id="69ac6-121">These variables are initialized when item tracking numbers exist for the document line.</span></span> <span data-ttu-id="69ac6-122">Для упрощения кода всегда используется эта циклическая структура</span><span class="sxs-lookup"><span data-stu-id="69ac6-122">To keep the code simple, this looping structure is always used.</span></span> <span data-ttu-id="69ac6-123">Если для строки документа не существуют номера трассировки товара, вставляется одна запись, и цикл выполняется только один раз.</span><span class="sxs-lookup"><span data-stu-id="69ac6-123">If no item tracking numbers exist for the document line, then a single record is inserted, and the loop runs only once.</span></span>  
  
## <a name="posting-the-item-journal"></a><span data-ttu-id="69ac6-124">Учет журнала товаров</span><span class="sxs-lookup"><span data-stu-id="69ac6-124">Posting the Item Journal</span></span>  
<span data-ttu-id="69ac6-125">Номера трассировки товара переносятся в операциях резервирования, которые связаны с операцией книги товаров, и цикл выполняется с помощью номеров трассировки товара в модуле codeunit 22.</span><span class="sxs-lookup"><span data-stu-id="69ac6-125">Item tracking numbers are transferred via the reservation entries that relate to the item ledger entry, and the looping through item tracking numbers occurs in codeunit 22.</span></span> <span data-ttu-id="69ac6-126">Это принцип работает так же, когда строка журнала товаров используется неявно для учета заказа на покупку или заказа на продажу, как при использовании строки журнала товаров напрямую.</span><span class="sxs-lookup"><span data-stu-id="69ac6-126">This concept works in the same way when an item journal line is used indirectly to post a sale or purchase order as when an item journal line is used directly.</span></span> <span data-ttu-id="69ac6-127">Если журнал товаров используется напрямую, поле **ИД строки источника** указывает на саму строку журнала товаров.</span><span class="sxs-lookup"><span data-stu-id="69ac6-127">When the item journal is used directly, the **Source Row ID** field points to the item journal line itself.</span></span>  
  
## <a name="code-unit-22"></a><span data-ttu-id="69ac6-128">Модуль 22</span><span class="sxs-lookup"><span data-stu-id="69ac6-128">Code Unit 22</span></span>  
<span data-ttu-id="69ac6-129">Модули codeunit 80 и 90 создают цикл вызова codeunit 22 во время учета счета номеров трассировки товара и во время учета существующих расходных и приходных накладных.</span><span class="sxs-lookup"><span data-stu-id="69ac6-129">Codeunits 80 and 90 loop the call of codeunit 22 during the invoice posting of item tracking numbers and during the invoicing of existing shipments or receipts.</span></span>  
  
<span data-ttu-id="69ac6-130">Во время учета количества номеров трассировки товаров модуль codeunit 22 извлекает номера трассировки товаров из операций в T337, относящихся к учету.</span><span class="sxs-lookup"><span data-stu-id="69ac6-130">During quantity posting of item tracking numbers, codeunit 22 retrieves item tracking numbers from the entries in T337 that relate to the posting.</span></span> <span data-ttu-id="69ac6-131">Эти операции помещаются напрямую в строку журнала товаров.</span><span class="sxs-lookup"><span data-stu-id="69ac6-131">These entries are placed directly on the item journal line.</span></span>  
  
<span data-ttu-id="69ac6-132">Codeunit 22 переходит по номерам трассировки товара и разделяет учет на соответствующие операции книги товаров, включающие номера трассировки товара.</span><span class="sxs-lookup"><span data-stu-id="69ac6-132">Codeunit 22 loops through the item tracking numbers and splits the posting into the respective item ledger entries that carry the item tracking numbers.</span></span> <span data-ttu-id="69ac6-133">Информация о том, какие операции книги товаров создаются, возвращается в T337 с помощью временной записи T336, которая вызывается в ходе выполнения процедуры в модуле codeunit 22.</span><span class="sxs-lookup"><span data-stu-id="69ac6-133">Information about which item ledger entries are created is returned to T337 by using a temporary T336 record, which is called by a procedure in codeunit 22.</span></span> <span data-ttu-id="69ac6-134">Данная процедура вызывается, когда модуль codeunit 22 заканчивает выполнение, поскольку на данный момент объект codeunit 22 содержит информацию.</span><span class="sxs-lookup"><span data-stu-id="69ac6-134">This procedure is triggered when codeunit 22 has finished its run because at that point, the codeunit 22 object contains the information.</span></span> <span data-ttu-id="69ac6-135">Если временная запись T336 извлечена, модули codeunit 80 и 90 создают записи в таблице **Связь товарной операции**, чтобы связать созданные операции книги товаров со строкой созданной отгрузки или приходной накладной.</span><span class="sxs-lookup"><span data-stu-id="69ac6-135">When the temporary T336 record is retrieved, codeunits 80 and 90 create records in the **Item Entry Relation** table to link the created item ledger entries to the created shipment or receipt line.</span></span> <span data-ttu-id="69ac6-136">Затем модули codeunit 80 и 90 преобразовывают временные записи T336 в фактические записи T336, связанные с данной строкой.</span><span class="sxs-lookup"><span data-stu-id="69ac6-136">Codeunits 80 or codeunit 90 then converts the temporary T336 records to real T336 records that are related to the line in question.</span></span> <span data-ttu-id="69ac6-137">Однако это преобразование выполняется, только если учтенная строка документа не удаляется, поскольку она учтена лишь частично.</span><span class="sxs-lookup"><span data-stu-id="69ac6-137">However, this conversion occurs only if the posted document line is not deleted, because it is only partially posted.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="69ac6-138">См. также</span><span class="sxs-lookup"><span data-stu-id="69ac6-138">See Also</span></span>  
<span data-ttu-id="69ac6-139">[Сведения о проектировании: трассировка товара](design-details-item-tracking.md) </span><span class="sxs-lookup"><span data-stu-id="69ac6-139">[Design Details: Item Tracking](design-details-item-tracking.md) </span></span>  
[<span data-ttu-id="69ac6-140">Сведения о проектировании: разработка трассировки товара</span><span class="sxs-lookup"><span data-stu-id="69ac6-140">Design Details: Item Tracking Design</span></span>](design-details-item-tracking-design.md)