---
title: Очистка данных с помощью политик хранения | Документация Майкрософт
description: Вы можете указать, как часто вы хотите удалять определенные типы данных.
author: bholtorf
ms.service: dynamics365-business-central
ms.topic: conceptual
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: delete, data, retention, policy, policies
ms.date: 04/01/2021
ms.author: bholtorf
ms.openlocfilehash: 5b962ed463a37e578371df193bca887774232ba5
ms.sourcegitcommit: c11ad91a389ed72532f5513654fdc7909b20aed9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2021
ms.locfileid: "5935340"
---
# <a name="define-retention-policies"></a><span data-ttu-id="cd2bc-103">Определение политик хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-103">Define Retention Policies</span></span>
<span data-ttu-id="cd2bc-104">Администраторы могут определять политики хранения, чтобы указать, как часто они хотят, чтобы [!INCLUDE[prod_short](includes/prod_short.md)] удалял устаревшие данные в таблицах, содержащих записи журнала и архивные записи.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-104">Administrators can define retention policies to specify how frequently they want [!INCLUDE[prod_short](includes/prod_short.md)] to delete outdated data in tables that contain log entries and archived records.</span></span> <span data-ttu-id="cd2bc-105">Например, очистка записей журнала может упростить работу с действительно важными данными.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-105">For example, cleaning up log entries can make it easier to work with the data that's actually relevant.</span></span> <span data-ttu-id="cd2bc-106">Политики могут включать все данные в таблицах, срок действия которых истек, или вы можете добавить критерии фильтрации, которые будут включать в политику только определенные просроченные данные.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-106">Policies can include all data in the tables that is past the expiration date, or you can add filter criteria that will include only certain expired data in the policy.</span></span> 

## <a name="required-setups-and-permissions"></a><span data-ttu-id="cd2bc-107">Обязательные настройки и разрешения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-107">Required Setups and Permissions</span></span>
<span data-ttu-id="cd2bc-108">До начала работы с политиками хранения необходимо настроить следующее.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-108">Before you can create retention policies, you must set up the following.</span></span>

|<span data-ttu-id="cd2bc-109">Настройка</span><span class="sxs-lookup"><span data-stu-id="cd2bc-109">Setup</span></span>  |<span data-ttu-id="cd2bc-110">Описание</span><span class="sxs-lookup"><span data-stu-id="cd2bc-110">Description</span></span>  |
|---------|---------|
|<span data-ttu-id="cd2bc-111">**Допустимые таблицы**</span><span class="sxs-lookup"><span data-stu-id="cd2bc-111">**Allowed Tables**</span></span>     |<span data-ttu-id="cd2bc-112">Мы предоставляем список таблиц, которые могут быть включены в политики хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-112">We provide a list of the tables that can be included in retention policies.</span></span> <span data-ttu-id="cd2bc-113">Однако, если вы хотите добавить таблицы из расширения в политику хранения, разработчик должен добавить свои таблицы в список.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-113">However, if you want to add tables from an extension to a retention policy a developer must add their tables to the list.</span></span> <span data-ttu-id="cd2bc-114">Для получения дополнительной информации см. [Включение вашего расширения в политику хранения](admin-data-retention-policies.md#including-your-extension-in-a-retention-policy-requires-help-from-a-developer).</span><span class="sxs-lookup"><span data-stu-id="cd2bc-114">For more information, see [Including Your Extension in a Retention Policy](admin-data-retention-policies.md#including-your-extension-in-a-retention-policy-requires-help-from-a-developer).</span></span>          |
|<span data-ttu-id="cd2bc-115">**Периоды хранения**</span><span class="sxs-lookup"><span data-stu-id="cd2bc-115">**Retention Periods**</span></span>     |<span data-ttu-id="cd2bc-116">Укажите периоды времени, в течение которых данные будут храниться в таблицах политики.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-116">Specify periods of time for which to keep data in the tables in a policy.</span></span> <span data-ttu-id="cd2bc-117">Периоды определяют, как часто данные будут удаляться.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-117">The periods determine how often data will be deleted.</span></span>         |

<span data-ttu-id="cd2bc-118">Кроме того, у вас должны быть разрешения пользователя SUPER или набор разрешений для настройки политики хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-118">Additionally, you must have the SUPER user permissions or the Retention Policy Setup permission set.</span></span> <span data-ttu-id="cd2bc-119">Пользователи, которым предоставлен набор разрешений установки политики хранения, могут определять политики хранения для таблиц, даже если у них нет разрешений на чтение и удаление для этих таблиц.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-119">Users who are granted the Retention Policy Setup permission set can define retention policies for tables, even if they do not have Read and Delete permissions for those tables.</span></span> <span data-ttu-id="cd2bc-120">Запись очереди заданий должна запускаться от имени пользователя с разрешениями на чтение и удаление данных.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-120">The job queue entry must run as a user with permissions to read and delete the data.</span></span> <span data-ttu-id="cd2bc-121">Мы рекомендуем не предоставлять набор разрешений «Настройка политики хранения» пользователям, которым не должно быть разрешено удалять данные.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-121">We recommend that you do not grant the Retention Policy Setup permission set to users who should not be allowed to delete data.</span></span>

> [!NOTE]
> <span data-ttu-id="cd2bc-122">Если вы используете [!INCLUDE[prod_short](includes/prod_short.md)] локально, и вы хотите опробовать политики хранения в демонстрационной базе данных Cronus, вам нужно сделать несколько вещей.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-122">If you are using [!INCLUDE[prod_short](includes/prod_short.md)] on-premises, and you want to try out retention policies in the the Cronus demonstration database, there are a few things you need to do.</span></span> <span data-ttu-id="cd2bc-123">Демонстрационная организация не содержит таблиц, которые можно использовать с политиками хранения, поэтому их необходимо добавить.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-123">The demonstration company does not contain tables that you can use with retention policies, so you need to add them.</span></span> <span data-ttu-id="cd2bc-124">Для этого создайте новую пустую компанию в демонстрационной базе данных.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-124">To do that, create a new, blank company in the demonstration database.</span></span> <span data-ttu-id="cd2bc-125">В новой компании импортируйте пакет конфигурации RapidStart для вашей страны, соответствующий стандартному пакету NAV17.0.W1.ENU.STANDARD.rapidstart.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-125">In the new company, import the RapidStart configuration package for your country that corresponds to the standard NAV17.0.W1.ENU.STANDARD.rapidstart package.</span></span> <span data-ttu-id="cd2bc-126">Данные о настройке политик хранения будут доступны в новой компании.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-126">The setup data for retention policies will be available in the new company.</span></span>

### <a name="to-create-retention-periods"></a><span data-ttu-id="cd2bc-127">Для создания периодов хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-127">To create retention periods</span></span>
<span data-ttu-id="cd2bc-128">Срок хранения может быть сколь угодно длинным или коротким.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-128">Retention periods can be as long or as short as you want.</span></span> <span data-ttu-id="cd2bc-129">Чтобы создать период хранения, на странице **Политики хранения** используйте действие **Период хранения**.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-129">To create retention periods, on the **Retention Policies** page, use the **Retention Period** action.</span></span> <span data-ttu-id="cd2bc-130">Определенные вами периоды будут доступны для всех политик.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-130">The periods you define will be available for all policies.</span></span>

> [!NOTE]
> <span data-ttu-id="cd2bc-131">Из соображений соответствия мы определили минимальный срок хранения для некоторых таблиц.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-131">For compliance reasons, we have defined a minimum retention period for some tables.</span></span> <span data-ttu-id="cd2bc-132">Если вы установите срок хранения, который меньше необходимого минимума, в сообщении будет отображаться обязательный период.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-132">If you set a retention period that is shorter than minimum required, a message will display the mandatory period.</span></span>

### <a name="set-up-a-retention-policy"></a><span data-ttu-id="cd2bc-133">Настройка политики хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-133">Set up a retention policy</span></span>
1. <span data-ttu-id="cd2bc-134">Выберите значок ![Лампочка, которая открывает функцию "Что вы хотите сделать"](media/ui-search/search_small.png "Что вы хотите сделать"), введите **Политики хранения**, затем выберите соответствующую ссылку.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-134">Choose the ![Lightbulb that opens the Tell Me feature](media/ui-search/search_small.png "Tell me what you want to do") icon, enter **Retention Policies**, and choose the related link.</span></span>
2. <span data-ttu-id="cd2bc-135">В поле **Код таблицы** выберите таблицу, которую предполагается включить в политику.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-135">In the **Table ID** field, choose the table that you want to include in the policy.</span></span>
3. <span data-ttu-id="cd2bc-136">В поле **Период хранения** укажите продолжительность хранения данных в таблице.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-136">In the **Retention Period** field, specify the length of time for which to keep the data in the table.</span></span>
4. <span data-ttu-id="cd2bc-137">Необязательно: чтобы применить политику к определенным данным в таблице, выключите переключатель "Применить ко всем записям".</span><span class="sxs-lookup"><span data-stu-id="cd2bc-137">Optional: To apply the policy to specific data in a table, turn off the Apply to all records toggle.</span></span> <span data-ttu-id="cd2bc-138">Отобразится экспресс-вкладка «Политика хранения записей», где вы можете установить фильтры для создания подмножеств данных для каждой строки.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-138">The Record Retention Policy FastTab will display, where you can set filters to create subsets of data for each line.</span></span> <span data-ttu-id="cd2bc-139">Дополнительные сведения см. в разделе [Фильтрация](ui-enter-criteria-filters.md#filtering).</span><span class="sxs-lookup"><span data-stu-id="cd2bc-139">For more information, see [Filtering](ui-enter-criteria-filters.md#filtering).</span></span>

   > [!NOTE]
   > <span data-ttu-id="cd2bc-140">У каждой строки свой срок хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-140">Each line has its own retention period.</span></span> <span data-ttu-id="cd2bc-141">Если вы укажете разные периоды хранения для одних и тех же данных, будет использоваться самый длинный период.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-141">If you specify different retention periods for the same data, the longest period will be used.</span></span> <span data-ttu-id="cd2bc-142">Кроме того, в некоторых таблицах есть фильтры, которые нельзя изменить или удалить.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-142">Also, some tables contain filters that you cannot change or remove.</span></span> <span data-ttu-id="cd2bc-143">Чтобы помочь вам идентифицировать эти фильтры, они отображаются более светлым шрифтом.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-143">To help you identify these filters, they appear in a lighter color font.</span></span>

## <a name="applying-retention-policies"></a><span data-ttu-id="cd2bc-144">Применение политик хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-144">Applying Retention Policies</span></span>
<span data-ttu-id="cd2bc-145">Вы можете использовать запись в очереди заданий, чтобы применить политики хранения для автоматического удаления данных, или вы можете применить политики вручную.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-145">You can use a job queue entry to apply retention policies to delete data automatically, or you can manually apply policies.</span></span>

<span data-ttu-id="cd2bc-146">Чтобы применить политику хранения автоматически, просто создайте и включите политику.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-146">To apply a retention policy automatically, just create and enable a policy.</span></span> <span data-ttu-id="cd2bc-147">Когда вы включаете политику, мы создаем запись в очереди заданий, которая будет применять политики хранения в соответствии с указанным вами периодом хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-147">When you enable a policy we create a job queue entry that will apply retention policies according to the retention period you specify.</span></span> <span data-ttu-id="cd2bc-148">Все политики хранения будут использовать одну и ту же запись очереди заданий.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-148">All retention policies will use the same job queue entry.</span></span> <span data-ttu-id="cd2bc-149">По умолчанию запись в очереди заданий применяет политику каждый день в 2:00.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-149">By default, the job queue entry applies the policy every day at 0200.</span></span> <span data-ttu-id="cd2bc-150">Вы можете изменить значение по умолчанию, но если вы это сделаете, мы рекомендуем его запускать в нерабочее время.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-150">You can change the default, but if you do we recommend that it runs outside business hours.</span></span> <span data-ttu-id="cd2bc-151">Дополнительные сведения см. в разделе [Использование очередей работ для планирования задач](admin-job-queues-schedule-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="cd2bc-151">For more information, see [Use Job Queues to Schedule Tasks](admin-job-queues-schedule-tasks.md).</span></span> 

<span data-ttu-id="cd2bc-152">Вы можете вручную применить политику, используя действие **Применить вручную** на странице **Политики хранения**.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-152">You can manually apply a policy by using the **Apply Manually** action on the **Retention Policies** page.</span></span> <span data-ttu-id="cd2bc-153">Если вы хотите всегда применять политику вручную, включите переключатель **Вручную**.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-153">If you want to always apply a policy manually, turn on the **Manual** toggle.</span></span> <span data-ttu-id="cd2bc-154">Запись в очереди заданий игнорирует политику при запуске.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-154">The job queue entry will disregard the policy when it runs.</span></span>

## <a name="viewing-retention-policy-log-entries"></a><span data-ttu-id="cd2bc-155">Просмотр записей журнала политики хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-155">Viewing Retention Policy Log Entries</span></span>
<span data-ttu-id="cd2bc-156">Вы можете просмотреть действия, связанные с политиками хранения, на странице **Журнал политик хранения**.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-156">You can view activity related to retention policies in the **Retention Policy Log** page.</span></span> <span data-ttu-id="cd2bc-157">Например, записи создаются при применении политики или при возникновении ошибок.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-157">For example, entries are created when when a policy is applied, or if errors occurred when that happened.</span></span> 

## <a name="including-your-extension-in-a-retention-policy-requires-help-from-a-developer"></a><span data-ttu-id="cd2bc-158">Включение вашего расширения в политику хранения (требуется помощь разработчика)</span><span class="sxs-lookup"><span data-stu-id="cd2bc-158">Including Your Extension in a Retention Policy (Requires Help from a Developer)</span></span>
<span data-ttu-id="cd2bc-159">По умолчанию политики хранения охватывают только таблицы, включенные в список таблиц [!INCLUDE[prod_short](includes/prod_short.md)], которые мы предоставляем.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-159">By default, retention policies cover only tables that are included in the list of [!INCLUDE[prod_short](includes/prod_short.md)] tables that we provide.</span></span> <span data-ttu-id="cd2bc-160">Вы можете удалить таблицы по умолчанию из списка и добавить собственные таблицы.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-160">You can remove default tables from the list, and you can add tables that you own.</span></span> <span data-ttu-id="cd2bc-161">То есть вы не можете добавить таблицу, которую не создали сами.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-161">That is, you cannot add a table that you did not create yourself.</span></span> <span data-ttu-id="cd2bc-162">Например, вы не можете добавлять другие таблицы из [!INCLUDE[prod_short](includes/prod_short.md)] или из расширения, которое вы приобрели.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-162">For example, you cannot add other tables from [!INCLUDE[prod_short](includes/prod_short.md)] or from an extension that you have purchased.</span></span>

<span data-ttu-id="cd2bc-163">Чтобы добавить ваши таблицы в список разрешенных таблиц, разработчик должен добавить некоторый код, например, в codeunit установщика для расширения (codeunit с подтипом *установить*).</span><span class="sxs-lookup"><span data-stu-id="cd2bc-163">To add your tables to the list of allowed tables, a developer must add some code, for example to the installer codeunit for the extension (a codeunit with the *install* subtype).</span></span> 

<span data-ttu-id="cd2bc-164">Когда разработчик добавляет таблицу, он может указать обязательные фильтры и фильтры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-164">When a developer adds a table, they can specify mandatory and default filters.</span></span> <span data-ttu-id="cd2bc-165">Обязательные фильтры нельзя удалить или изменить позже, когда вы добавляете таблицы для определения политики хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-165">Mandatory filters cannot be removed or modified later when you add tables to define a retention policy.</span></span> <span data-ttu-id="cd2bc-166">Фильтры по умолчанию — это просто дружеские предложения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-166">Default filters are just friendly suggestions.</span></span>

<span data-ttu-id="cd2bc-167">Ниже приведены примеры того, как добавить таблицу в список разрешенных таблиц с обязательными фильтрами или фильтрами по умолчанию и без них.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-167">The following are examples of how to add a table to the list of allowed tables with, and without, mandatory or default filters.</span></span> <span data-ttu-id="cd2bc-168">Для более сложного примера см. codeunit 3999 "Пол.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-168">For a more complex example, see codeunit 3999 "Reten.</span></span> <span data-ttu-id="cd2bc-169">Хран.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-169">Pol.</span></span> <span data-ttu-id="cd2bc-170">Установить — BaseApp".</span><span class="sxs-lookup"><span data-stu-id="cd2bc-170">Install - BaseApp".</span></span> 

```al
 trigger OnInstallAppPerCompany()
    var
        RetenPolAllowedTables: Codeunit "Reten. Pol. Allowed Tables";
    begin
        RetenPolAllowedTables.AddAllowedTable(Database::"Retention Policy Log Entry");
    end;
```

<span data-ttu-id="cd2bc-171">Следующий пример включает обязательный фильтр.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-171">The following example includes a mandatory filter.</span></span>

```al
 trigger OnInstallAppPerCompany()
    var
        ChangeLogEntry: Record "Change Log Entry";
        RetenPolAllowedTables: Codeunit "Reten. Pol. Allowed Tables";
        RetentionPeriod: Enum "Retention Period Enum";
        RecRef: RecordRef;
        TableFilters: JsonArray;
        Enabled: Boolean;
        Mandatory: Boolean;
    begin
        ChangeLogEntry.Reset();
        ChangeLogEntry.SetFilter("Field Log Entry Feature", '%1|%2', ChangeLogEntry."Field Log Entry Feature"::"Monitor Sensitive Fields", ChangeLogEntry."Field Log Entry Feature"::All);
        RecRef.GetTable(ChangeLogEntry);
        Enabled := true;
        Mandatory := true;
        RetenPolAllowedTables.AddTableFilterToJsonArray(TableFilters, RetentionPeriod::"28 Days", ChangeLogEntry.FieldNo(SystemCreatedAt), Enabled, Mandatory, RecRef);
        RetenPolAllowedTables.AddAllowedTable(Database::"Change Log Entry", ChangeLogEntry.FieldNo(SystemCreatedAt), TableFilters);
    end;
```

<span data-ttu-id="cd2bc-172">После того, как разработчик добавил таблицы в список, администратор может включить их в политику хранения.</span><span class="sxs-lookup"><span data-stu-id="cd2bc-172">After a developer has added tables to the list, an administrator can include them in a retention policy.</span></span> 

## <a name="see-also"></a><span data-ttu-id="cd2bc-173">См. также</span><span class="sxs-lookup"><span data-stu-id="cd2bc-173">See Also</span></span>

[<span data-ttu-id="cd2bc-174">Анализ телеметрии трассировки политики хранения</span><span class="sxs-lookup"><span data-stu-id="cd2bc-174">Analyzing Retention Policy Trace Telemetry</span></span>](/dynamics365/business-central/dev-itpro/administration/telemetry-retention-policy-trace)  
[<span data-ttu-id="cd2bc-175">Изменение аудита в Business Central</span><span class="sxs-lookup"><span data-stu-id="cd2bc-175">Auditing Changes in Business Central</span></span>](across-log-changes.md)  
[<span data-ttu-id="cd2bc-176">Фильтрация</span><span class="sxs-lookup"><span data-stu-id="cd2bc-176">Filtering</span></span>](ui-enter-criteria-filters.md#filtering)  
[<span data-ttu-id="cd2bc-177">Использование очередей работ для планирования задач</span><span class="sxs-lookup"><span data-stu-id="cd2bc-177">Use Job Queues to Schedule Tasks</span></span>](admin-job-queues-schedule-tasks.md)  
<span data-ttu-id="cd2bc-178">[Работа с [!INCLUDE[prod_short](includes/prod_short.md)]](ui-work-product.md)</span><span class="sxs-lookup"><span data-stu-id="cd2bc-178">[Working with [!INCLUDE[prod_short](includes/prod_short.md)]](ui-work-product.md)</span></span>  

[!INCLUDE[footer-include](includes/footer-banner.md)]