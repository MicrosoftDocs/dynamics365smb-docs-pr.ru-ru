---
title: Синхронизация транзакций и выплат
description: Настройка и выполнение импорта транзакций и выплат из Shopify.
ms.date: 06/06/2023
ms.topic: article
ms.service: dynamics365-business-central
ms.search.form: '30124, 30125, 30130, 30131, 30132, 30133, 30134,'
author: andreipa
ms.author: andreipa
ms.reviewer: bholtorf
---

# <a name="transactions-and-payouts" />Транзакции и выплаты

Когда клиент завершает оформление заказа в интернет-магазине, информация о платежах сохраняется в виде **Транзакции**. С заказом может быть связано несколько транзакций, например, когда клиент использует подарочную карту для оплаты части стоимости, а затем использует кредитную карту или PayPal для оплаты оставшейся суммы.

Если вы используете Shopify Payment в качестве поставщика платежных услуг, то кроме информации о деньгах, полученных от клиента поставщиком платежных услуг, вы также увидите выплаты от Shopify на ваш банковский счет.

## <a name="transactions" />Транзакции

Платежные транзакции, совершаемые в Shopify, синхронизируются с заказами и могут быть просмотрены на странице **Заказы Shopify**.

Чтобы просмотреть все транзакции, выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Транзакции**, а затем выберите связанную ссылку.

Поле **№ учтенного счета** может быть полезно в процессе выверки.

Если вы настроили сопоставление способов оплаты, созданному документу продажи будет назначен код способа оплаты. Дополнительные сведения см. в разделе [Сопоставление способов оплаты](#payment-method-mapping).

## <a name="payouts" />Выплаты

Если в вашем магазине используется функция Shopify Payments, вы будете получать платежи через **Shopify Payouts**, когда клиент оплачивает покупку с помощью Shopify Payments и ускоренного оформления заказов.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите синхронизировать выплаты, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Синхронизировать выплаты**.

Чтобы просмотреть все выплаты, выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Выплаты**, а затем выберите связанную ссылку.

**Выплаты** предназначены только для информационных целей и не влияют на главную книгу или банковскую книгу, хотя они могут быть полезны при обработке выписки по банковскому счету.

## <a name="payment-method-mapping" />Сопоставление способов оплаты

Чтобы заполнить **Код способа оплаты** для торговых документов, импортированных из Shopify автоматически, вам нужно настроить параметр **Сопоставление способов оплаты**.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите определить сопоставление, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Сопоставление способов оплаты**.
4. В полях **Шлюз** и **Эмитент кредитной карты** введите название способа оплаты из Shopify. Запись создается автоматически при импорте заказов Shopify.
5. Введите **Код способа оплаты** вместе с соответствующим способом оплаты в [!INCLUDE[prod_short](../includes/prod_short.md)].
6. Установите **приоритет** для случаев, когда клиент использует несколько способов оплаты. В торговом документе выбирается способ оплаты с наивысшим приоритетом. Если оба способа оплаты имеют одинаковый приоритет, используется способ оплаты с наибольшей суммой.

> [!NOTE]  
> Если для соответствующего способа оплаты в [!INCLUDE[prod_short](../includes/prod_short.md)] заполнены поля **Тип балансового счета** и **Номер балансового счета**, во время учета система счетов создаст балансирующую операцию с типом *Оплата* и применит ее к типу *Счет* в операции книги клиентов.

## <a name="use-cases" />Сценарии использования
  
Стороны:

* Покупатель — лицо, приобретающее товар в интернет-магазине Shopify.
* Продавец — ваша организация.
* Поставщик платежных услуг — организация, которая обеспечивает для вас обработку платежей. Это может быть Shopify Payments или сторонняя организация.

### <a name="how-money-flows" />Как движутся деньги

Покупатель покупает товар в интернет-магазине. Последний этап — это обработка платежа.

>[!NOTE]
> Этот пример не распространяется на случаи, когда оплата производится за пределами оформления заказа Shopify, что возможно в B2B-сценариях.
  
Покупатель оплачивает покупку с помощью кредитной карты, PayPal или с помощью какого-либо местного способа оплаты, такого как MobilePay в Дании. Поставщик платежных услуг взимает полную сумму с Покупателя. В этот момент деньги Покупателя переводятся Поставщику платежных услуг.

В зависимости от Поставщика платежных услуг Продавец может увидеть эти деньги на своем счете у Поставщика платежных услуг — как полученные суммы, так и вычтенные комиссии. Поставщики платежных услуг часто взимают комиссию с каждой транзакции, а в некоторых случаях у них также может быть фиксированная комиссия.
  
В зависимости от Поставщика платежных услуг Продавец либо инициирует перевод денег на свой банковский счет (выплату) вручную, либо это происходит автоматически в течение определенного периода времени — один раз в день, один раз в месяц и т. д.
  
В зависимости от банка Продавец может увидеть эту входящую транзакцию на своем банковском счете через онлайн-банкинг или в выписке по счету.

Существует несколько вариантов обработки платежных транзакций в [!INCLUDE[prod_short](../includes/prod_short.md)]
  
### <a name="option--reconcile-incoming-transfers-to-bank-account-against-original-invoices" />Вариант 1: выверка входящих переводов на банковский счет по выставленным счетам
  
Продавец импортирует заказ на продажу в [!INCLUDE[prod_short](../includes/prod_short.md)] и учитывает отгрузку и выставленный счет.

Результат: система создает **операцию книги клиентов** типа *Счет* на всю сумму; в поле **Открыто** устанавливается значение "Да". Значение в поле **Оставшаяся сумма** равно сумме, на которую выставлен счет.

Продавец импортирует банковскую выписку, используя журнал выверки платежей.

Проблемы:

1. возможны затруднения, если счетов (и кредит-нот) много, однако поставщик платежных услуг осуществляет выплату в виде единовременной суммы.
2. Суммы обычно не совпадают из-за комиссии. Для обработки комиссий можно использовать отклонения для платежей и/или скидки при оплате.

### <a name="option--reconcile-incoming-transfers-to-bank-account-against-interim-account-representing-money-at-the-payment-provider" />Вариант 2: выверка входящих переводов на банковский счет с промежуточным счетом, представляющим деньги у поставщика платежных услуг
  
Продавец импортирует заказ на продажу в [!INCLUDE[prod_short](../includes/prod_short.md)] и учитывает отгрузку и выставленный счет.
  
Результат: система создает операцию книги клиентов типа **Счет** на всю сумму; в поле **Открыто** устанавливается значение "Да". Значение в поле **Оставшаяся сумма** равно сумме, на которую выставлен счет.

Однако, поскольку заказ на продажу имеет код способа оплаты, у которого заполнены поля **Тип балансового счета** и **Номер балансового счета**, система автоматически создает еще одну операцию книги клиентов типа **Оплата** и применяет ее к ранее созданной операции книги клиентов.

>[!NOTE]
> Система заполняет поле код способа оплаты на основе сопоставления способа оплаты. Дополнительные сведения см. в разделе [Сопоставление способов оплаты](#payment-method-mapping).
  
Определить балансирующие счета для способов оплаты можно двумя способами:

* Установить в поле **Тип балансового счета** значение *Банк*, а в поле **Номер балансового счета** ввести специальный банковский счет, который представляет собой ваш счет у поставщика платежных услуг.
* Установить в поле **Тип балансового счета** значение *Счет ГК**, а в поле **Номер балансового счета** ввести счет ГК, который представляет собой ваш счет у поставщика платежных услуг.

Имеет смысл использовать вариант с банковским счетом, если поставщик платежных услуг экспортирует какую-либо выписку по счету, которую вы можете импортировать в журнал выверки платежей.

Продавец импортирует банковскую выписку, используя журнал выверки платежей. Входящая выплата может быть обработана:

* как перевод из другого банка. Если перевод занимает несколько дней или предполагает обмен валюты, имеет смысл использовать промежуточный счет ГК;
* в качестве разницы на счете ГК, который представляет ваш счет у поставщика платежных услуг.
  
Остаток на счете ГК или банковском счете, который представляет ваш счет у поставщика платежных услуг, может быть списан как "Сборы/комиссии"

Проблемы:

1. Вы можете создать несколько счетов ГК или банковских счетов, если работаете с несколькими поставщиками платежных услуг. Однако заказы на продажу в [!INCLUDE[prod_short](../includes/prod_short.md)] поддерживают только один код способа оплаты, что затрудняет обработку случаев, когда покупатель использует несколько способов оплаты для заказа.

## <a name="see-also" />См. также

[Начало работы с соединителем для Shopify](get-started.md)  
