---
title: Устранение неполадок Shopify и синхронизация с Business Central
description: 'Что делать, если что-то пойдет не так во время синхронизации данных между Shopify и Business Central.'
author: brentholtorf
ms.author: bholtorf
ms.reviewer: bholtorf
ms.topic: how-to
ms.date: 05/01/2024
ms.custom: bap-template
ms.search.form: '30118, 30119, 30120, 30101, 30102'
ms.service: dynamics-365-business-central
---

# Устранение неполадок Shopify и синхронизация с Business Central

Возможны ситуации, когда вам потребуется устранить неполадки во время синхронизации данных между Shopify и [!INCLUDE[prod_short](../includes/prod_short.md)]. На этой странице описаны действия по устранению неполадок для некоторых типовых сценариев.

## Выполнение задач на переднем плане

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify** и выберите соответствующую ссылку.
2. Выберите магазин, для которого нужно устранить неполадки, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выключите переключатель **Разрешить фоновые синхронизации**.

Теперь после запуска действия синхронизации задача будет выполняться на переднем плане. В случае возникновения ошибки появится диалоговое окно с ссылкой **Копировать сведения**. Используйте эту ссылку, чтобы скопировать информацию в текстовый редактор для дальнейшего анализа.

## Журналы

Функции ведения журнала могут облегчить определение причины возникновения ошибки. На странице **Карточка магазина Shopify** в поле **Режим регистрации** можно указать степень детализации регистрируемой информации об ошибках. В этом поле можно выбрать одно из следующих значений:

- **Отключено** — не регистрировать информацию об ошибках.
- **Только ошибки** — регистрировать только сообщения об ошибках, без пар запрос/отклик. Это значение по умолчанию для новых магазинов.
- **Все** — регистрировать пары запрос/отклик для всех транзакций, включая успешные. Постоянное ведение журнала всех ошибок может замедлить работу [!INCLUDE [prod_short](../includes/prod_short.md)]. Используйте этот режим, если обмен данными не приводит к ошибке, но вы хотите получить больше информации о данных, которые были фактически отправлены и получены. Обратите внимание, что некоторые данные фиксируются всегда, вне зависимости от того, включена ли функция ведения журнала. Дополнительные сведения см. в разделе [Сбор данных](#data-capture).

### Просмотр журналов

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), значок, введите **Записи в журнале Shopify**, а затем выберите связанную ссылку.
2. Выберите соответствующую операцию журнала и откройте страницу **Операция журнала Shopify**.
3. Просмотрите запрос, код состояния и описание, а также значения ответа.

> [!TIP]
> Если вам необходимо связаться с поддержкой Shopify для получения помощи в устранении неполадок, запишите информацию в поле **ИД запроса**. Эта информация может помочь службе поддержки быстрее решить проблему.

Вы можете загрузить значения запроса и ответа в виде файлов в текстовом формате.

### Управление данными операций журнала

Чтобы контролировать размер вашей базы данных, операции журнала включаются в политику хранения данных, которая называется **Операция журнала Shopify**. Политики хранения позволяют указать, как долго вы хотите хранить данные того или иного типа. По умолчанию операции журнала Shopify хранятся в течение одного месяца. Подробнее о политиках хранения можно узнать в статье [Определение политик хранения](../admin-data-retention-policies.md).

Кроме того, на странице **Операции журнала Shopify** можно удалить все операции журнала или операции старше семи дней.

## Сбор данных

Независимо от того, включена ли функция ведения журнала, некоторые отклики Shopify регистрируются всегда. Просмотреть или загрузить журналы можно на странице **Список сбора данных**.

Выберите действие **Извлеченные данные Shopify** на одной из следующих страниц:

- **Заказ Shopify**
- **Строка заказа Shopify**
- **Выполнения Shopify**
- **Стоимость доставки заказа Shopify**
- **Транзакции по заказам Shopify**
- **Возврат Shopify**
- **Строка возврата Shopify**
- **Возврат денег Shopify**
- **Строка возврата денег Shopify**
- **Выплаты Shopify**
- **Платежные транзакции Shopify**
- **Транзакции Shopify**

## Сброс синхронизации

Для оптимальной производительности соединитель импортирует только клиентов, продукты и заказы, созданные или измененные с момента последней синхронизации. На странице **Карточка магазина Shopify** есть функции, позволяющие изменить дату/время последней синхронизации или полностью сбросить ее. Эта функция гарантирует, что будут синхронизированы все данные, а не только изменения с момента последней синхронизации.

Эта функция применяется только к синхронизации из Shopify в [!INCLUDE[prod_short](../includes/prod_short.md)]. Она может быть полезна, если вам нужно восстановить удаленные данные, такие как продукты, клиенты или удаленные заказы.

## Запрос токена доступа

Если [!INCLUDE[prod_short](../includes/prod_short.md)] не подключается к вашей учетной записи Shopify, попробуйте запросить токен доступа из Shopify. Вам может понадобиться запросить новый токен, если были изменены ключи безопасности или требуемые разрешения (области приложения).

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), и введите **Магазины Shopify** и выберите связанную ссылку.
2. Выберите магазин, токен доступа которого вы хотите получить, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Запрос доступа**.
4. Если будет предложено, войдите в свою учетную запись Shopify.

Переключатель **Есть ключ доступа** находится в состоянии «вкл.».

## Проверка и включение разрешений для выполнения HTTP-запросов в непроизводственной среде

Для корректной работы расширению "Соединитель Shopify" требуется разрешение на выполнение HTTP-запросов. При выполнении тестов в средах-песочницах HTTP-запросы запрещены для всех расширений.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Управление расширениями**, затем выберите связанную ссылку.
2. Выберите расширение **Соединитель Shopify**.
3. Выберите действие **Настроить**, чтобы открыть страницу **Настройка расширения**.
4. Убедитесь, что переключатель **Разрешить запросы HTTPClient** включен.

## Ротация токена доступа Shopify

Следующие процедуры описывают, как выполнять ротацию маркера доступа, используемого соединителем Shopify для доступа к вашему интернет-магазину Shopify.

### В Shopify

1. Из своего пункта **Администрирование Shopify** перейдите в пункт [Приложения](https://www.shopify.com/admin/apps).
2. Выберите **Удалить** в строке с приложением **Dynamics 365 Business Central**.
3. Выберите **Удалить** в открывшемся сообщении.

### В [!INCLUDE[prod_short](../includes/prod_short.md)]

1. Выберите ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать") введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для токена доступа которого вы хотите выполнить ротацию, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Запрос доступа**.
4. При появлении запроса войдите в свою учетную запись Shopify, проверьте конфиденциальность и разрешения, а затем нажмите кнопку **Установить приложение**.

## Известные проблемы

### Ошибка: заголовок продажи не существует. Идентификационные поля и значения: тип документа = "Предложение", № = "ВАШ МАГАЗИН SHOPIFY"

Для расчета цен соединитель Shopify создает временный документ продажи (предложение) для временного клиента (код магазина) и использует стандартную логику расчета цены. Если стороннее расширение подписывается на события временного торгового документа, заголовок может быть недоступен. Рекомендуем обратиться к поставщику расширения. Попросите поставщика изменить свой код для проверки на временные записи. В некоторых случаях достаточно добавить метод `IsTemporary` в нужном месте. Подробнее о методе `IsTemporary` см. в описании метода [IsTemporary](/dynamics365/business-central/dev-itpro/developer/methods-auto/record/record-istemporary-method). 

Чтобы убедиться, что проблема вызвана сторонним расширением, используйте ссылку **Копировать информацию в буфер обмена** в сообщении об ошибке и скопируйте содержимое в текстовый редактор. Информация содержит **Стек вызовов AL**, верхняя строка в котором — это строка, в которой произошла ошибка. Ниже приведен пример стека вызовов AL.

Стек вызовов AL:

```AL
[Object Name]([Object type] [Object Id]).[Function Name] line [XX] - [Extension Name] by [Publisher] 
...
"Sales Line"(Table 37)."No. - OnValidate"(Trigger) line 98 - Base Application by Microsoft
"Shpfy Product Price Calc."(CodeUnit 30182).CalcPrice line 20 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).CreateTempProduct line 137 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).CreateProduct line 5 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).OnRun(Trigger) line 12 - Shopify Connector by Microsoft
"Shpfy Add Item to Shopify"(Report 30106)."Item - OnAfterGetRecord"(Trigger) line 2 - Shopify Connector by Microsoft
"Shpfy Products"(Page 30126)."AddItems - OnAction"(Trigger) line 5 - Shopify Connector by Microsoft
```

Не забудьте поделиться информацией о стеке вызовов AL с поставщиком расширения.

### Ошибка: Общая бизнес-группа должна иметь значение в поле "Клиент": "ВАШ МАГАЗИН SHOPIFY". Это значение не может быть нулевым или пустым.

На странице **Карточка магазина Shopify** в поле **Код шаблона клиента** выберите шаблон, в котором заполнено поле **Общая бизнес-группа**. Шаблон клиента используется для создания клиентов и для расчета цен продажи в документах продажи.

### Ошибка: Импорт данных в ваш магазин Shopify не включен. Перейдите в карточку магазина, чтобы включить его

На странице **Карточка магазина Shopify** включите переключатель **Разрешить синхронизацию данных в Shopify**. Этот переключатель предназначен для защиты интернет-магазина от получения демо-данных из [!INCLUDE[prod_short](../includes/prod_short.md)].

### Ошибка: Ошибка Oauth, invalid_request: не удалось найти приложение API для Shopify с api_key

Возможно, вы используете [внедренное приложение](/dynamics365/business-central/dev-itpro/deployment/embed-app-overview), где URL-адрес клиента имеет следующий формат: `https://[application name].bc.dynamics.com`. Соединитель Shopify не работает для внедренных приложений. Подробнее см. в разделе [Какие продукты Майкрософт работают с соединителем Shopify?](shopify-faq.md#which-microsoft-products-work-with-the-shopify-connector).

### Ошибка: внутренняя ошибка. Похоже, с нашей стороны что-то пошло не так. ИД запроса: ХХХХХХХ-ХХХХ-ХХХХ-ХХХХ-ХХХХ

Свяжитесь со службой поддержки Shopify в течение 7 дней с момента возникновения этой ошибки и укажите ИД запроса. Подробнее см. в статье [Варианты поддержки для Shopify](shopify-faq.md#shopify).

### Ошибка: ошибка Oauth invalid_request: у вашей учетной записи нет разрешения на предоставление запрошенного доступа для этого приложения. 

У пользователя, который запросил доступ, нет прав на управление приложениями (возможности управлять и устанавливать приложения и каналы, а также потенциально утверждать плату за использование приложений). Возможно, вы сможете решить проблему, установив приложение от имени владельца учетной записи. Также вы можете проверить разрешение в отношении приложения (**App permission**) пользователя в параметрах раздела [**User and permissions**](https://www.shopify.com/admin/settings/account) на **панели администрирования Shopify**.  

### [{"message":"Access denied for ИМЯ_ПОЛЯ field.","locations":[{"line":0,"column":0}],"path":["путь"],"extensions":{"code":"ACCESS_DENIED","documentation":https://shopify.dev/api/usage/access-scopes}}]

Запросите новый токен, поскольку обновленная версия соединителя требует дополнительных разрешений (областей приложения). Подробнее см. в разделе [Запрос токена доступа](#request-the-access-token)

### [API] Неверный ключ API или токен доступа (нераспознанный логин или неверный пароль)

Запросите новый токен, поскольку обновленная версия соединителя требует дополнительных разрешений (областей приложения). Подробнее см. в разделе [Запрос токена доступа](#request-the-access-token)

## См. также

[Начало работы с соединителем для Shopify](get-started.md)
