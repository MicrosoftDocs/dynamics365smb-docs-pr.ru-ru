---
title: Устранение неполадок Shopify и синхронизация с Business Central
description: 'Узнайте, что делать, если что-то пошло не так во время синхронизации данных между Shopify и Business Central'
ms.date: 03/27/2023
ms.topic: article
ms.service: dynamics365-business-central
ms.search.form: '30118, 30119, 30120, 30101, 30102'
author: edupont04
ms.author: andreipa
ms.reviewer: solsen
---

# Устранение неполадок Shopify и синхронизация с Business Central

Возможны ситуации, когда вам потребуется устранить неполадки во время синхронизации данных между Shopify и [!INCLUDE[prod_short](../includes/prod_short.md)]. На этой странице описаны действия по устранению неполадок для некоторых типовых сценариев.

## Выполнение задач на переднем плане

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify** и выберите соответствующую ссылку.
2. Выберите магазин, для которого нужно устранить неполадки, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выключите переключатель **Разрешить фоновые синхронизации**.

Теперь при запуске действия синхронизации задача будет выполняться на переднем плане, и в случае возникновения ошибки будет отображаться диалоговое окно ошибки со ссылкой **Копировать сведения**. Используйте эту ссылку, чтобы скопировать дополнительную информацию в текстовый редактор для дальнейшего анализа.

## Журналы

В случае сбоя задачи синхронизации вы можете включить переключатель **Журнал включен** на странице **Карточка магазина Shopify**, чтобы активировать ведение журнала. Затем вы можете вручную запустить задачу синхронизации и просмотреть журналы.

### Чтобы включить ведение журнала:

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify** и выберите соответствующую ссылку.
2. Выберите магазин, для которого нужно устранить неполадки, чтобы открыть страницу **Карточка магазина Shopify**.
3. Включите переключатель **Журнал включен**.

### Чтобы просмотреть журналы:

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), значок, введите **Записи в журнале Shopify**, а затем выберите связанную ссылку.
2. Выберите соответствующую запись журнала и откройте страницу **Запись в журнале Shopify**.
3. Просмотрите запрос, код состояния и описание, а также значения ответа. Вы можете загрузить значения запроса и ответа в виде файлов в текстовом формате.

Потом не забудьте отключить ведение журнала, чтобы избежать негативного влияния на производительность и увеличения размера базы данных.

Со страницы **Записи в журнале Shopify** вы можете инициировать удаление всех записей журнала или тех, которые старше семи дней.

## Сбор данных

Независимо от настроек **Активации ведения журналов**, некоторые ответы Shopify будут всегда записываться в журнал, поэтому вы можете проверить или скачать их с помощью страницы **Список сбора данных**.

Выберите действие **Извлеченные данные Shopify** на одной из следующих страниц:

- **Заказ Shopify**
- **Выполнение заказов Shopify**
- **Стоимость доставки заказа Shopify**
- **Транзакции по заказам Shopify**
- **Выплаты Shopify**
- **Платежные транзакции Shopify**
- **Транзакции Shopify**

## Сброс синхронизации

Для оптимальной производительности соединитель импортирует только клиентов, продукты и заказы, созданные или измененные с момента последней синхронизации. На странице **Карточка магазина Shopify** есть функции, изменяющие дату/время последней синхронизации или полностью сбрасывающие ее. Эта функция гарантирует, что при запуске синхронизации будут синхронизированы все данные, а не только изменения с момента последней синхронизации.

Эта функция применяется только к синхронизации из Shopify в [!INCLUDE[prod_short](../includes/prod_short.md)]. Она может быть полезна, если вам нужно восстановить удаленные данные, такие как продукты, клиенты или удаленные заказы.

## Запрос токена доступа

Если [!INCLUDE[prod_short](../includes/prod_short.md)] не подключается к вашей учетной записи Shopify, попробуйте запросить токен доступа из Shopify. Этот запрос может потребоваться при ротации ключей безопасности или изменении необходимых разрешений (областей действия).

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), и введите **Магазины Shopify** и выберите связанную ссылку.
2. Выберите магазин, токен доступа которого вы хотите получить, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Запрос доступа**.
4. Если будет предложено, войдите в свою учетную запись Shopify.

Будет активирован переключатель **Имеет AccessKey**.

### Проверка и включение разрешения для выполнения HTTP-запросов при работе в непроизводственной среде

Для корректной работы расширению соединителя Shopify требуется разрешение на выполнение HTTP-запросов. При тестировании в песочницах HTTP-запросы запрещены для всех расширений.

1. Выберите ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать") введите **управление расширениями**, затем выберите связанную ссылку.
2. Выберите расширение **Соединитель Shopify**.
3. Выберите действие **Настроить**, чтобы открыть страницу **Настройка расширения**.
4. Убедитесь, что переключатель **Разрешить запросы HTTPClient** включен.

## Ротация токена доступа Shopify

Следующие процедуры описывают, как выполнять ротацию маркера доступа, используемого соединителем Shopify для доступа к вашему интернет-магазину Shopify.

### В Shopify

1. Из своего пункта **Администрирование Shopify** перейдите в пункт [Приложения](https://www.shopify.com/admin/apps).
2. Выберите **Удалить** в строке с приложением **Dynamics 365 Business Central**.
3. Выберите **Удалить** в открывшемся сообщении.

### В [!INCLUDE[prod_short](../includes/prod_short.md)]

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), и введите **Магазины Shopify** и выберите связанную ссылку.
2. Выберите магазин, для токена доступа которого вы хотите выполнить ротацию, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Запрос доступа**.
4. При появлении запроса войдите в свою учетную запись Shopify, проверьте конфиденциальность и разрешения, а затем нажмите кнопку **Установить приложение**.

## Известные проблемы

### Ошибка: заголовок продажи не существует. Идентификационные поля и значения: Тип документа = "Предложение", № = "ВАШ МАГАЗИН SHOPIFY"

Для расчета цен соединитель Shopify создает временный документ продажи (предложение) для временного клиента (код магазина) и использует стандартную логику расчета цены. В типовом сценарии стороннее расширение подписывается на события в строке продажи, но не проверяет, является ли запись временной, поэтому заголовок может быть недоступен. Мы рекомендуем связаться с поставщиком расширения и попросить его изменить код так, чтобы выполнялась проверка, являются ли записи временными. В некоторых случаях достаточно добавить метод `IsTemporary` в нужном месте. Чтобы узнать больше о методе IsTemporary, перейдите к разделу [IsTemporary](/dynamics365/business-central/dev-itpro/developer/methods-auto/record/record-istemporary-method). 

Чтобы убедиться, что проблема вызвана сторонним расширением, используйте ссылку **Копировать информацию в буфер обмена** в сообщении об ошибке и скопируйте содержимое в текстовый редактор. Информация содержит **Стек вызовов AL**, верхняя строка в котором — это строка, в которой произошла ошибка. Ниже приведен пример стека вызовов AL.

Стек вызовов AL: 
```AL
[Object Name]([Object type] [Object Id]).[Function Name] line [XX] - [Extension Name] by [Publisher] 
...
"Sales Line"(Table 37)."No. - OnValidate"(Trigger) line 98 - Base Application by Microsoft
"Shpfy Product Price Calc."(CodeUnit 30182).CalcPrice line 20 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).CreateTempProduct line 137 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).CreateProduct line 5 - Shopify Connector by Microsoft
"Shpfy Create Product"(CodeUnit 30174).OnRun(Trigger) line 12 - Shopify Connector by Microsoft
"Shpfy Add Item to Shopify"(Report 30106)."Item - OnAfterGetRecord"(Trigger) line 2 - Shopify Connector by Microsoft
"Shpfy Products"(Page 30126)."AddItems - OnAction"(Trigger) line 5 - Shopify Connector by Microsoft
```

Не забудьте поделиться информацией о стеке вызовов AL с поставщиком расширения.

### Ошибка: Общая бизнес-группа должна иметь значение в поле "Клиент": "ВАШ МАГАЗИН SHOPIFY". Это значение не может быть нулевым или пустым.

На странице **Карточка магазина Shopify** заполните поле **Код шаблона клиента** с шаблоном, который имеет заполненное значение **Общая бизнес-группа**. Этот шаблон клиента используется не только для создания клиентов, но также для расчета цены продажи и при создании документов продажи.

### Ошибка: Импорт данных в ваш магазин Shopify не включен. Перейдите в карточку магазина, чтобы включить его

В окне **Карточка магазина Shopify** включите выключатель **Разрешить синхронизацию данных в Shopify**. Этот переключатель предназначен для защиты интернет-магазина от получения демо-данных от [!INCLUDE[prod_short](../includes/prod_short.md)].

### Ошибка: Ошибка Oauth, invalid_request: не удалось найти приложение API для Shopify с api_key

Похоже, вы используете [внедренное приложение](/dynamics365/business-central/dev-itpro/deployment/embed-app-overview), где URL-адрес клиента имеет следующий формат: `https://[application name].bc.dynamics.com`. Соединитель Shopify не работает для внедренных приложений. Дополнительные сведения см. в разделе [Для каких продуктов Майкрософт доступен соединитель Shopify?](shopify-faq.md#which-microsoft-products-are-the-shopify-connector-available-for).

## См. также

[Начало работы с соединителем для Shopify](get-started.md)
