---
title: Синхронизация клиентов
description: Импорт клиентов из или экспорт в Shopify
ms.date: 06/06/2023
ms.topic: article
ms.service: dynamics365-business-central
ms.search.form: '30105, 30106, 30107, 30108, 30109,'
author: andreipa
ms.author: andreipa
ms.reviewer: bholtorf
---

# <a name="synchronize-customers"></a>Синхронизация клиентов

При импорте заказа из Shopify для дальнейшей обработки документа в [!INCLUDE[prod_short](../includes/prod_short.md)] необходимо получить информацию о клиенте. Существует два основных способа это сделать, а также несколько их сочетаний:

* Использование конкретного клиента для всех заказов.
* Импорт фактической информации о клиентах из Shopify. Этот параметр также доступен при первом экспорте клиентов в Shopify из [!INCLUDE[prod_short](../includes/prod_short.md)].

## <a name="important-settings-when-importing-customers-from-shopify"></a>Важные настройки при импорте клиентов из Shopify

Независимо от того, импортируете ли вы клиентов из Shopify в пакетном режиме или при импорте заказов, используйте следующие настройки для управления процессом:

|Поле|Описание|
|------|-----------|
|**Импорт клиентов из Shopify**|Выберите **Все клиенты**, если вы планируете импортировать клиентов из Shopify оптом; либо вручную с помощью действия **Синхронизировать клиентов**, либо через очередь заданий для повторяющихся обновлений. Независимо от выбора информация о клиенте всегда будет импортироваться вместе с заказом. Однако использование этой информации зависит от **шаблонов клиентов Shopify** и настроек поля **Тип сопоставления клиентов**.|
|**Тип сопоставления клиентов**|Определите, как вы хотите, чтобы соединитель выполнял сопоставление.<br>- **По электронной почте/телефону**, если вы хотите, чтобы соединитель сопоставлял импортированного клиента Shopify с существующим клиентом в [!INCLUDE[prod_short](../includes/prod_short.md)], используя электронную почту и телефон.</br>- **По информации о плательщике**, если вы хотите, чтобы соединитель использовал адрес получателя счета для сопоставления импортированного клиента Shopify с существующим клиентом в [!INCLUDE[prod_short](../includes/prod_short.md)].</br>- Выберите **Всегда брать клиента по умолчанию**, если вы хотите, чтобы система использовала клиента из поля **№ клиента по умолчанию** . |
|**Shopify может обновлять клиентов**| Выберите это поле, если вы хотите, чтобы соединитель обновлял найденных им клиентов, когда в поле **Тип сопоставления клиентов** выбран любой из параметров **По электронной почте/телефону** или **По информации о плательщике**.|
|**Автоматическое создание неизвестных клиентов**| Выберите это поле, если вы хотите, чтобы соединитель создавал отсутствующих клиентов, когда в поле **Тип сопоставления клиентов** выбраны параметры **По электронной почте/телефону** или **По информации о плательщике**. Новый клиент будет создан с использованием импортированных данных и **кода шаблона клиента**, определенного на страницах **Карточка магазина Shopify** или **Шаблон клиента Shopify**. Обратите внимание, что клиент Shopify должен иметь хотя бы один адрес. В заказах, созданных через канал продаж POS Shopify, часто отсутствует информация об адресе. Если эта опция не включена, вам нужно будет создать клиента вручную и связать его с клиентом Shopify.|
|**Код шаблона клиента**|Это поле используется вместе с параметром **Автоматическое создание неизвестных клиентов**.<br>- Выберите шаблон по умолчанию, который будет использоваться для автоматически созданных клиентов. Убедитесь, что выбранный шаблон содержит обязательные поля, такие как **Общая бизнес-группа**,**Учетная группа клиента** или поля, связанные с налогом на добавочную стоимость (НДС) или с налогами.<br>- Вы можете определить шаблоны для каждой страны или региона на странице **Шаблон клиентов Shopify**, которое удобно для правильного расчета налога. <br>- Подробнее см. в разделе [Настройка налогов](setup-taxes.md).|

### <a name="customer-template-per-country"></a>Шаблон клиента для каждой страны

Некоторые параметры могут быть определены на уровне страны/региона или на уровне штата/провинции/области. Эти параметры можно настроить в разделе [Shipping and Delivery](https://www.shopify.com/admin/settings/shipping) в Shopify.

Вы можете сделать следующее для каждого клиента с помощью параметра **Шаблон клиента Shopify**:

1. Указать **№ клиента по умолчанию**, который имеет приоритет над выбором в полях **Импорт клиентов из Shopify** и**Тип сопоставления клиентов**. Он используется в импортированном заказе на продажу.
2. Определить **Код шаблона клиента**, который используется для создания отсутствующих клиентов, если включен параметр **Автоматическое создание неизвестных клиентов**. Если **код шаблона клиента** не заполнен, то функция использует **код шаблона клиента**, определенный в **карточке магазина Shopify**. Сначала система пытается найти шаблон для **кода страны/региона** для адреса по умолчанию. Если найти шаблон не удается, она использует первый адрес.
3. В некоторых случаях **кода шаблона клиента**, определенного для страны/региона, недостаточно для правильного расчета налогов (например, для стран с налогом с продаж). В этом случае может быть полезно включить **налоговую область**.
4. Поле **Налоговая область** также содержит пару значений: **Код страны** и **Название района**. Эта пара полезна, когда соединителю необходимо преобразовать код в имя или наоборот.

> [!NOTE]  
> Коды стран — это коды стран по ISO 3166-1 alpha-2. Узнайте больше в разделе [Код страны](https://help.shopify.com/en/api/custom-storefronts/storefront-api/reference/enum/countrycode).

## <a name="export-customers-to-shopify"></a>Экспорт клиентов в Shopify

Вы можете экспортировать существующих клиентов Shopify в пакетном режиме. В каждом случае создается клиент и один адрес по умолчанию. В можете управлять процессом с помощью следующих параметров:

|Поле|Описание|
|------|-----------|
|**Экспорт клиентов в Shopify**|Выберите этот вариант, если планируете экспортировать всех клиентов с действительным адресом электронной почты из [!INCLUDE[prod_short](../includes/prod_short.md)] в Shopify в пакетном режиме. Вы можете сделать это либо вручную, используя действие **Синхронизировать клиентов**, либо автоматически, используя очередь заданий для повторяющихся обновлений.<br> При экспорте клиентов с адресами, которые включают провинции/штаты, убедитесь, что **Код ISO** заполнен для стран/регионов.|
|**Может обновлять клиентов Shopify**|Этот параметр используется вместе с настройкой **Экспорт клиента в Shopify**. Включите этот параметр, если вы хотите генерировать обновления позже из [!INCLUDE[prod_short](../includes/prod_short.md)] для клиентов, которые уже существуют в Shopify.|

Ниже приведены требования для экспорта клиента:

* У клиента должен быть действительный адрес электронной почты.
* В карточке клиента должны быть выбраны страна/регион; для местных клиентов — с пустой страной/регионом — для страны/региона, указанных на странице **Сведения об организации**, должен быть определен код ISO.
* Если у клиента есть номер телефона, он должен быть уникальным, потому что Shopify не примет второго клиента с таким же номером телефона.
* Если у клиента есть номер телефона, он должен быть в формате E.164. Поддерживаются различные форматы, если они представляют собой номер, который можно набрать из любой точки мира. Допустимы следующие форматы:

  * xxxxxxxxxx
  * +xxxxxxxxxxx
  * (xxx)xxx-xxxx
  * +x xxx-xxx-xxxx

После того как вы создали клиентов в Shopify, вы можете отправлять им прямые приглашения, побуждающие их активировать свои учетные записи.

### <a name="populate-customer-information-in-shopify"></a>Заполните информацию о клиенте в Shopify

Клиент в Shopify имеет имя, фамилию, адрес электронной почты и/или номер телефона. Вы можете ввести имя и фамилию из карточки клиента в [!INCLUDE[prod_short](../includes/prod_short.md)].

|Приоритет|Поле в карточке клиента|Описание|
|------|------|-----------|
|1|**Имя контакта**|Имеет высший приоритет, если заполнено поле **Имя контакта**, а поле **Источник контакта** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|
|2|**Имя 2**|Если заполнено поле **Имя 2**, а поле **Источник имени 2** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|
|3|**Название**|Имеет низший приоритет, если заполнено поле **Имя**, а поле **Источник имени** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|

У клиента в Shopify также есть адрес по умолчанию. Адрес может содержать информацию о компании и адресе в дополнение к имени, фамилии, электронной почте и/или номеру телефону. Вы можете заполнить поле **Компания** на основе данных из карточки клиента в [!INCLUDE[prod_short](../includes/prod_short.md)].

|Приоритет|Поле в карточке клиента|Описание|
|------|------|-----------|
|1|**Название**|Имеет высший приоритет, если поле **Источник имени** в **карточке магазина Shopify** содержит *Название компании*.|
|2|**Имя 2**|Имеет низший приоритет, если поле **Источник имени 2** в **карточке магазина Shopify** содержит *Название компании*.|

Для адресов, в которых используется район или область, выберите **Код** или **Имя** в поле **Источник района** на странице **Карточка магазина Shopify**. Код или имя определяет тип данных, хранящихся в [!INCLUDE[prod_short](../includes/prod_short.md)] в поле **Район**. Не забудьте инициализировать шаблоны клиентов для каждой страны, чтобы было готово соответствие между кодом и названием района. 


## <a name="sync-customers"></a>Синхронизация клиентов

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify**, затем выберите связанную ссылку.
2. Выберите конкретный магазин, для которого вы хотите синхронизировать клиентов.
3. Выберите действие **Синхронизировать клиентов**.

В качестве альтернативы используйте действие **Запустить синхронизацию клиентов** в окне **Клиенты Shopify** или поиск пакетного задания **Синхронизация клиентов**.

Вы можете запланировать задачу для автоматического выполнения. Дополнительные сведения см. а разделе [Планирование повторяющихся задач](background.md#to-schedule-recurring-tasks).

## <a name="see-also"></a>См. также

[Начало работы с соединителем для Shopify](get-started.md)  
