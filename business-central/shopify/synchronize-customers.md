---
title: Синхронизация клиентов
description: Импорт клиентов из или экспорт в Shopify
ms.date: 03/25/2024
ms.topic: article
ms.service: dynamics-365-business-central
ms.search.form: '30105, 30106, 30107, 30108, 30109,'
author: brentholtorf
ms.author: bholtorf
ms.reviewer: andreipa
---

# Синхронизация клиентов и организаций

При импорте заказа из Shopify для дальнейшей обработки документа в [!INCLUDE[prod_short](../includes/prod_short.md)] необходимо получить информацию о клиенте. Существует два основных способа это сделать, а также несколько их сочетаний:

* Использование конкретного клиента для всех заказов.
* Импорт информации о клиентах из Shopify. Этот вариант также доступен при экспорте клиентов в Shopify из [!INCLUDE[prod_short](../includes/prod_short.md)].

Shopify позволяет вам вести бизнес по схемам B2B и DTC с единой мощной и удобной платформы Shopify. Соединитель Shopify также работает с различными формами электронной коммерции.

Тогда как в Shopify предусмотрено две сущности — клиент и компания (организация) — в [!INCLUDE[prod_short](../includes/prod_short.md)] есть только сущность клиента, что влияет на работу синхронизации.

Когда вы работаете по схеме DTC, покупатель создается в Shopify как клиент. Затем этот клиент импортируется в [!INCLUDE[prod_short](../includes/prod_short.md)] как клиент Shopify и связывается с клиентом или преобразовывается в клиента.

Если вы работаете по схеме B2B, покупатель создается в Shopify как клиент, связанный с организацией. Этот клиент импортируется в [!INCLUDE[prod_short](../includes/prod_short.md)] как клиент Shopify, а организация импортируется в [!INCLUDE[prod_short](../includes/prod_short.md)] как организация Shopify и связывается с клиентом или преобразовывается в клиента.

Инструкции по экспорту клиента из [!INCLUDE[prod_short](../includes/prod_short.md)] в Shopify слегка различаются в зависимости от того, что вы хотите сделать:

* Экспортировать клиента как клиента Shopify для схемы DTC.
* Экспортировать клиента как пару «организация и клиент» для схемы B2B.

## Важные параметры при импорте DTC-клиентов из Shopify

Независимо от того, импортируете ли вы клиентов из Shopify в пакетном режиме или при импорте заказов, используйте следующие настройки для управления процессом:

|Поле|Описание|
|------|-----------|
|**Импорт клиентов из Shopify**|Выберите **Все клиенты**, если вы планируете импортировать клиентов из Shopify оптом; либо вручную с помощью действия **Синхронизировать клиентов**, либо через очередь заданий для повторяющихся обновлений. Независимо от выбора информация о клиенте всегда будет импортироваться вместе с заказом. Однако использование этой информации зависит от **шаблонов клиентов Shopify** и настроек поля **Тип сопоставления клиентов**.|
|**Тип сопоставления клиентов**|Определите, как вы хотите, чтобы соединитель выполнял сопоставление.</br></br>- **По электронной почте/телефону**, если вы хотите, чтобы соединитель сопоставлял импортированного клиента Shopify с клиентом в Business Central., используя адрес электронной почты и телефон.</br></br>- **По информации о плательщике**, если вы хотите, чтобы соединитель использовал адрес получателя счета для сопоставления импортированного клиента Shopify с существующим клиентом в Business Central.</br></br>Выберите **Всегда брать клиента по умолчанию**, если вы хотите, чтобы система использовала клиента из поля **№ клиента по умолчанию** . |
|**Shopify может обновлять клиентов**| Выберите это поле, если вы хотите, чтобы соединитель обновлял найденных им клиентов, когда в поле **Тип сопоставления клиентов** выбран любой из параметров **По электронной почте/телефону** или **По информации о плательщике**.|
|**Автоматическое создание неизвестных клиентов**| Выберите это поле, если вы хотите, чтобы соединитель создавал отсутствующих клиентов, когда в поле **Тип сопоставления клиентов** выбраны параметры **По электронной почте/телефону** или **По информации о плательщике**. Новый клиент создается с использованием импортированных данных и **кода шаблона клиента**, определенного на страницах **Карточка магазина Shopify** или **Шаблон клиента Shopify**. Обратите внимание, что клиент Shopify должен иметь хотя бы один адрес. В заказах, созданных через канал продаж POS Shopify, часто отсутствует информация об адресе. Если этот параметр не включен, вам нужно будет создать клиента вручную и связать его с клиентом Shopify.|
|**Код шаблона клиента/организации**|Это поле используется вместе с параметром **Автоматическое создание неизвестных клиентов**.</br></br> Выберите шаблон по умолчанию, который будет использоваться для автоматически создаваемых клиентов. Убедитесь, что выбранный шаблон содержит обязательные поля, такие как **Общая бизнес-группа**,**Учетная группа клиента** или поля, связанные с налогом на добавочную стоимость (НДС) или другими налогами.</br></br>Вы можете определить шаблоны для каждой страны или региона на странице **Шаблоны клиентов Shopify**, что дает возможность правильно рассчитывать налоги.</br></br>Подробнее см. в разделе [Настройка налогов](setup-taxes.md).|

### Шаблон клиента для каждой страны/региона

Некоторые параметры могут быть определены на уровне страны/региона или на уровне штата/провинции/области. Эти параметры можно настроить в разделе [Shipping and Delivery](https://www.shopify.com/admin/settings/shipping) в Shopify.

Вы можете сделать следующее для каждого клиента с помощью параметра **Шаблон клиента Shopify**:

1. Указать **№ клиента по умолчанию**, который имеет приоритет над выбором в полях **Импорт клиентов из Shopify** и**Тип сопоставления клиентов**. Он используется в импортированном заказе на продажу.
2. Определить **Код шаблона клиента**, который используется для создания отсутствующих клиентов, если включен параметр **Автоматическое создание неизвестных клиентов**. Если **код шаблона клиента** не заполнен, то функция использует **код шаблона клиента**, определенный в **карточке магазина Shopify**. Сначала система пытается найти шаблон для **кода страны/региона** для адреса по умолчанию. Если найти шаблон не удается, она использует первый адрес.
3. В некоторых случаях **кода шаблона клиента**, определенного для страны/региона, недостаточно для правильного расчета налогов (например, для стран/регионов с налогом с продаж). В этом случае может быть полезно включить **налоговую область**.
4. Поле **Налоговая область** также содержит пару значений: **Код страны** и **Название района**. Эта пара полезна, когда соединителю необходимо преобразовать код в имя или наоборот.

> [!NOTE]  
> Коды стран — это коды стран по ISO 3166-1 alpha-2. Узнайте больше в разделе [Код страны](https://help.shopify.com/en/api/custom-storefronts/storefront-api/reference/enum/countrycode).

## Важные параметры при экспорте DTC-клиентов в Shopify

Вы можете экспортировать существующих клиентов Shopify в пакетном режиме. В каждом случае создается клиент и один адрес по умолчанию. В можете управлять процессом с помощью следующих параметров:

|Поле|Описание|
|------|-----------|
|**Может обновлять клиентов Shopify**| Включите этот параметр, если вы хотите генерировать обновления позже из Business Central для клиентов, которые уже существуют в Shopify.|

Ниже приведены требования для экспорта клиента:

* У клиента должен быть действительный адрес электронной почты.
* При экспорте клиентов с адресами, которые включают провинции/штаты, убедитесь, что для стран/регионов указан **Код ISO**.|
* Если в карточке клиента выбрана страна/регион, убедитесь, что указан **Код ISO**. Для местных клиентов с пустой страной/регионом соединитель Shopify использует страну/регион, указанную в разделе **Информация об организации**.
* Если у клиента есть номер телефона, он должен быть уникальным, потому что Shopify не примет второго клиента с таким же номером телефона.
* Если у клиента есть номер телефона, он должен быть в формате E.164. Поддерживаются различные форматы, если они представляют собой номер, который можно набрать из любой точки мира. Допустимы следующие форматы:

  * xxxxxxxxxx
  * +xxxxxxxxxxx
  * (xxx)xxx-xxxx
  * +x xxx-xxx-xxxx

После того как вы создали клиентов в Shopify, вы можете отправлять им прямые приглашения, побуждающие их активировать свои учетные записи.

### Заполните информацию о клиенте в Shopify

Клиент в Shopify имеет имя, фамилию, адрес электронной почты и/или номер телефона. Вы можете ввести имя и фамилию из карточки клиента в [!INCLUDE[prod_short](../includes/prod_short.md)].

|Приоритет|Поле в карточке клиента|Описание|
|------|------|-----------|
|1|**Имя контакта**|Имеет высший приоритет, если заполнено поле **Имя контакта**, а поле **Источник контакта** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|
|2|**Имя 2**|Если заполнено поле **Имя 2**, а поле **Источник имени 2** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|
|3|**Название**|Имеет низший приоритет, если заполнено поле **Имя**, а поле **Источник имени** в **карточке магазина Shopify** содержит параметр *Имя и фамилия* или *Фамилия и имя*, чтобы определить, как разделить значения.|

У клиента в Shopify также есть адрес по умолчанию. Адрес может содержать информацию о компании и адресе в дополнение к имени, фамилии, электронной почте и/или номеру телефону. Вы можете заполнить поле **Компания** на основе данных из карточки клиента в [!INCLUDE[prod_short](../includes/prod_short.md)].

|Приоритет|Поле в карточке клиента|Описание|
|------|------|-----------|
|1|**Название**|Имеет высший приоритет, если поле **Источник имени** в **карточке магазина Shopify** содержит *Название компании*.|
|2|**Имя 2**|Имеет низший приоритет, если поле **Источник имени 2** в **карточке магазина Shopify** содержит *Название компании*.|

Для адресов, в которых используется район или область, выберите **Код** или **Имя** в поле **Источник района** на странице **Карточка магазина Shopify**. Код или имя определяет тип данных, хранящихся в [!INCLUDE[prod_short](../includes/prod_short.md)] в поле **Район**. Не забудьте инициализировать шаблоны клиентов для каждой страны/региона, чтобы было готово соответствие между кодом и названием района. 

## Экспорт DTCклиентов в Shopify

### Первоначальная синхронизация клиентов из Business Central в Shopify

1. Нажмите на значок поиска ![Лампочка, которая открывает функцию "Что вы хотите сделать"](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Клиенты Shopify**, а затем выберите связанную ссылку.
2. Выберите действие **Добавить клиента**.
3. В поле **Код магазина** укажите код. Если вы откроете окно **Клиенты Shopify** со страницы **Карточка магазина**, код магазина будет заполнен автоматически.
4. При необходимости определите фильтры для клиентов. Например, можно отфильтровать их по коду страны/региона.
5. Выберите **ОК**.

Полученные клиенты автоматически создаются в Shopify с адресами.

> [!NOTE]  
> При первоначальной синхронизации клиентов из [!INCLUDE[prod_short](../includes/prod_short.md)] в Shopify значение параметра **Может обновлять клиентов Shopify** не учитывается.

### Синхронизация клиентов

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify**, затем выберите связанную ссылку.
2. Выберите конкретный магазин, для которого вы хотите синхронизировать клиентов.
3. Выберите действие **Синхронизировать клиентов**.

В качестве альтернативы используйте действие **Запустить синхронизацию клиентов** в окне **Клиенты Shopify** или поиск пакетного задания **Синхронизация клиентов**.

Вы можете запланировать задачу для автоматического выполнения. Дополнительные сведения см. а разделе [Планирование повторяющихся задач](background.md#to-schedule-recurring-tasks).

## B2B-организации

Если вы используете B2B-торговлю в Shopify, помимо клиентов вы также можете создавать компании (организации). Вы можете связать с организацией одного или нескольких отдельных клиентов. Вы также можете определить условия оплаты, местоположения и каталоги.

## Важные параметры при импорте B2B-организаций из Shopify

Независимо от того, импортируете ли вы организации из Shopify в пакетном режиме или при импорте заказов, используйте параметры в следующей таблице для управления процессом.

|Поле|Описание|
|------|-----------|
|**Импорт организаций из Shopify**|Выберите **Все организации**, если вы планируете импортировать клиентов из Shopify массово — либо вручную с помощью действия **Синхронизировать организации**, либо через очередь заданий для периодических обновлений. Независимо от выбранного информация о клиенте всегда импортируется вместе с заказом. Однако использование этой информации зависит от **шаблонов организаций Shopify** и значения поля **Тип сопоставления организаций**.|
|**Тип сопоставления организаций**|Определите, как вы хотите, чтобы соединитель выполнял сопоставление.</br></br>- **По электронной почте/телефону**, если вы хотите, чтобы соединитель сопоставлял импортируемые организации Shopify с существующим клиентом в Business Central, используя адрес электронной почты и телефон основного контакта.</br></br>- Выберите **Всегда брать организацию по умолчанию**, если вы хотите, чтобы система использовала организацию из поля **№ клиента по умолчанию** . |
|**Shopify может обновлять организации**| Выберите это поле, если вы хотите, чтобы соединитель обновлял найденных им клиентов, когда в поле **Тип сопоставления организаций** выбран вариант **По электронной почте/телефону**.|
|**Автоматически создавать неизвестные организации**| Выберите это поле, если вы хотите, чтобы соединитель создавал новых клиентов, когда в поле **Тип сопоставления организаций** выбран вариант **По электронной почте/телефону**. Новый клиент создается с использованием импортированных данных и **кода шаблона клиента/организации**, определенного на странице **Карточка магазина Shopify** или **Шаблон клиента Shopify**.|
|**Код шаблона клиента/организации**|Это поле используется вместе с параметром **Автоматическое создание неизвестных организаций**.</br></br>- Выберите шаблон по умолчанию, который будет использоваться для автоматически создаваемых клиентов. Убедитесь, что в выбранном шаблоне заполнены обязательные поля, такие как **Общая бизнес-группа**, **Учетная группа клиента**, **Налог на добавленную стоимость (НДС)** или другие связанные с налогами поля.</br></br>- Вы можете определить шаблоны для каждой страны/региона на странице **Шаблон клиентов Shopify**, которое удобно для правильного расчета налога.</br></br>Подробнее см. в статье [Настройка налогов](setup-taxes.md).|

> [!NOTE]  
> У организации должен быть основной контакт. В противном случае соединитель переходит к организации.
> Импортируется только одно самое старое местоположение.
> Импортируется только основной контакт.

## Важные параметры при экспорте B2B-организаций в Shopify

Вы можете экспортировать существующих клиентов Shopify в пакетном режиме в качестве организаций. В каждом случае создается организация с одним местоположением по умолчанию и одним основным контактом. Также можно создать каталог.

|Поле|Описание|
|------|-----------|
|**Может обновлять организации Shopify**| Включите этот параметр, если вы хотите позже генерировать обновления из Business Central для организаций, которые уже существуют в Shopify.|
|**Разрешения контакта по умолчанию**| Укажите, какие разрешения должны быть назначены основному контакту. Возможные варианты: **Нет**, **Только заказы** и **Администрирование складов**.|
|**Автоматически создавать каталог**| Включите этот параметр, если вы хотите создать каталог, включающий все продукты. Для каждой экспортированной организации создается каталог.|

## Экспорт B2B-организации в Shopify

### Первоначальная синхронизация B2B-организаций из Business Central в Shopify

1. Введите в поиске ![Лампочка, которая открывает функцию "Что вы хотите сделать".](../media/ui-search/search_small.png "Что вы хотите сделать") введите **Организация Shopify** и выберите соответствующую ссылку.
2. Выберите действие **Добавить организацию**.
3. В поле **Код магазина** укажите код. Если вы откроете окно **Организация Shopify** со страницы **Карточка магазина**, код магазина будет заполнен автоматически.
4. При необходимости определите фильтры для клиентов. Например, можно отфильтровать их по коду страны/региона.
5. Выберите **ОК**.

Полученные организация и клиенты автоматически создаются в Shopify.

> [!NOTE]  
> При первоначальной синхронизации организаций из [!INCLUDE[prod_short](../includes/prod_short.md)] в Shopify значение параметра **Может обновлять организации Shopify** не учитывается.

### Синхронизация B2B-организации

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазин Shopify**, затем выберите связанную ссылку.
2. Выберите конкретный магазин, для которого вы хотите синхронизировать клиентов.
3. Выберите действие **Синхронизация организации**.

В качестве альтернативы вы можете использовать действие **Начать синхронизацию организации** на странице **Организация Shopify** или найти пакетное задание **Синхронизировать организации**.

Можно запланировать задачу для автоматического выполнения. Дополнительные сведения см. а разделе [Планирование повторяющихся задач](background.md#to-schedule-recurring-tasks).

## См. также

[Начало работы с соединителем для Shopify](get-started.md)  
