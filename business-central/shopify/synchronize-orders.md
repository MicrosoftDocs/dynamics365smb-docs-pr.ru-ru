---
title: Синхронизация и выполнение заказов на продажу
description: Настройте и запустите импорт и обработку заказа на продажу из Shopify.
ms.date: 05/27/2022
ms.topic: article
ms.service: dynamics365-business-central
ms.search.form: '30110, 30111, 30112, 30113, 30114, 30115, 30121, 30122, 30123, 30128, 30129,'
author: edupont04
ms.author: andreipa
ms.reviewer: solsen
---

# Синхронизация и выполнение заказов на продажу

В этой статье описаны необходимые настройки и действия, которые необходимо выполнить для синхронизации и выполнения заказов на продажу с помощью Shopify в [!INCLUDE[prod_short](../includes/prod_short.md)].

## Установите импорт заказов в карточке магазина Shopify

Введите **код валюты**, если ваш интернет-магазин использует валюту, отличную от локальной валюты (LCY). Для указанной валюты должен быть настроен обменный курс. Если ваш интернет-магазин использует ту же валюту, что и [!INCLUDE[prod_short](../includes/prod_short.md)], оставьте поле пустым. 

Вы можете просмотреть валюту магазина в параметрах [Сведения о магазине](https://www.shopify.com/admin/settings/general) в разделе администрирования Shopify. Shopify можно настроить для приема разных валют, однако импортированные заказы в [!INCLUDE[prod_short](../includes/prod_short.md)] используют валюту магазина.

Обычный заказ Shopify может включать в себя затраты в дополнение к подытогу, например стоимость доставки или — если соответствующая функция включена — чаевые. Эти суммы учитываются непосредственно в счете главной книги, который вы хотите использовать для определенных типов транзакций:

* **Счет для расходов на доставку**
* **Счет проданных подарочных карт**; для получения дополнительной информации см. раздел [Подарочная карта](synchronize-orders.md#gift-cards)
* **Счет чаевых**  

Включите **Автоматическое создание заказов**, чтобы автоматически создавать торговые документы в [!INCLUDE[prod_short](../includes/prod_short.md)] сразу же после импорта заказа Shopify.

Если вы хотите, чтобы документ продажи выпускался автоматически, включите переключатель **Автоматически выпускать заказ на продажу**.

Документ продажи в [!INCLUDE[prod_short](../includes/prod_short.md)] ссылается на заказ Shopify, и вы можете добавить поле, которое еще не отображается на странице. Чтобы узнать больше о добавлении поля, см. раздел [Чтобы начать персонализацию страницы с помощью баннера **Персонализация**](../ui-personalization-user.md#to-start-personalizing-a-page-through-the-personalizing-banner). Если вы выберете поле **№ заказа Shopify в строке док.**, эта информация будет повторяться в строках продажи типа **Комментарий**.

В поле **Источник налоговой области** вы можете задать приоритет выбора кода налоговой области или бизнес-группы НДС на основе адреса. Импортированный заказ Shopify содержит информацию о налогах, но налоги пересчитываются при создании документа продажи, поэтому важно, чтобы настройки НДС/налогов были правильными в [!INCLUDE[prod_short](../includes/prod_short.md)]. Подробнее о налогах см. в статье [Настройка налогов для подключения к Shopify](setup-taxes.md).

### Сопоставление способов доставки

**Код способа доставки** для торговых документов, импортированных из Shopify, может быть заполнен автоматически. Вам нужно настроить параметр **Сопоставление способов доставки**.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите определить сопоставление, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Сопоставление способов доставки**. Записи о способах доставки, определенных в настройках [**Перевозки**](https://www.shopify.com/admin/settings/payments) в вашем **центре администрирования Shopify** будут созданы автоматически.
4. В поле **Имя** вы можете увидеть название способа доставки из Shopify.
5. Введите **Код способа доставки** вместе с соответствующим способом доставки в [!INCLUDE[prod_short](../includes/prod_short.md)].

> [!NOTE]  
> Если с заказом на продажу связано несколько расходов на доставку; только один будет выбран в качестве метода доставки и назначен для торгового документа.

### Сопоставление складов

Сопоставление складов требуется для выполнения трех задач:

* Для синхронизации запасов; подробнее см. в разделе [Синхронизация запасов с Shopify](synchronize-items.md#sync-inventory-to-shopify)
* Для заполнения поля **Код склада** для документов продажи, импортированных из Shopify. Это важно, когда переключатель **Склад обязателен** на карточке **Настройка запасов** включен; в противном случае вы не сможете создавать документы продажи.
* Для обновления заказа Shopify в соответствии с информацией о выполнении заказа на основе данных на странице **Учтенная расх. накладная продажи**.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите настроить сопоставление местоположений, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Места**, чтобы открыть **Адреса магазинов Shopify**.
4. Выберите действие **Получить места Shopify** для импорта всех местоположений, определенных в Shopify. Вы можете найти их в меню [**Места**](https://www.shopify.com/admin/settings/locations) настроек вашей панели **администратора Shopify**. Обратите внимание, что место, отмеченное как *По умолчанию*, будет использоваться при импорте невыполненных заказов Shopify.
5. Введите **Код местоположения по умолчанию** с соответствующим расположением в [!INCLUDE[prod_short](../includes/prod_short.md)].

## Запуск синхронизации заказов

Следующая процедура описывает, как импортировать и обновить заказы на продажу.

> [!NOTE]  
> Архивные заказы в Shopify нельзя импортировать. Деактивируйте параметр **Автоматически архивировать заказ** в разделе **Обработка заказов** в настройках **Оформление заказа** на вашей панели **администрирование Shopify**, чтобы убедиться, что все заказы импортируются в [!INCLUDE[prod_short](../includes/prod_short.md)]. Если вам нужно импортировать архивные заказы, используйте действие **Unarchive Orders** на странице [Orders](https://www.shopify.com/admin/orders) панели **Shopify admin**.

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите импортировать заказы, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Заказы**.
4. Выберите действие **Синхронизировать заказы из Shopify**.
5. При необходимости определите фильтры для заказов. Например, вы можете импортировать полностью оплаченные заказы или заказы с низким уровнем риска.

> [!NOTE]  
> При фильтрации по тегу следует использовать токены фильтра `@` и `*`. Например, если вы хотите импортировать заказы, содержащие *tag1*, используйте `@*tag1*`. `@` гарантирует, что результат будет нечувствительным к регистру, а `*` найдет заказы с несколькими тегами.

6. Нажмите кнопку **ОК**.

Кроме того, вы можете выполнить поиск пакетного задания **Синхронизировать заказы из Shopify**.

Вы можете запланировать задачу для автоматического выполнения. Дополнительные сведения см. а разделе [Планирование повторяющихся задач](background.md#to-schedule-recurring-tasks).

## Проверка импортированных заказов

После завершения импорта вы можете изучить данные заказа Shopify и найти всю сопутствующую информацию, такую как платежные операции, стоимость доставки, уровень риска, атрибуты заказа и теги или выполнения, если заказ уже был выполнен в Shopify. Вы также можете увидеть любое подтверждение заказа, отправленное клиенту, выбрав действие **Страница статуса Shopify**.

> [!NOTE]  
> Вы можете перейти в окно **Заказы Shopify** напрямую и посмотреть заказы со статусом *открытый* из всех магазинов. Для просмотра выполненных заказов вам необходимо открыть страницу **Заказы Shopify** из конкретного окна **Карточка магазина Shopify**.

## Создание документов продажи в Business Central

Если переключатель **Автоматическое создание заказов** включен в **карточке магазина Shopify**, [!INCLUDE[prod_short](../includes/prod_short.md)] пытается создать документ продажи после импорта заказа. Если возникают проблемы, например отсутствие клиента или продукта, вам необходимо устранить проблему, а затем повторно создать заказ на продажу.

### Для создания документов продажи

1. Выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Магазины Shopify**, а затем выберите соответствующую ссылку.
2. Выберите магазин, для которого вы хотите синхронизировать заказы, чтобы открыть страницу **Карточка магазина Shopify**.
3. Выберите действие **Заказы**.
4. Выберите заказ, для которого вы хотите создать документ продажи, и выберите действие **Создать документы продажи**.
5. Выберите **Да**.

Если заказ Shopify требует выполнения, будет создан **Заказ на продажу**. Для выполненных заказов Shopify, таких как те заказы, которые содержат только подарочную карту или которые уже обработаны в Shopify, создается **Счет продажи**.

Теперь торговый документ создан, и им можно управлять с помощью стандартных функций [!INCLUDE[prod_short](../includes/prod_short.md)].

### Управление отсутствующими клиентами

Если ваши настройки препятствуют автоматическому созданию клиента, а существующий клиент не может быть найден, вам необходимо назначить клиента для заказа Shopify вручную. Существует несколько способов сделать это:

* Вы можете назначить **Код клиента (покупателя)** и **Код плательщика** непосредственно на странице **Заказы Shopify** путем выбора клиента из списка существующих клиентов.
* Вы можете выбрать код шаблона клиента, создать и назначить клиента через действие **Создать нового клиента** на странице **Заказы Shopify**. Обратите внимание, что клиент Shopify должен иметь хотя бы один адрес. В заказах, созданных через канал продаж POS Shopify, часто отсутствует информация об адресе.
* Вы можете сопоставить существующего клиента со связанным **клиентом Shopify** в окне **Клиенты Shopify**, а затем выбрать действие **Сопоставление полей** на странице **Заказы Shopify**.

### Как соединитель выбирает, какого клиента использовать

Функция *Импорт заказа из Shopify* пытается выбрать клиентов в следующем порядке:

1. Если **№ клиента по умолчанию** определяется в **Шаблоне клиента Shopify** для соответствующей страны, то используется **№ клиента по умолчанию** независимо от настроек в полях **Импорт клиентов из Shopify** и**Тип сопоставления клиентов**. Подробнее см. в разделе [Шаблон клиента для каждой страны](synchronize-customers.md#customer-template-per-country).
2. Если для параметра **Импорт клиентов из Shopify** задано значение *Нет* и **№ клиента по умолчанию** определен на странице **Карточка магазина Shopify**, то используется **№ клиента по умолчанию** .

Дальнейшие действия зависят от параметра **Тип сопоставления клиентов**.

* Если это **Всегда брать клиента по умолчанию**, то соединитель использует клиента, определенного в поле **№ клиента по умолчанию** на странице **Карточка магазина Shopify**.
* Если это **По электронной почте/телефону**, соединитель сначала пытается найти существующего клиента по идентификатору, затем по электронной почте, а затем по номеру телефона. Если клиент не найден, соединитель создает нового клиента.
* Если это **По информации о плательщике**, соединитель сначала пытается найти существующего клиента по идентификатору, а затем по информации об адресе для выставления счета. Если клиент не найден, соединитель создает нового клиента.

> [!NOTE]  
> Соединитель использует информацию из адреса для выставления счетов и создает клиента для выставления счетов в формате [!INCLUDE[prod_short](../includes/prod_short.md)]. Клиент-покупатель аналогичен клиенту-плательщику.

### Влияние правок заказов

В Shopify:

|Изменить|Влияние на уже импортированный заказ|Влияние на заказ, который импортируется впервые|
|------|-----------|-----------|
|Измените место выполнения | Исходный склад находится в строках | Точка выполнения синхронизируется с [!INCLUDE[prod_short](../includes/prod_short.md)].|
|Редактирование заказа и увеличение количества| Заголовок заказа и дополнительные таблицы будут обновлены в [!INCLUDE[prod_short](../includes/prod_short.md)], а строки не будут.| В импортированном заказе будет использоваться новое количество|
|Редактирование заказа и уменьшение количества| Заголовок заказа и дополнительные таблицы будут обновлены в [!INCLUDE[prod_short](../includes/prod_short.md)], а строки не будут.| В импортированном заказе будет использоваться первоначальное количество, а поле «Доступное к выполнению количество» будет содержать новое значение.|
|Редактирование заказа и удаление существующего товара | Заголовок заказа и дополнительные таблицы будут обновлены в [!INCLUDE[prod_short](../includes/prod_short.md)], а строки не будут.| Удаленный товар все равно будет импортирован, а поле «Доступное к выполнению количество» будет содержать ноль. |
|Отредактируйте заказ и добавьте новый товар | Заголовок заказа будет обновлен, строки — нет. | Первоначальные и добавленные товары будут импортированы. |
|Обработка заказа: выполнение, обновление платежной информации | Заголовок заказа будет обновлен, а строки — нет. |Изменение не влияет на способ импорта заказа.|
|Отмена заказа | Заголовок заказа будет обновлен, а строки — нет. |Отмененный заказ не импортируется |

В [!INCLUDE[prod_short](../includes/prod_short.md)]:

|Изменить|Воздействие|
|------|-----------|
|Измените местоположение на другое местоположение, сопоставленное с местоположениями Shopify. Учет отгрузки. | Заказ будет отмечен как выполненный. Будет использоваться исходное местоположение. |
|Измените местоположение на другое местоположение, не сопоставленное с местоположениями Shopify. Учет отгрузки. | Выполнение не будет синхронизировано с Shopify. |
|Уменьшите количество. Учет отгрузки. | Заказ Shopify будет отмечен как частично выполненный. |
|Увеличьте количество. Учет отгрузки. | Выполнение не будет синхронизировано с Shopify. |
|Добавьте новый товар. Учет отгрузки. | Заказ Shopify будет отмечен как выполненный. Строки не будут обновляться. |

## Синхронизация отгрузок в Shopify

Когда заказ на продажу, созданный из заказа Shopify, отгружается, вы можете синхронизировать отгрузки с Shopify.

1. Выберите ![Лампочка, которая открывает функцию Что вы хотите сделать 1.](../media/ui-search/search_small.png "Что вы хотите сделать") введите **Синхронизировать отгрузки в Shopify**, затем выберите соответствующую ссылку.
2. При необходимости определите фильтры для отгрузок. Например, вы можете обновить отгрузку, размещенную на определенную дату.
3. Нажмите кнопку **ОК**.

Заказ в Shopify будет отмечен как выполненный. Клиент автоматически получает уведомление об отгрузке по электронной почте или текстовое сообщение (SMS). Если в отправлении указаны экспедитор и код отслеживания, информация об отслеживании будет включена в электронное письмо.

Также можно использовать действие **Синхронизировать отгрузки** на страницах "Заказы на продажу Shopify" или "Магазин Shopify".

Вы можете запланировать задачу для автоматического выполнения. Дополнительные сведения см. а разделе [Планирование повторяющихся задач](background.md#to-schedule-recurring-tasks).

>[!Important]
>Для склада, указанного в строке учтенной расходной накладной (в том числе, если поле склада оставлено пустым), должна иметься соответствующая запись в складе Shopify. В противном случае эта строка не будет отправлена обратно в Shopify. Подробнее см. в разделе [Сопоставление складов](synchronize-orders.md#location-mapping).

Не забудьте запустить **Синхронизацию заказов из Shopify**, чтобы обновить статус выполнения заказа в [!INCLUDE[prod_short](../includes/prod_short.md)]. Функционал соединителя также архивирует полностью оплаченные и выполненные заказы как в Shopify, так и в [!INCLUDE[prod_short](../includes/prod_short.md)] при выполнении условий.

### Экспедиторы и URL-адрес для отслеживания

Если документ **Учтенная расходная накладная продажи** содержит **код экспедитора** и/или **номер отслеживания посылки**, эта информация будет отправлена на Shopify и покупателю в электронном письме с подтверждением доставки.

Компания, обеспечивающая отслеживание, заполняется на основе записи об экспедиторе в следующем порядке (от высшего к низшему):

* **Компания в Shopify, обеспечивающая отслеживание**
* **Название**
* **Код**

Если поле **URL-адрес для отслеживания посылки** заполнено для записи экспедитора, то подтверждение доставки также будет содержать URL-адрес для отслеживания.

## Подарочные карты

В магазине Shopify можно продавать подарочные карты, которыми можно расплачиваться за реальные товары.

При работе с подарочными картами важно ввести значение в поле **Счет проданных подарочных карт** в окне **Карточка магазина в Shopify**. Проданная подарочная карта будет синхронизирована с заказами в строке. Примененная подарочная карта также будет импортирована вместе с заказом, но уже как транзакция. Обратите внимание, что подарочная карта не уменьшает сумму счета.

Чтобы просмотреть выпущенные и примененные подарочные карты, выберите значок ![Лампочка, которая открывает функцию Что вы хотите сделать.](../media/ui-search/search_small.png "Что вы хотите сделать"), введите **Подарочные карты**, а затем выберите соответствующую ссылку.

## См. также

[Начало работы с соединителем для Shopify](get-started.md)  
